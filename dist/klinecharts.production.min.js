!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).klinecharts={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;e.length>i;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function s(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(i,!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}var v=function(){function t(){i(this,t),this.contentRect={left:0,right:0,top:0,bottom:0},this.height=0,this.width=0}return r(t,[{key:"setDimensions",value:function(t,e,i,a,r,n){this.width=t,this.height=e,this.contentRect.left=i,this.contentRect.right=a,this.contentRect.top=r,this.contentRect.bottom=n}},{key:"contentTop",value:function(){return this.contentRect.top}},{key:"contentLeft",value:function(){return this.contentRect.left}},{key:"contentRight",value:function(){return this.width-this.contentRect.right}},{key:"contentBottom",value:function(){return this.height-this.contentRect.bottom}},{key:"getContentWidth",value:function(){return this.contentRight()-this.contentLeft()}},{key:"getContentHeight",value:function(){return this.contentBottom()-this.contentTop()}},{key:"getContentCenter",value:function(){var t={};return t.x=(this.contentLeft()+this.contentRight())/2,t.y=(this.contentTop()+this.contentBottom())/2,t}}]),t}(),f=document.createElement("canvas").getContext("2d"),g=p(f);function p(t){return(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function y(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout((function(){t()}),1e3/60)}function m(t,e){return f.font=x(t),f.measureText(e).width}function x(t){return"".concat(t,"px Arial")}f.scale(g,g);var M=function(){function t(e,a){i(this,t),this.style=a,this.handler=new v,this.init(e)}return r(t,[{key:"init",value:function(t){var e=document.createElement("canvas");e.style.position="absolute",e.style.right="0",e.style.left="0",this.canvasDom=e,this.ctx=this.canvasDom.getContext("2d"),t.appendChild(this.canvasDom)}},{key:"setChartDimensions",value:function(t,e,i,a,r){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.clearCanvas();var s=p(this.ctx),h=e*s,c=i*s;this.canvasDom.style.top="".concat(t,"px"),this.canvasDom.style.width="".concat(e,"px"),this.canvasDom.style.height="".concat(i,"px"),this.canvasDom.width=h,this.canvasDom.height=c,this.handler.setDimensions(e,i,a,r,n,o),this.ctx.scale(s,s),this.ctx.translate(-.5,-.5),this.draw()}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.handler.width,this.handler.height)}},{key:"flush",value:function(){var t,e=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)),this.requestAnimationId=y((function(){e.clearCanvas(),e.draw()}))}},{key:"draw",value:function(){}}]),t}(),k=function t(e,a){i(this,t),this.handler=e,this.storage=a};function L(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(t&&I(t)){var a=t[e];if(a||0===a||!1===a)return a}return i}function C(t,e){if(I(t)&&I(e))for(var i in e)if(t.hasOwnProperty(i)){var a=t[i],r=e[i];I(r)&&I(a)&&!R(r)&&!R(a)?C(a,r):(e[i]||0===e[i]||!1===e[i])&&(t[i]=e[i])}}function R(t){return"[object Array]"===Object.prototype.toString.call(t)}function T(t){return"function"==typeof t}function I(t){var i=e(t);return"function"===i||!!t&&"object"===i}function A(t){return"number"==typeof t&&!isNaN(t)}var P={NO:"NO",MA:"MA",VOL:"VOL",MACD:"MACD",BOLL:"BOLL",KDJ:"KDJ",RSI:"RSI",BIAS:"BIAS",BRAR:"BRAR",CCI:"CCI",DMI:"DMI",CR:"CR",PSY:"PSY",DMA:"DMA",TRIX:"TRIX",OBV:"OBV",VR:"VR",WR:"WR",MTM:"MTM",EMV:"EMV",SAR:"SAR"},E={DASH:"dash",SOLID:"solid"},b={LEFT:"left",RIGHT:"right"},D={INSIDE:"inside",OUTSIDE:"outside"},S={REAL_TIME:"real_time",CANDLE:"candle"},w={SOLID:"solid",STROKE:"stroke",INCREASING_STROKE:"increasing_stroke",DECREASING_STROKE:"decreasing_stroke",OHLC:"ohlc"},N={ALWAYS:"always",FOLLOW_CROSS:"follow_cross",NONE:"none"},_={FLOAT:"float",FIXED:"fixed"},O={NONE:"none",HORIZONTAL_STRAIGHT_LINE:"horizontalStraightLine",VERTICAL_STRAIGHT_LINE:"verticalStraightLine",STRAIGHT_LINE:"straightLine",HORIZONTAL_RAY_LINE:"horizontalRayLine",VERTICAL_RAY_LINE:"verticalRayLine",RAY_LINE:"rayLine",HORIZONTAL_SEGMENT_LINE:"horizontalSegmentLine",VERTICAL_SEGMENT_LINE:"verticalSegmentLine",SEGMENT_LINE:"segmentLine",PRICE_LINE:"priceLine",PRICE_CHANNEL_LINE:"priceChannelLine",PARALLEL_STRAIGHT_LINE:"parallelStraightLine",FIBONACCI_LINE:"fibonacciLine"},Y="step_1",F="step_2",B="step_3",H="step_done",G=function(){function t(){i(this,t),this.dataList=[],this.minPos=0,this.range=180,this.maxRange=300,this.minRange=20,this.dataSpace=0,this.tooltipDataPos=0,this.crossPoint=null,this.graphicMarkType=O.NONE,this.graphicMarkPoint=null,this.isDragGraphicMark=!1,this.graphicMarkDatas={horizontalStraightLine:[],verticalStraightLine:[],straightLine:[],horizontalRayLine:[],verticalRayLine:[],rayLine:[],horizontalSegmentLine:[],verticalSegmentLine:[],segmentLine:[],priceLine:[],parallelStraightLine:[],priceChannelLine:[],fibonacciLine:[]}}return r(t,[{key:"space",value:function(t){this.dataSpace=t/this.range}},{key:"addData",value:function(t,e){if(I(t)&&!R(t)){var i=0;this.dataList.length>e?e>0?this.dataList[e]=t:this.dataList.unshift(t):(i=1,this.dataList.push(t)),this.dataList.length-1>this.minPos+this.range||this.moveToLast(i)}else R(t)&&(0===this.dataList.length?(this.dataList=t.concat(this.dataList),this.moveToLast(t.length)):(this.dataList=t.concat(this.dataList),this.minPos+=t.length))}},{key:"moveToLast",value:function(t){this.dataList.length>this.range?(this.minPos=this.dataList.length-this.range,this.tooltipDataPos+=t,this.tooltipDataPos>this.dataList.length-1&&(this.tooltipDataPos=this.dataList.length-1)):this.minPos=0}},{key:"calcCurrentTooltipDataPos",value:function(t,e){var i=+Math.ceil((e-t)/this.dataSpace).toFixed(0);this.tooltipDataPos=this.minPos+i-1,this.tooltipDataPos>this.dataList.length-1&&(this.tooltipDataPos=this.dataList.length-1),this.crossPoint.x=t+this.dataSpace*(this.tooltipDataPos-this.minPos)+.74*this.dataSpace/2}}]),t}(),V=function(t){function e(t,a,r){var n;return i(this,e),(n=u(this,c(e).call(this,t,a))).yAxisRender=r,n}return h(e,t),r(e,[{key:"renderHorizontalSeparatorLine",value:function(t,e){var i=e.line.size;t.strokeStyle=e.line.color,t.lineWidth=i,t.beginPath(),t.moveTo(this.handler.contentLeft(),this.handler.contentTop()+i),t.lineTo(this.handler.contentRight(),this.handler.contentTop()+i),t.stroke(),t.closePath()}},{key:"renderIndicator",value:function(t,e,i,a){var r,n=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=a[e]||[],h=[];switch(e){case P.MA:var c=[];s.forEach((function(t){c.push("ma".concat(t))})),r=function(a,r,s,l){n.ohlcIndicatorRendering(t,r,a,l,i,s,e,c,o,(function(t){n.prepareLinePoints(a,t,h)}))};break;case P.MACD:r=function(e,a,r,o){var s=r.macd||{};n.prepareLinePoints(e,[s.diff,s.dea],h);var c=s.macd,l=((n.storage.dataList[a-1]||{}).macd||{}).macd||Number.MIN_SAFE_INTEGER;c>0?(t.strokeStyle=i.increasingColor,t.fillStyle=i.increasingColor):(t.strokeStyle=i.decreasingColor,t.fillStyle=i.decreasingColor),n.renderBars(t,e,o,c,!((l||0===l)&&c>l))};break;case P.VOL:r=function(e,a,r,o){var c=r.vol||{},l=[];s.forEach((function(t){l.push(c["ma".concat(t)])})),n.prepareLinePoints(e,l,h),t.fillStyle=r.close>((n.storage.dataList[a-1]||{}||{}).close||Number.MIN_SAFE_INTEGER)?i.increasingColor:i.decreasingColor,n.renderBars(t,e,o,c.num,!0)};break;case P.BOLL:r=function(a,r,s,c){n.ohlcIndicatorRendering(t,r,a,c,i,s,e,["up","mid","dn"],o,(function(t){n.prepareLinePoints(a,t,h)}))};break;case P.BIAS:r=function(t,e,i){var a=i.bias||{},r=[];s.forEach((function(t){r.push(a["bias".concat(t)])})),n.prepareLinePoints(t,r,h)};break;case P.BRAR:r=function(t,e,i){var a=i.brar||{};n.prepareLinePoints(t,[a.br,a.ar],h)};break;case P.CCI:r=function(t,e,i){n.prepareLinePoints(t,[(i.cci||{}).cci],h)};break;case P.CR:r=function(t,e,i){var a=i.cr||{};n.prepareLinePoints(t,[a.cr,a.ma1,a.ma2,a.ma3,a.ma4],h)};break;case P.DMA:r=function(t,e,i){var a=i.dma||{};n.prepareLinePoints(t,[a.dif,a.difMa],h)};break;case P.DMI:r=function(t,e,i){var a=i.dmi||{};n.prepareLinePoints(t,[a.mdi,a.pdi,a.adx,a.adxr],h)};break;case P.KDJ:r=function(t,e,i){var a=i.kdj||{};n.prepareLinePoints(t,[a.k,a.d,a.j],h)};break;case P.RSI:r=function(t,e,i){var a=i.rsi||{},r=[];s.forEach((function(t){r.push(a["rsi".concat(t)])})),n.prepareLinePoints(t,r,h)};break;case P.PSY:r=function(t,e,i){n.prepareLinePoints(t,[(i.psy||{}).psy],h)};break;case P.TRIX:r=function(t,e,i){var a=i.trix||{};n.prepareLinePoints(t,[a.trix,a.maTrix],h)};break;case P.OBV:r=function(t,e,i){var a=i.obv||{};n.prepareLinePoints(t,[a.obv,a.maObv],h)};break;case P.VR:r=function(t,e,i){var a=i.vr||{};n.prepareLinePoints(t,[a.vr,a.maVr],h)};break;case P.WR:r=function(t,e,i){var a=i.wr||{};n.prepareLinePoints(t,[a.wr1,a.wr2,a.wr3],h)};break;case P.MTM:r=function(t,e,i){var a=i.mtm||{};n.prepareLinePoints(t,[a.mtm,a.mtmMa],h)};break;case P.EMV:r=function(t,e,i){var a=i.emv||{};n.prepareLinePoints(t,[a.emv,a.maEmv],h)};break;case P.SAR:r=function(a,r,s,h){n.ohlcIndicatorRendering(t,r,a,h,i,s,e,["sar"],o,(function(e){var r=e[0];if(r||0===r){var o=n.yAxisRender.getY(r);t.strokeStyle=(s.high+s.low)/2>r?i.increasingColor:i.decreasingColor,t.beginPath(),t.arc(a,o,h,2*Math.PI,0,!0),t.stroke(),t.closePath()}}))}}this.renderGraphics(t,r,(function(){n.renderLines(t,h,i)}))}},{key:"ohlcIndicatorRendering",value:function(t,e,i,a,r,n,o,s,h,c){var l=n[o.toLowerCase()]||{},u=[];(s.forEach((function(t){u.push(l[t])})),c&&c(u),h)||this.renderOhlc(t,a,i,n,this.storage.dataList[e-1]||{},r.increasingColor,r.decreasingColor)}},{key:"renderGraphics",value:function(t,e,i){for(var a=this.handler.contentLeft(),r=.74*this.storage.dataSpace,n=r/2,o=Math.min(this.storage.dataList.length,this.storage.minPos+this.storage.range),s=this.storage.minPos;o>s;s++){e&&e((a+(a+r))/2,s,this.storage.dataList[s],n),a+=this.storage.dataSpace}i&&i()}},{key:"prepareLinePoints",value:function(t,e,i){for(var a=0;e.length>a;a++){var r=this.yAxisRender.getY(e[a]);i[a]?i[a].push({x:t,y:r}):i[a]=[{x:t,y:r}]}}},{key:"renderLines",value:function(t,e,i){var a=i.lineColors,r=e.length,n=(i.lineColors||[]).length;t.lineWidth=i.lineSize;for(var o=0;r>o;o++){var s=e[o];if(s.length>0){t.strokeStyle=a[o%n],t.beginPath(),t.moveTo(s[0].x,s[0].y);for(var h=1;s.length>h;h++)t.lineTo(s[h].x,s[h].y);t.stroke(),t.closePath()}}}},{key:"renderBars",value:function(t,e,i,a,r){if(a||0===a){t.lineWidth=1;var n=this.yAxisRender.getY(a),o=this.yAxisRender.getY(0),s=n;0>a&&(s=o);var h=Math.abs(o-n);1>h&&(h=1),r?t.fillRect(e-i,s,2*i,h):t.strokeRect(e-i,s,2*i,h)}}},{key:"renderOhlc",value:function(t,e,i,a,r,n,o){var s=this.yAxisRender.getY(a.open),h=this.yAxisRender.getY(a.close),c=this.yAxisRender.getY(a.high),l=this.yAxisRender.getY(a.low);t.strokeStyle=a.close>r.close?n:o,t.lineWidth=1,t.beginPath(),t.moveTo(i,c),t.lineTo(i,l),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i-e,s),t.lineTo(i,s),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i+e,h),t.lineTo(i,h),t.stroke(),t.closePath()}}]),e}(k);function z(t,e){return null==e&&(e=10),t=(+t).toFixed(e=Math.min(Math.max(0,e),20))}function W(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&A(i)?t.toFixed(e):"".concat(i)}var j=function(t){function e(t,a){var r;return i(this,e),(r=u(this,c(e).call(this,t,a))).axisMaximum=0,r.axisMinimum=0,r.axisRange=0,r.values=[],r}return h(e,t),r(e,[{key:"computeAxisValues",value:function(){if(this.axisRange<0)this.values=[];else{var t=+function(t){var e=Math.floor(Math.log(t)/Math.log(10)),i=Math.pow(10,e),a=t/i;return t=(1>a?1:2>a?2:3>a?3:5>a?5:10)*i,-20>e?t:+t.toFixed(0>e?-e:0)}(this.axisRange/8),e=function(t){var e=""+t,i=e.indexOf("e");if(i>0){var a=+e.slice(i+1);return 0>a?-a:0}var r=e.indexOf(".");return 0>r?0:e.length-1-r}(t),i=+z(Math.ceil(this.axisMinimum/t)*t,e),a=+z(Math.floor(this.axisMaximum/t)*t,e),r=0,n=i;if(0!==t)for(;+a>=n;)++r,n+=t;this.values=[],n=i;for(var o=0;r>o;o++)this.values[o]={v:+n.toFixed(e)},n+=t}}}]),e}(k),X=function(t){function e(){return i(this,e),u(this,c(e).apply(this,arguments))}return h(e,t),r(e,[{key:"renderAxisLine",value:function(t,e){e.display&&e.line.display&&(t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),e.position===b.LEFT?(t.moveTo(this.handler.contentLeft(),this.handler.contentTop()),t.lineTo(this.handler.contentLeft(),this.handler.contentBottom())):(t.moveTo(this.handler.contentRight(),this.handler.contentTop()),t.lineTo(this.handler.contentRight(),this.handler.contentBottom())),t.stroke(),t.closePath())}},{key:"renderAxisLabels",value:function(t,e){var i=e.tick.text;if(e.display&&i.display){var a,r=e.tick.line,n=i.position,o=r.display,s=r.length,h=i.margin;a=e.position===b.LEFT?n===D.OUTSIDE?o?this.handler.contentLeft()-s-h:this.handler.contentLeft()-h:o?this.handler.contentLeft()+s+h:this.handler.contentLeft()+h:n===D.OUTSIDE?o?this.handler.contentRight()+s+h:this.handler.contentRight()+h:o?this.handler.contentRight()-s-h:this.handler.contentRight()-h;var c,l=i.size;t.textBaseline="middle",t.font=x(l),t.fillStyle=i.color;for(var u=0;this.values.length>u;u++){var d=this.values[u].y,v=A(c=this.values[u].v)?c>5e4?"".concat(+(c/1e3).toFixed(1),"K"):c>5e6?"".concat(+(c/1e6).toFixed(3),"M"):"".concat(c):"--";t.textAlign=e.position===b.LEFT&&n===D.OUTSIDE||e.position===b.RIGHT&&n!==D.OUTSIDE?"right":"left",t.fillText(v,a,d)}t.textAlign="left"}}},{key:"renderSeparatorLines",value:function(t,e){var i=e.separatorLine;if(e.display&&i.display){t.strokeStyle=i.color,t.lineWidth=i.size,i.style===E.DASH&&t.setLineDash(i.dashValue);for(var a=0;this.values.length>a;a++){var r=this.values[a].y;t.beginPath(),t.moveTo(this.handler.contentLeft(),r),t.lineTo(this.handler.contentRight(),r),t.stroke(),t.closePath()}t.setLineDash([])}}},{key:"renderTickLines",value:function(t,e){var i=e.tick.text;if(e.display&&i.display){var a=e.tick.line;t.lineWidth=a.size,t.strokeStyle=a.color;var r,n,o=a.length,s=i.position;e.position===b.LEFT?(r=this.handler.contentLeft(),n=s===D.OUTSIDE?r-o:r+o):(r=this.handler.contentRight(),n=s===D.OUTSIDE?r+o:r-o);for(var h=0;this.values.length>h;h++){var c=this.values[h].y;t.beginPath(),t.moveTo(r,c),t.lineTo(n,c),t.stroke(),t.closePath()}}}},{key:"calcAxisMinMax",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.storage.dataList,n=this.storage.minPos,o=Math.min(n+this.storage.range,r.length),s=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER];if(i)for(var h=n;o>h;h++){var c=r[h],l=[c.close,s[0]],u=[c.close,s[1]];a&&(l.push(c.average),u.push(c.average)),s[0]=Math.min.apply(null,l),s[1]=Math.max.apply(null,u)}else{for(var d=n;o>d;d++){var v=r[d];this.compareMinMax(v,t,s),e&&(s[0]=Math.min(v.low,s[0]),s[1]=Math.max(v.high,s[1]))}t===P.VOL&&(s[0]=0)}s[0]!==Number.MAX_SAFE_INTEGER&&s[1]!==Number.MIN_SAFE_INTEGER&&(this.axisMinimum=s[0],this.axisMaximum=s[1])}},{key:"compareMinMax",value:function(t,e,i){var a=L(t,e.toLowerCase(),{});return Object.keys(a).forEach((function(t){var e=a[t];(e||0===e)&&(i[0]=Math.min(i[0],e),i[1]=Math.max(i[1],e))})),e!==P.BOLL&&e!==P.SAR||(i[0]=Math.min(i[0],t.low),i[1]=Math.max(i[1],t.high)),i}},{key:"computeAxis",value:function(t){var e=this.axisMinimum,i=this.axisMaximum;if(e!==Number.MAX_SAFE_INTEGER&&i!==Number.MIN_SAFE_INTEGER&&(0!==i||0!==e)){var a=Math.abs(i-e);0===a&&(a=Math.abs((i+=1)-(e-=1))),this.axisMinimum=e-a/100*10,this.axisMaximum=i+a/100*20,this.axisRange=Math.abs(this.axisMaximum-this.axisMinimum),this.computeAxisValues(),this.fixComputeAxisValues(t)}}},{key:"fixComputeAxisValues",value:function(t){var e=this.values.length;if(e>0){var i=t.tick.text.size,a=this.getY(this.values[0].v),r=1;if(e>1){var n=this.getY(this.values[1].v),o=Math.abs(n-a);2*i>o&&(r=Math.ceil(2*i/o))}for(var s=[],h=0;e>h;h+=r){var c=this.values[h].v,l=this.getY(c);l>this.handler.contentTop()+i&&l<this.handler.contentBottom()-i&&s.push({v:c,y:l})}this.values=s}}},{key:"getY",value:function(t){return(1-(t-this.axisMinimum)/this.axisRange)*this.handler.getContentHeight()}},{key:"getValue",value:function(t){return(1-t/this.handler.getContentHeight())*this.axisRange+this.axisMinimum}}]),e}(j),U=function(t){function e(t,a,r,n){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P.MACD;return i(this,e),(o=u(this,c(e).call(this,t,a))).indicatorParams=n,o.indicatorType=s,o.yAxisRender=new X(o.handler,r),o.chartRender=new V(o.handler,r,o.yAxisRender),o}return h(e,t),r(e,[{key:"draw",value:function(){if(this.isDrawChart()){var t=this.style.yAxis;this.calcYAxisMinMax(),this.yAxisRender.computeAxis(t),this.yAxisRender.renderSeparatorLines(this.ctx,t),this.drawChart(),this.yAxisRender.renderAxisLine(this.ctx,t),this.yAxisRender.renderTickLines(this.ctx,t),this.yAxisRender.renderAxisLabels(this.ctx,t)}}},{key:"drawChart",value:function(){this.chartRender.renderIndicator(this.ctx,this.indicatorType,this.style.indicator,this.indicatorParams,!1),this.chartRender.renderHorizontalSeparatorLine(this.ctx,this.style.xAxis)}},{key:"isDrawChart",value:function(){return this.indicatorType!==P.NO}},{key:"calcYAxisMinMax",value:function(){this.yAxisRender.calcAxisMinMax(this.indicatorType,!1,!1,!1)}}]),e}(M),Z=function(t){function e(){return i(this,e),u(this,c(e).apply(this,arguments))}return h(e,t),r(e,[{key:"renderCandle",value:function(t,e,i){var a=this;t.lineWidth=1;var r=[],n=Number.MIN_SAFE_INTEGER,o=-1,s=Number.MAX_SAFE_INTEGER,h=-1,c=this.storage.dataList;this.renderGraphics(t,(function(i,l,u,d){var v=c[l-1]||{},f=v.close||Number.MIN_SAFE_INTEGER,g=u.high,p=u.low,y=u.close,m=u.open;if(g>n&&(n=g,o=i),s>p&&(s=p,h=i),y>f?(t.strokeStyle=e.increasingColor,t.fillStyle=e.increasingColor):(t.strokeStyle=e.decreasingColor,t.fillStyle=e.decreasingColor),e.style!==w.OHLC){var x=a.yAxisRender.getY(m),M=a.yAxisRender.getY(y),k=a.yAxisRender.getY(g),L=a.yAxisRender.getY(p),C=[],R=[];switch(C[0]=k,R[1]=L,x>M?(C[1]=M,R[0]=x,r=[i-d,M,2*d,x-M]):M>x?(C[1]=x,R[0]=M,r=[i-d,x,2*d,M-x]):(C[1]=x,R[0]=M,r=[i-d,x,2*d,1]),t.beginPath(),t.moveTo(i,C[0]),t.lineTo(i,C[1]),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i,R[0]),t.lineTo(i,R[1]),t.stroke(),t.closePath(),1>r[3]&&(r[3]=1),e.style){case w.SOLID:t.fillRect(r[0],r[1],r[2],r[3]);break;case w.STROKE:t.strokeRect(r[0],r[1],r[2],r[3]);break;case w.INCREASING_STROKE:y>f?t.strokeRect(r[0],r[1],r[2],r[3]):t.fillRect(r[0],r[1],r[2],r[3]);break;case w.DECREASING_STROKE:y>f?t.fillRect(r[0],r[1],r[2],r[3]):t.strokeRect(r[0],r[1],r[2],r[3])}}else a.renderOhlc(t,d,i,u,v,e.increasingColor,e.decreasingColor)})),this.highestMarkData={x:o,price:n},this.lowestMarkData={x:h,price:s}}},{key:"renderHighestPriceMark",value:function(t,e,i){var a=this.highestMarkData.price;a!==Number.MIN_SAFE_INTEGER&&e.display&&this.renderLowestHighestPriceMark(t,e,this.highestMarkData.x,a,!0,i)}},{key:"renderLowestPriceMark",value:function(t,e,i){var a=this.lowestMarkData.price;a!==Number.MAX_SAFE_INTEGER&&e.display&&this.renderLowestHighestPriceMark(t,e,this.lowestMarkData.x,a,!1,i)}},{key:"renderLowestHighestPriceMark",value:function(t,e,i,a,r,n){t.save(),t.beginPath(),t.rect(0,0,this.handler.contentRight()-this.handler.contentLeft(),this.handler.contentBottom()-this.handler.contentTop()),t.closePath(),t.clip();var o=i,s=this.yAxisRender.getY(a)+(r?-2:2);t.textAlign="left",t.lineWidth=1,t.strokeStyle=e.color,t.fillStyle=e.color,t.beginPath(),t.moveTo(o,s),t.lineTo(o-2,s+(r?-2:2)),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(o,s),t.lineTo(o+2,s+(r?-2:2)),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(o,s),t.lineTo(o,s+=r?-5:5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(o,s),t.lineTo(o+5,s),t.stroke(),t.closePath(),t.font=x(e.text.size);var h=W(a,n);t.textBaseline="middle",t.fillText(h,o+5+e.text.margin,s),t.restore()}},{key:"renderLastPriceMark",value:function(t,e,i,a,r){var n=this.storage.dataList.length;if(e.display&&0!==n){var o=(this.storage.dataList[n-2]||{}).close||Number.MIN_SAFE_INTEGER,s=this.storage.dataList[n-1].close,h=this.yAxisRender.getY(s),c=this.handler.contentBottom()-this.handler.contentTop();h=+Math.max(.05*c,Math.min(h,.98*c)).toFixed(0);var l=s>o?e.increasingColor:e.decreasingColor,u=this.handler.contentLeft(),d=this.handler.contentRight(),v=e.text;if(v.display){var f,g=W(s,r),p=e.text.size,y=m(p,g)+v.paddingLeft+v.paddingRight,M=v.paddingTop+p+v.paddingBottom;a?f=i?u-y:d:i?(f=u,u+=y):d=f=d-y,t.fillStyle=l,t.fillRect(f,h-v.paddingTop-p/2,y,M),t.fillStyle=v.color,t.font=x(p),t.textBaseline="middle",t.fillText(g,f+v.paddingLeft,h)}var k=e.line;k.display&&(t.strokeStyle=l,t.lineWidth=k.size,k.style===E.DASH&&t.setLineDash(k.dashValue),t.beginPath(),t.moveTo(u,h),t.lineTo(d,h),t.stroke(),t.closePath(),t.setLineDash([]))}}},{key:"renderTimeLine",value:function(t,e){var i=this,a=[],r=[{x:this.handler.contentLeft(),y:this.handler.contentBottom()}],n=[],o=this.storage.minPos,s=this.storage.range,h=this.storage.dataList.length;this.renderGraphics(t,(function(t,e,c){var l=c.average,u=i.yAxisRender.getY(c.close),d=i.yAxisRender.getY(l);a.push({x:t,y:u}),(l||0===l)&&n.push({x:t,y:d}),e===o?(r.push({x:i.handler.contentLeft(),y:u}),r.push({x:t,y:u})):e===o+s-1?(r.push({x:t,y:u}),r.push({x:i.handler.contentRight(),y:u}),r.push({x:i.handler.contentRight(),y:i.handler.contentBottom()})):e===h-1?(r.push({x:t,y:u}),r.push({x:t,y:i.handler.contentBottom()})):r.push({x:t,y:u})}),(function(){var i=e.timeLine;if(a.length>0){t.lineWidth=i.size,t.strokeStyle=i.color,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(var o=1;a.length>o;o++)t.lineTo(a[o].x,a[o].y);t.stroke(),t.closePath()}if(r.length>0){t.fillStyle=i.areaFillColor,t.beginPath(),t.moveTo(r[0].x,r[0].y);for(var s=1;r.length>s;s++)t.lineTo(r[s].x,r[s].y);t.closePath(),t.fill()}var h=e.averageLine;if(h.display&&n.length>0){t.lineWidth=h.size,t.strokeStyle=h.color,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var c=1;n.length>c;c++)t.lineTo(n[c].x,n[c].y);t.stroke(),t.closePath()}}))}}]),e}(V),K=function(t){function e(t,a,r,n,o){var s;return i(this,e),(s=u(this,c(e).call(this,t,a,r,n,P.MA))).chartRender=new Z(s.handler,r,s.yAxisRender),s.precision=o,s.chartType=S.CANDLE,s}return h(e,t),r(e,[{key:"draw",value:function(){d(c(e.prototype),"draw",this).call(this),this.chartRender.renderLastPriceMark(this.ctx,this.style.lastPriceMark,this.style.yAxis.position===b.LEFT,this.style.yAxis.tick.text.position===D.OUTSIDE,this.precision.pricePrecision)}},{key:"drawChart",value:function(){this.chartType!==S.REAL_TIME?(this.chartRender.renderCandle(this.ctx,this.style.candle,this.precision.pricePrecision),this.chartRender.renderIndicator(this.ctx,this.indicatorType,this.style.indicator,this.indicatorParams,!0),this.chartRender.renderHighestPriceMark(this.ctx,this.style.highestPriceMark,this.precision.pricePrecision),this.chartRender.renderLowestPriceMark(this.ctx,this.style.lowestPriceMark,this.precision.pricePrecision)):this.chartRender.renderTimeLine(this.ctx,this.style.realTime)}},{key:"isDrawChart",value:function(){return!0}},{key:"calcYAxisMinMax",value:function(){this.yAxisRender.calcAxisMinMax(this.indicatorType,!0,this.chartType===S.REAL_TIME,this.style.realTime.averageLine.display)}}]),e}(U);function q(t,e,i){var a=[];if(t&&e&&i.length>0){var r=t.x-e.x;if(0===r)i.forEach((function(t){a.push(t.y)}));else{var n=(t.y-e.y)/r,o=t.y-n*t.x;i.forEach((function(t){a.push(t.x*n+o)}))}}return a}function J(t,e,i){return!!(i&&t&&e)&&(t.x===e.x?1>Math.abs(i.x-t.x):t.y===e.y?1>Math.abs(i.y-t.y):1>Math.abs(i.y-q(t,e,[i])[0]))}function $(t,e,i){return!!(i&&t&&e)&&(!!J(t,e,i)&&(t.x===e.x?e.y>t.y?i.y>t.y-2:t.y+2>i.y:e.x>t.x?i.x>t.x-2:t.x+2>i.x))}function Q(t,e,i){return!!(i&&t&&e)&&(!!J(t,e,i)&&2>Math.abs(Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))+Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))-Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))))}function tt(t,e,i){if(!i)return!1;var a=i.x-t.x,r=i.y-t.y;return!(a*a+r*r>e*e)}function et(t,e,i){var a=[];if(t.length>1)if(t[0].x===t[1].x){var r=e.contentTop(),n=e.contentBottom();if(a.push([{x:t[0].x,y:r},{x:t[0].x,y:n}]),t.length>2&&(a.push([{x:t[2].x,y:r},{x:t[2].x,y:n}]),i)){var o=t[0].x-t[2].x;a.push([{x:t[0].x+o,y:r},{x:t[0].x+o,y:n}])}}else{var s=e.contentLeft(),h=e.contentRight();if(t[0].y===t[1].y){if(a.push([{x:s,y:t[0].y},{x:h,y:t[0].y}]),t.length>2&&(a.push([{x:s,y:t[2].y},{x:h,y:t[2].y}]),i)){var c=t[0].y-t[2].y;a.push([{x:s,y:t[0].y+c},{x:h,y:t[0].y+c}])}}else{var l=(t[0].y-t[1].y)/(t[0].x-t[1].x),u=t[0].y-l*t[0].x;if(a.push([{x:s,y:s*l+u},{x:h,y:h*l+u}]),t.length>2){var d=t[2].y-l*t[2].x;if(a.push([{x:s,y:s*l+d},{x:h,y:h*l+d}]),i){var v=u+(u-d);a.push([{x:s,y:s*l+v},{x:h,y:h*l+v}])}}}}return a}function it(t,e){var i=[];if(t.length>0){var a=e.contentLeft(),r=e.contentRight();if(i.push([{x:a,y:t[0].y},{x:r,y:t[0].y}]),t.length>1){var n=t[0].y-t[1].y;i.push([{x:a,y:t[1].y+.786*n},{x:r,y:t[1].y+.786*n}]),i.push([{x:a,y:t[1].y+.618*n},{x:r,y:t[1].y+.618*n}]),i.push([{x:a,y:t[1].y+.5*n},{x:r,y:t[1].y+.5*n}]),i.push([{x:a,y:t[1].y+.382*n},{x:r,y:t[1].y+.382*n}]),i.push([{x:a,y:t[1].y+.236*n},{x:r,y:t[1].y+.236*n}]),i.push([{x:a,y:t[1].y},{x:r,y:t[1].y}])}}return i}var at=function(t){function e(t,a,r){var n;return i(this,e),(n=u(this,c(e).call(this,t,a))).yRender=r,n}return h(e,t),r(e,[{key:"renderHorizontalStraightLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.HORIZONTAL_STRAIGHT_LINE,e,J,(function(t){return[[{x:i.handler.contentLeft(),y:t[0].y},{x:i.handler.contentRight(),y:t[0].y}]]}))}},{key:"renderVerticalStraightLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.VERTICAL_STRAIGHT_LINE,e,J,(function(t){return[[{x:t[0].x,y:i.handler.contentTop()},{x:t[0].x,y:i.handler.contentBottom()}]]}))}},{key:"renderStraightLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.STRAIGHT_LINE,e,J,(function(t){if(t[0].x===t[1].x)return[[{x:t[0].x,y:i.handler.contentTop()},{x:t[0].x,y:i.handler.bottom}]];var e=q(t[0],t[1],[{x:i.handler.contentLeft(),y:t[0].y},{x:i.handler.contentRight(),y:t[0].y}]);return[[{x:i.handler.contentLeft(),y:e[0]},{x:i.handler.contentRight(),y:e[1]}]]}))}},{key:"renderHorizontalRayLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.HORIZONTAL_RAY_LINE,e,$,(function(t){var e={x:i.handler.contentLeft(),y:t[0].y};return t[1].x>t[0].x&&(e.x=i.handler.contentRight()),[[t[0],e]]}))}},{key:"renderVerticalRayLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.VERTICAL_RAY_LINE,e,$,(function(t){var e={x:t[0].x,y:i.handler.contentTop()};return t[1].y>t[0].y&&(e.y=i.handler.contentBottom()),[[t[0],e]]}))}},{key:"renderRayLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.RAY_LINE,e,$,(function(t){var e;return e=t[0].x===t[1].x&&t[0].y!==t[1].y?t[1].y>t[0].y?{x:t[0].x,y:i.handler.contentBottom()}:{x:t[0].x,y:i.handler.contentTop()}:t[0].x>t[1].x?{x:i.handler.contentLeft(),y:q(t[0],t[1],[{x:i.handler.contentLeft(),y:t[0].y}])[0]}:{x:i.handler.contentRight(),y:q(t[0],t[1],[{x:i.handler.contentRight(),y:t[0].y}])[0]},[[t[0],e]]}))}},{key:"renderSegmentLine",value:function(t,e){this.renderPointGraphicMark(t,O.HORIZONTAL_SEGMENT_LINE,e,Q),this.renderPointGraphicMark(t,O.VERTICAL_SEGMENT_LINE,e,Q),this.renderPointGraphicMark(t,O.SEGMENT_LINE,e,Q)}},{key:"renderPriceLine",value:function(t,e,i){var a=this;this.renderPointGraphicMark(t,O.PRICE_LINE,e,$,(function(t){return[[t[0],{x:a.handler.contentRight(),y:t[0].y}]]}),!0,i)}},{key:"renderPriceChannelLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.PRICE_CHANNEL_LINE,e,J,(function(t){return et(t,i.handler,!0)}))}},{key:"renderParallelStraightLine",value:function(t,e){var i=this;this.renderPointGraphicMark(t,O.PARALLEL_STRAIGHT_LINE,e,J,(function(t){return et(t,i.handler)}))}},{key:"renderFibonacciLine",value:function(t,e,i){var a=this;this.renderPointGraphicMark(t,O.FIBONACCI_LINE,e,J,(function(t){return it(t,a.handler)}),!0,i,["(100.0%)","(78.6%)","(61.8%)","(50.0%)","(38.2%)","(23.6%)","(0.0%)"])}},{key:"renderPointGraphicMark",value:function(t,e,i,a,r,n,o,s){var h=this;this.storage.graphicMarkDatas[e].forEach((function(e){var c=e.drawStep,l=[];e.points.forEach((function(t){var e=(t.xPos-h.storage.minPos)*h.storage.dataSpace,i=h.yRender.getY(t.price);l.push({x:e,y:i})}));var u=r?r(l):[l];h.renderGraphicMark(t,i,u,l,c,a,n,o,s)}))}},{key:"renderGraphicMark",value:function(t,e,i,a,r,n,o,s){var h=this,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],l=this.storage.graphicMarkPoint,u=!1;i.forEach((function(i,a){if(i.length>1){var d=n(i[0],i[1],l);if(u||(u=d),r!==Y&&(t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke(),t.closePath(),o)){var v=W(h.yRender.getValue(i[0].y),s);t.font=x(e.text.size),t.fillStyle=e.text.color,t.fillText("".concat(v," ").concat(c[a]||""),i[0].x+e.text.marginLeft,i[0].y-e.text.marginBottom)}}}));for(var d=e.point.radius,v=!1,f=0;a.length>f&&!(v=tt(a[f],d,l));f++);a.forEach((function(i){var a=tt(i,d,l);if(v||u){var r=d,n=e.point.backgroundColor,o=e.point.borderColor,s=e.point.borderSize;a&&(r=e.point.activeRadius,n=e.point.activeBackgroundColor,o=e.point.activeBorderColor,s=e.point.activeBorderSize),t.fillStyle=n,t.beginPath(),t.arc(i.x,i.y,r,0,2*Math.PI),t.closePath(),t.fill(),t.lineWidth=s,t.strokeStyle=o,t.beginPath(),t.arc(i.x,i.y,r,0,2*Math.PI),t.closePath(),t.stroke()}}))}}]),e}(k),rt=function(t){function e(t,a,r,n,o){var s;return i(this,e),(s=u(this,c(e).call(this,t,a))).graphicMarkRender=new at(s.handler,r,n),s.precision=o,s}return h(e,t),r(e,[{key:"draw",value:function(){var t=this.style.marker;this.graphicMarkRender.renderHorizontalStraightLine(this.ctx,t),this.graphicMarkRender.renderVerticalStraightLine(this.ctx,t),this.graphicMarkRender.renderStraightLine(this.ctx,t),this.graphicMarkRender.renderHorizontalRayLine(this.ctx,t),this.graphicMarkRender.renderVerticalRayLine(this.ctx,t),this.graphicMarkRender.renderRayLine(this.ctx,t),this.graphicMarkRender.renderSegmentLine(this.ctx,t),this.graphicMarkRender.renderPriceLine(this.ctx,t,this.precision.pricePrecision),this.graphicMarkRender.renderPriceChannelLine(this.ctx,t),this.graphicMarkRender.renderParallelStraightLine(this.ctx,t),this.graphicMarkRender.renderFibonacciLine(this.ctx,t,this.precision.pricePrecision)}}]),e}(M);function nt(t,e){var i=function(t){if(t&&A(t))return new Date(t);return null}(t);if(i){var a=""+i.getFullYear(),r=""+(i.getMonth()+1),n=""+i.getDate(),o=""+i.getHours(),s=""+i.getMinutes(),h=1===r.length?"0".concat(r):r,c=1===n.length?"0".concat(n):n,l=1===o.length?"0"+o:o,u=1===s.length?"0"+s:s;switch(e){case"YYYY":return a;case"YYYY-MM":return"".concat(a,"-").concat(h);case"YYYY-MM-DD":return"".concat(a,"-").concat(h,"-").concat(c);case"YYYY-MM-DD hh:mm":return"".concat(a,"-").concat(h,"-").concat(c," ").concat(l,":").concat(u);case"MM-DD":return"".concat(h,"-").concat(c);case"MM":return h;case"hh:mm":return"".concat(l,":").concat(u);default:return"".concat(h,"-").concat(c," ").concat(l,":").concat(u)}}return"--"}function ot(t,e){var i;return n(i={},P.NO,t),n(i,P.MA,t),n(i,P.VOL,e),n(i,P.MACD,2),n(i,P.BOLL,t),n(i,P.KDJ,2),n(i,P.RSI,2),n(i,P.BIAS,2),n(i,P.BRAR,4),n(i,P.CCI,4),n(i,P.DMI,4),n(i,P.CR,2),n(i,P.PSY,2),n(i,P.DMA,4),n(i,P.TRIX,4),n(i,P.OBV,4),n(i,P.VR,4),n(i,P.WR,4),n(i,P.MTM,4),n(i,P.EMV,4),n(i,P.SAR,t),i}var st=function(t){function a(t,e,r,n,o,s,h,l,d){var v;return i(this,a),(v=u(this,c(a).call(this,t,e))).indicatorParams=r,v.candleHandler=n,v.volHandler=o,v.subIndicatorHandler=s,v.candleYAxisRender=h,v.volYAxisRender=l,v.subIndicatorYAxisRender=d,v}return h(a,t),r(a,[{key:"renderCrossHorizontalLine",value:function(t,e,i,a,r,n,o){var s=this.getCrossYAxisLabel(n,e,i,o),h=this.storage.crossPoint;if(s&&h&&n.cross.display){var c,l=n.cross.text.horizontal,u=l.size,d=m(u,s),v=this.handler.contentLeft(),f=this.handler.contentRight(),g=this.handler.getContentCenter(),p=l.paddingLeft,y=l.paddingTop,M=l.borderSize,k=d+2*M+p+l.paddingRight,L=u+2*M+y+l.paddingBottom;r?c=a?v-k:f:h.x>g.x?(v=this.handler.contentLeft()+k,c=this.handler.contentLeft()+1):c=(f=this.handler.contentRight()-k)-1,t.lineWidth=n.cross.line.size,t.strokeStyle=n.cross.line.color,n.cross.line.style===E.DASH&&t.setLineDash(n.cross.line.dashValue),t.beginPath(),t.moveTo(v,h.y),t.lineTo(f,h.y),t.stroke(),t.closePath(),t.setLineDash([]);var C=h.y-M-y-u/2;t.fillStyle=l.backgroundColor,t.fillRect(c,C,k,L),t.lineWidth=M,t.strokeStyle=l.borderColor,t.strokeRect(c,C,k,L),t.textBaseline="middle",t.fillStyle=l.color,t.font=x(u),t.fillText(s,c+M+p,h.y)}}},{key:"getCrossYAxisLabel",value:function(t,e,i,a){if(!this.storage.crossPoint)return null;var r,n,o,s=this.storage.crossPoint.y;return s&&s>0&&this.handler.height+this.handler.height+this.handler.height>s?(s>0&&s<this.candleHandler.contentBottom()?(n=this.candleYAxisRender,o=e,r=0):s>this.candleHandler.contentBottom()&&s<this.candleHandler.contentBottom()+this.volHandler.height?(n=this.volYAxisRender,o=P.VOL,r=this.candleHandler.height):(n=this.subIndicatorYAxisRender,o=i,r=this.candleHandler.height+this.volHandler.height),W(n.getValue(s-r),ot(a.pricePrecision,a.volumePrecision)[o])):null}},{key:"renderCrossVerticalLine",value:function(t,e,i){var a=this.storage.crossPoint;if(a&&i.cross.display){var r=i.cross.line;t.lineWidth=r.size,t.strokeStyle=r.color,r.style===E.DASH&&t.setLineDash(r.dashValue),t.beginPath(),t.moveTo(a.x,this.handler.contentTop()),t.lineTo(a.x,this.handler.contentBottom()),t.stroke(),t.closePath(),t.setLineDash([]);var n=nt(e.timestamp,"YYYY-MM-DD hh:mm"),o=i.cross.text.vertical,s=o.size,h=m(s,n),c=a.x-h/2,l=o.paddingLeft,u=o.paddingRight,d=o.paddingTop,v=o.paddingBottom,f=o.borderSize;c<this.handler.contentLeft()+l+f?c=this.handler.contentLeft()+l+f:c>this.handler.contentRight()-h-f-u&&(c=this.handler.contentRight()-h-f-u);var g=c-f-l,p=this.handler.contentBottom(),y=c+h+f+u,M=this.handler.contentBottom()+s+2*f+d+v;t.fillStyle=o.backgroundColor,t.fillRect(g,p,y-g,M-p),t.lineWidth=f,t.strokeStyle=o.borderColor,t.strokeRect(g,p,y-g,M-p),t.textBaseline="top",t.font=x(s),t.fillStyle=o.color,t.fillText(n,c,this.handler.contentBottom()+f+d)}}},{key:"renderMainChartTooltip",value:function(t,e,i,a,r,n,o){var s=r.data.base,h=r.data.indicator,c=n.lineColors,l=this.getRenderIndicatorTooltipData(e,i,h,o);if(s.showType===_.FIXED){var u=s.text.marginTop;this.renderMainChartFixedBaseDataTooltipText(t,u,e,s,o),a&&this.renderIndicatorTooltipText(t,u+=s.text.size+s.text.marginBottom+r.data.indicator.text.marginTop,l,h,c)}else this.renderMainChartFloatRectText(t,e,a?l:{},s,h,c,o);a&&this.renderIndicatorLineCircle(t,i,this.candleHandler.contentTop(),l.values,this.candleYAxisRender,c,r.cross.display)}},{key:"renderIndicatorChartTooltip",value:function(t,e,i,a,r,n,o,s){var h=r.data.indicator,c=this.getRenderIndicatorTooltipData(i,a,h,s),l=n.lineColors;this.renderIndicatorTooltipText(t,e+h.text.marginTop,c,h,l);var u=o?this.candleHandler.height+this.volHandler.contentTop():this.candleHandler.height+this.volHandler.height+this.subIndicatorHandler.contentTop();this.renderIndicatorLineCircle(t,a,u,c.values,o?this.volYAxisRender:this.subIndicatorYAxisRender,l,r.cross.display)}},{key:"renderMainChartFixedBaseDataTooltipText",value:function(t,i,a,r,n){var o=this.getMainChartBaseValues(a,r,n),s=r.text.marginLeft,h=r.text.marginRight,c=r.text.size,l=r.text.color,u=r.labels;t.textBaseline="top",t.font=x(c);var d=this.handler.contentLeft()+s;u.forEach((function(a,r){var n="".concat(a,": "),u=m(c,n);t.fillStyle=l,t.fillText(n,d,i),d+=u;var v,f=o[r]||"--";"object"===e(f)?(v=f.value||"--",t.fillStyle=f.color||l):(t.fillStyle=l,v=f);var g=m(c,v);t.fillText(v,d,i),d+=g+s+h}))}},{key:"renderMainChartFloatRectText",value:function(t,i,a,r,n){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=arguments.length>6?arguments[6]:void 0,h=r.labels,c=this.getMainChartBaseValues(i,r,s),l=r.text.marginLeft,u=r.text.marginRight,d=r.text.marginTop,v=r.text.marginBottom,f=r.text.size,g=r.text.color;t.textBaseline="top";var p=0;h.forEach((function(t,i){var a=c[i]||"--",r=a;"object"===e(a)&&(r=a.value||"--");var n="".concat(t,": ").concat(r),o=m(f,n)+l+u;p=Math.max(p,o)}));var y=a.labels||[],M=a.values||[],k=n.text.marginLeft,L=n.text.marginRight,C=n.text.marginTop,R=n.text.marginBottom,T=n.text.size;y.forEach((function(t,e){var i=M[e]||"--",a="".concat(t,": ").concat(i),r=m(T,a)+k+L;p=Math.max(p,r)}));var I,A=r.floatRect,P=A.borderSize,E=A.paddingLeft,b=A.paddingRight,D=A.paddingTop,S=A.paddingBottom,w=A.left,N=A.right,_=2*P+p+E+b,O=2*P+D+S+(v+d+f)*h.length+(C+R+T)*y.length,Y=this.volHandler.getContentCenter(),F=this.storage.crossPoint;I=F&&Y.x>F.x?this.handler.contentRight()-N-_:this.handler.contentLeft()+w;var B=A.top,H=A.borderRadius;t.lineWidth=P,t.strokeStyle=A.borderColor,t.fillStyle=A.fillColor,this.renderRoundRect(t,I,B,_,O,H),t.stroke(),this.renderRoundRect(t,I,B,_,O,H),t.fill();var G=I+P+E+l,V=B+P+D;t.font=x(f),h.forEach((function(i,a){V+=d,t.textAlign="left",t.fillStyle=g,t.fillText("".concat(i,": "),G,V);var r,n=c[a]||"--";t.fillStyle=n.color||g,r="object"===e(n)?n.value||"--":n,t.textAlign="right",t.fillText(r,I+_-P-u-b,V),V+=f+v}));var z=I+P+E+k,W=o.length;t.font=x(T),y.forEach((function(e,i){V+=C,t.textAlign="left",t.fillStyle=o[i%W]||n.text.color,t.fillText("".concat(e.toUpperCase(),": "),z,V),t.textAlign="right",t.fillText(M[i]||"--",I+_-P-L-b,V),V+=T+R})),t.textAlign="left"}},{key:"renderRoundRect",value:function(t,e,i,a,r,n){t.beginPath(),t.moveTo(e+n,i),t.arcTo(e+a,i,e+a,i+r,n),t.arcTo(e+a,i+r,e,i+r,n),t.arcTo(e,i+r,e,i,n),t.arcTo(e,i,e+a,i,n),t.closePath()}},{key:"getMainChartBaseValues",value:function(t,e,i){var a=e.values,r=[];return a?r=T(a)?a(t)||[]:a:(r=[L(t,"timestamp"),L(t,"open"),L(t,"close"),L(t,"high"),L(t,"low"),L(t,"volume")]).forEach((function(t,e){switch(e){case 0:r[e]=nt(t,"YYYY-MM-DD hh:mm");break;case r.length-1:r[e]=W(t,i.volumePrecision);break;default:r[e]=W(t,i.pricePrecision)}})),r}},{key:"renderIndicatorTooltipText",value:function(t,e,i,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],n=i.name,o=i.labels,s=i.values,h=a.text,c=h.marginLeft,l=h.marginRight,u=this.handler.contentLeft()+c,d=h.size,v=a.text.color,f=r.length;t.textBaseline="top",t.font=x(d);var g=m(d,n);t.fillStyle=v,t.fillText(n,u,e),u+=c+g;for(var p=0;o.length>p;p++){var y="".concat(o[p].toUpperCase(),": ").concat(s[p]||"--"),M=m(d,y);t.fillStyle=r[p%f]||v,t.fillText(y,u,e),u+=c+l+M}}},{key:"renderIndicatorLineCircle",value:function(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0,s=this.storage.crossPoint;if(s&&this.storage.graphicMarkType===O.NONE&&e!==P.SAR&&o&&!this.storage.isDragGraphicMark)for(var h=n.length,c=e===P.MACD||e===P.VOL?a.length-1:a.length,l=0;c>l;l++){var u=a[l];if(u||0===u){var d=r.getY(u)+i;t.fillStyle=n[l%h],t.beginPath(),t.arc(s.x,d,3,0,2*Math.PI),t.closePath(),t.fill()}}}},{key:"getRenderIndicatorTooltipData",value:function(t,e,i,a){var r=[],n=[],o=this.indicatorParams[e]||[];switch(e){case P.MA:o.forEach((function(t){n.push("ma".concat(t))}));break;case P.VOL:o.forEach((function(t){n.push("ma".concat(t))})),n.push("num");break;case P.MACD:n=["diff","dea","macd"];break;case P.BOLL:n=["up","mid","dn"];break;case P.BIAS:o.forEach((function(t){n.push("bias".concat(t))}));break;case P.BRAR:n=["br","ar"];break;case P.CCI:n=["cci"];break;case P.CR:n=["cr","ma1","ma2","ma3","ma4"];break;case P.DMA:n=["dif","difMa"];break;case P.DMI:n=["mdi","pdi","adx","adxr"];break;case P.KDJ:n=["k","d","j"];break;case P.RSI:o.forEach((function(t){n.push("rsi".concat(t))}));break;case P.PSY:n=["psy"];break;case P.TRIX:n=["trix","maTrix"];break;case P.OBV:n=["obv","maObv"];break;case P.VR:n=["vr","maVr"];break;case P.WR:n=["wr1","wr2","wr3"];break;case P.MTM:n=["mtm","mtmMa"];break;case P.EMV:n=["emv","maEmv"];break;case P.SAR:n=["sar"]}var s="";if(n.length>0){s="".concat(e),o&&R(o)&&o.length>0&&(s="".concat(s,"(").concat(o.join(","),")"));var h=L(t,e.toLowerCase());n.forEach((function(t){r.push(L(h,t))}));var c=ot(a.pricePrecision,a.volumePrecision)[e];r.forEach((function(t,e){r[e]=W(t,c)}))}return{labels:n,values:r,name:s}}}]),a}(k),ht=function(t){function e(t,a,r,n,o,s,h,l,d){var v;return i(this,e),(v=u(this,c(e).call(this,t,a))).mainChart=r,v.volChart=n,v.subIndicatorChart=o,v.storage=h,v.tooltipRender=new st(v.handler,h,l,r.handler,n.handler,o.handler,r.yAxisRender,n.yAxisRender,o.yAxisRender),v.precision=d,v}return h(e,t),r(e,[{key:"draw",value:function(){var t=this.storage.dataList[this.storage.tooltipDataPos]||{},e=this.style.tooltip;if(this.storage.graphicMarkType!==O.NONE||this.storage.isDragGraphicMark||(this.tooltipRender.renderCrossHorizontalLine(this.ctx,this.mainChart.indicatorType,this.subIndicatorChart.indicatorType,this.style.yAxis.position===b.LEFT,this.style.yAxis.tick.text.position===D.OUTSIDE,e,this.precision),this.tooltipRender.renderCrossVerticalLine(this.ctx,t,e)),this.storage.dataList.length>0){var i=e.data;if(i.displayRule===N.ALWAYS||i.displayRule===N.FOLLOW_CROSS&&this.storage.crossPoint){var a=this.style.indicator;this.tooltipRender.renderMainChartTooltip(this.ctx,t,this.mainChart.indicatorType,this.mainChart.chartType===S.CANDLE,e,a,this.precision),this.volChart.indicatorType!==P.NO&&this.tooltipRender.renderIndicatorChartTooltip(this.ctx,this.mainChart.handler.height,t,P.VOL,e,a,!0,this.precision),this.subIndicatorChart.indicatorType!==P.NO&&this.tooltipRender.renderIndicatorChartTooltip(this.ctx,this.mainChart.handler.height+this.volChart.handler.height,t,this.subIndicatorChart.indicatorType,e,a,!1,this.precision)}}}}]),e}(M),ct=function(t){function e(){return i(this,e),u(this,c(e).apply(this,arguments))}return h(e,t),r(e,[{key:"renderAxisLine",value:function(t,e){e.display&&e.line.display&&(t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),t.moveTo(this.handler.contentLeft(),this.handler.contentBottom()),t.lineTo(this.handler.contentRight(),this.handler.contentBottom()),t.stroke(),t.closePath())}},{key:"renderAxisLabels",value:function(t,e,i){var a=e.tick.text;if(e.display&&a.display){var r,n=i.replace(/[1-9]/,"").toUpperCase();switch(n){case"D":case"W":r="YYYY-MM-DD";break;case"M":r="YYYY-MM";break;case"Y":r="YYYY";break;default:r="hh:mm"}var o=e.tick.line;t.textBaseline="top",t.font=x(a.size),t.textAlign="center",t.fillStyle=a.color;var s=this.handler.contentBottom()+a.margin;o.display&&(s+=o.length);for(var h=this.values.length,c=0;h>c;c++){var l=this.values[c].x,u=this.storage.dataList[parseInt(this.values[c].v)].timestamp,d=nt(u,r);if(c!==h-1){var v=this.storage.dataList[parseInt(this.values[c+1].v)].timestamp;if("D"===n||"W"===n){var f=nt(u,"YYYY-MM");f!==nt(v,"YYYY-MM")&&(d=f)}else if("M"===n){var g=nt(u,"YYYY");g!==nt(v,"YYYY")&&(d=g)}else if(!n){var p=nt(u,"MM-DD");p!==nt(v,"MM-DD")&&(d=p)}}t.fillText(d,l,s)}}}},{key:"renderSeparatorLines",value:function(t,e){if(e.display&&e.separatorLine.display){t.strokeStyle=e.separatorLine.color,t.lineWidth=e.separatorLine.size,e.separatorLine.style===E.DASH&&t.setLineDash(e.separatorLine.dashValue);for(var i=0;this.values.length>i;i++){var a=this.values[i].x;t.beginPath(),t.moveTo(a,this.handler.contentTop()),t.lineTo(a,this.handler.contentBottom()),t.stroke(),t.closePath()}t.setLineDash([])}}},{key:"renderTickLines",value:function(t,e){var i=e.tick.line;if(e.display&&i.display){t.lineWidth=i.size,t.strokeStyle=i.color;for(var a=this.handler.contentBottom(),r=a+i.length,n=0;this.values.length>n;n++){var o=this.values[n].x;t.beginPath(),t.moveTo(o,a),t.lineTo(o,r),t.stroke(),t.closePath()}}}},{key:"computeAxis",value:function(t){var e=this.storage.minPos;this.axisMinimum=e,this.axisMaximum=Math.min(e+this.storage.range-1,this.storage.dataList.length-1),this.axisRange=this.axisMaximum-this.axisMinimum+1,this.computeAxisValues(),this.fixComputeAxisValues(t)}},{key:"fixComputeAxisValues",value:function(t){var e=this.values.length;if(e>0){var i=m(t.tick.text.size,"00-00 00:00"),a=this.getX(this.values[0].v),r=1;if(e>1){var n=this.getX(this.values[1].v),o=Math.abs(n-a);i>o&&(r=Math.ceil(i/o))}for(var s=[],h=0;e>h;h+=r){var c=this.values[h].v,l=this.getX(c);l>this.handler.contentLeft()+i/2&&l<this.handler.contentRight()-i/2&&s.push({v:c,x:l})}this.values=s}}},{key:"getX",value:function(t){return this.handler.contentLeft()+((t-this.storage.minPos)*this.storage.dataSpace+.74*this.storage.dataSpace/2)}}]),e}(j),lt=function(t){function e(t,a,r,n){var o;return i(this,e),(o=u(this,c(e).call(this,t,a))).xAxisRender=new ct(o.handler,r),o.period=n,o}return h(e,t),r(e,[{key:"draw",value:function(){var t=this.style.xAxis;this.xAxisRender.computeAxis(t),this.xAxisRender.renderAxisLine(this.ctx,t),this.xAxisRender.renderAxisLabels(this.ctx,t,this.period.period),this.xAxisRender.renderSeparatorLines(this.ctx,t),this.xAxisRender.renderTickLines(this.ctx,t)}}]),e}(M),ut={};function dt(t,e){for(var i=t.length,a=0;i>a;a++)e(a);return t}function vt(t,e){for(var i=0,a=0;t.length>a;a++){var r=t[a].close-e;i+=r*r}var n=i>0,o=Math.sqrt((i=Math.abs(i))/t.length);return n?o:-1*o}function ft(t){var e=0;if(t&&t.length>0){var i=t.length;e=t[0].high;for(var a=1;i>a;a++)e=Math.max(t[a].high,e)}return e}function gt(t){var e=0;if(t&&t.length>0){var i=t.length;e=t[0].low;for(var a=1;i>a;a++)e=Math.min(t[a].low,e)}return e}function pt(t){var e=0,i=0;if(t&&t.length>0){var a=t.length;e=t[0].high,i=t[0].low;for(var r=1;a>r;r++)e=Math.max(t[r].high,e),i=Math.min(t[r].low,i)}return[e,i]}function yt(t){return t&&R(t)}function mt(t,e){return yt(t)&&t.length===e}function xt(t){return t.match(/(iPad).*OS\s([\d_]+)/)}function Mt(t){return xt(t)||function(t){return!xt(t)&&t.match(/(iPhone\sOS)\s([\d_]+)/)}(t)||function(t){return t.match(/(Android);?[\s\/]+([\d.]+)?/)}(t)}ut.average=function(t){var e=0,i=0;return dt(t,(function(a){e+=t[a].turnover||0,t[a].average=0!==(i+=t[a].volume||0)?e/i:0}))},ut[P.MA]=function(t,e){if(!yt(e))return t;var i=[],a=e.length;return dt(t,(function(r){for(var n={},o=t[r].close,s=0;a>s;s++){i[s]=(i[s]||0)+o;var h=e[s];h>r?n["ma".concat(h)]=i[s]/(r+1):(i[s]-=t[r-h].close,n["ma".concat(h)]=i[s]/h)}t[r].ma=n}))},ut[P.VOL]=function(t,e){if(!yt(e))return t;var i=[],a=e.length;return dt(t,(function(r){for(var n=t[r].volume,o={},s=0;a>s;s++){i[s]=(i[s]||0)+n;var h=e[s];h>r?o["ma".concat(h)]=i[s]/(r+1):(i[s]-=t[r-h].volume,o["ma".concat(h)]=i[s]/h)}o.num=n,t[r].vol=o}))},ut[P.MACD]=function(t,e){if(!mt(e,3))return t;var i,a,r=0,n=0,o=0,s=0,h=0;return dt(t,(function(c){var l=t[c].close;0===c?(i=l,a=l):(i=(2*l+(e[0]-1)*r)/(e[0]+1),a=(2*l+(e[1]-1)*n)/(e[1]+1)),r=i,n=a,h=s=(2*(o=i-a)+h*(e[2]-1))/(e[2]+1),t[c].macd={diff:o,dea:s,macd:2*(o-s)}}))},ut[P.BOLL]=function(t,e){if(!mt(e,1))return t;var i,a,r=0;return dt(t,(function(n){r+=t[n].close,e[0]>n?(i=r/(n+1),a=vt(t.slice(0,n+1),i)):(i=(r-=t[n-e[0]].close)/e[0],a=vt(t.slice(n-(e[0]-1),n+1),i)),t[n].boll={up:i+2*a,mid:i,dn:i-2*a}}))},ut[P.KDJ]=function(t,e){return mt(e,3)?dt(t,(function(o){var s=t[o].close;e[0]-1>o?(r=gt(t.slice(0,o+1)),n=ft(t.slice(0,o+1))):(r=gt(t.slice(o-(e[0]-1),o+1)),n=ft(t.slice(o-(e[0]-1),o+1))),t[o].kdj={k:i=(e[1]-1)/e[1]*(e[0]-1>o?50:t[o-1].kdj.k)+1/e[1]*((s-r)/(n-r==0?1:n-r)*100),d:a=(e[2]-1)/e[2]*(e[0]-1>o?50:t[o-1].kdj.d)+1/e[2]*i,j:3*i-2*a}})):t;var i,a,r,n},ut[P.RSI]=function(t,e){if(!mt(e,3))return t;var i,a,r,o,s,h,c=0,l=0,u=0,d=0,v=0,f=0;return dt(t,(function(g){var p,y=(n(p={},"rsi".concat(e[0]),0),n(p,"rsi".concat(e[1]),0),n(p,"rsi".concat(e[2]),0),p);if(g>0){var m=t[g].close-t[g-1].close;if(m>0)c+=m,u+=m,v+=m;else{var x=Math.abs(m);l+=x,d+=x,f+=x}if(e[0]>g)i=c/(g+1),a=(c+l)/(g+1);else{if(g>e[0]){var M=t[g-e[0]].close-t[g-e[0]-1].close;M>0?c-=M:l-=Math.abs(M)}i=c/e[0],a=(c+l)/e[0]}if(y["rsi".concat(e[0])]=0!==a?i/a*100:0,e[1]>g)r=u/(g+1),o=(u+d)/(g+1);else{if(g>e[1]){var k=t[g-e[1]].close-t[g-e[1]-1].close;k>0?u-=k:d-=Math.abs(k)}r=u/e[1],o=(u+d)/e[1]}if(y["rsi".concat(e[1])]=0!==o?r/o*100:0,e[2]>g)s=v/(g+1),h=(v+f)/(g+1);else{if(g>e[2]){var L=t[g-e[2]].close-t[g-e[2]-1].close;L>0?v-=L:f-=Math.abs(L)}s=v/e[2],h=(v+f)/e[2]}y["rsi".concat(e[2])]=0!==h?s/h*100:0}t[g].rsi=y}))},ut[P.BIAS]=function(t,e){if(!mt(e,3))return t;var i,a,r,n=0,o=0,s=0;return dt(t,(function(h){var c={},l=t[h].close;n+=l,o+=l,s+=l,i=e[0]>h?n/(h+1):(n-=t[h-e[0]].close)/e[0],c["bias".concat(e[0])]=(l-i)/i*100,a=e[1]>h?o/(h+1):(o-=t[h-e[1]].close)/e[1],c["bias".concat(e[1])]=(l-a)/a*100,r=e[2]>h?s/(h+1):(s-=t[h-e[2]].close)/e[2],c["bias".concat(e[2])]=(l-r)/r*100,t[h].bias=c}))},ut[P.BRAR]=function(t,e){if(!mt(e,1))return t;var i=0,a=0,r=0,n=0,o=0,s=0;return dt(t,(function(h){var c=t[h].high,l=t[h].low,u=t[h].open;if(o+=c-u,s+=u-l,h>0){var d=t[h-1].close;if(r+=c-d,n+=d-l,h>e[0]-1){var v=t[h-e[0]].high,f=t[h-e[0]].low,g=t[h-e[0]].open;if(h>e[0]){var p=t[h-e[0]-1].close;r-=v-p,n-=p-f}o-=v-g,s-=g-f}a=0!==s?o/s*100:0,i=0!==n?r/n*100:0}t[h].brar={br:i,ar:a}}))},ut[P.CCI]=function(t,e){if(!mt(e,1))return t;var i,a,r=0,n=[],o=0;return dt(t,(function(s){var h=t[s].close;r+=h;var c=(t[s].high+t[s].low+h)/3;if(e[0]>s)o+=Math.abs((i=r/(s+1))-h),n.push(i),a=o/(s+1);else{var l=t[s-e[0]].close;n.push(i=(r-=l)/e[0]),o+=Math.abs(i-h),a=(o-=Math.abs(n[s-e[0]]-l))/e[0]}t[s].cci={cci:0!==a?(c-i)/a/.015:0}}))},ut[P.DMI]=function(t,e){if(!mt(e,2))return t;var i=0,a=0,r=0,n=0,o=[0],s=0,h=[0],c=0,l=[0],u=0,d=[0],v=0;return dt(t,(function(f){if(f>0){var g=t[f-1].close,p=t[f].high,y=t[f].low,m=p-y,x=Math.abs(p-g),M=Math.abs(y-g),k=p-t[f-1].high,L=t[f-1].low-y,C=Math.max(Math.max(m,x),M);s+=C,o.push(C);var R=k>0&&k>L?k:0;c+=R,h.push(R);var T=L>0&&L>k?L:0;u+=T,l.push(T),f>e[0]-1&&(s-=o[f-e[0]],c-=h[f-e[0]],u-=l[f-e[0]]),0===s?(i=0,a=0):(i=100*c/s,a=100*u/s);var I=Math.abs(a-i)/(a+i)*100;if(v+=I,d.push(I),e[1]>f)n=r=v/(f+1);else{var A=d[f-e[1]];n=((r=(v-=A)/e[1])+A)/2}}t[f].dmi={pdi:i,mdi:a,adx:r,adxr:n}}))},ut[P.CR]=function(t,e){if(!mt(e,5))return t;var i,a,r,n,o=0,s=0,h=0,c=0,l=[],u=0,d=[],v=0,f=[],g=0,p=[];return dt(t,(function(y){if(y>0){var m=(t[y-1].high+t[y-1].close+t[y-1].low+t[y-1].open)/4,x=t[y].high-m;0>x&&(x=0),s+=x;var M=m-t[y].low;if(0>M&&(M=0),h+=M,y>e[0]){var k=(t[y-e[0]-1].high+t[y-e[0]-1].low+t[y-e[0]-1].close+t[y-e[0]-1].open)/4,L=t[y-e[0]].high-k;0>L&&(L=0);var C=k-t[y-e[0]].low;0>C&&(C=0),s-=L,h-=C}0!==h&&(o=s/h*100);var R=(t[y-1].high+t[y-1].low+t[y-1].close)/3,T=t[y].high-R;s+=T>0?T:0;var I=R-t[y].low;h+=I>0?I:0}c+=o,u+=o,v+=o,g+=o,i=e[1]>y?c/(y+1):(c-=t[y-e[1]].cr.cr)/e[1],l.push(i),a=e[2]>y?u/(y+1):(u-=t[y-e[2]].cr.cr)/e[2],d.push(a),r=e[3]>y?v/(y+1):(v-=t[y-e[3]].cr.cr)/e[3],f.push(r),n=e[4]>y?g/(y+1):(g-=t[y-e[4]].cr.cr)/e[4],p.push(n),t[y].cr={cr:o,ma1:5>y?l[0]:l[y-5],ma2:9>y?d[0]:d[y-9],ma3:17>y?f[0]:f[y-17],ma4:25>y?p[0]:p[y-25]}}))},ut[P.PSY]=function(t,e){if(!mt(e,1))return t;var i=0,a=0;return dt(t,(function(r){r>0&&(a+=t[r].close-t[r-1].close>0?1:0,e[0]>r?i=a/(r+1)*100:(r>e[0]&&(a-=t[r-e[0]+1].close-t[r-e[0]].close>0?1:0),i=a/e[0]*100)),t[r].psy={psy:i}}))},ut[P.DMA]=function(t,e){if(!mt(e,3))return t;var i,a,r,n,o=0,s=0,h=0;return dt(t,(function(c){var l=t[c].close;o+=l,s+=l,r=e[0]>c?o/(c+1):(o-=t[c-e[0]].close)/e[0],n=e[1]>c?s/(c+1):(s-=t[c-e[1]].close)/e[1],h+=i=r-n,a=e[2]>c?h/(c+1):(h-=t[c-e[2]].dma.dif)/e[2],t[c].dma={dif:i,difMa:a}}))},ut[P.TRIX]=function(t,e){if(!mt(e,2))return t;var i,a,r,n,o=0,s=0,h=0,c=0,l=0,u=[];return dt(t,(function(d){var v=t[d].close;if(0===d)n=r=a=v;else{n=(2*(r=(2*(a=(2*v+(e[0]-1)*h)/(e[0]+1))+(e[0]-1)*c)/(e[0]+1))+(e[0]-1)*l)/(e[0]+1);var f=u[d-1];o=0===f?0:(n-f)/f*100}h=a,c=r,l=n,u.push(n),s+=o,i=e[1]>d?s/(d+1):(s-=t[d-e[1]].trix.trix)/e[1],t[d].trix={trix:o,maTrix:i}}))},ut[P.OBV]=function(t,e){if(!mt(e,1))return t;var i,a,r=0,n=0;return dt(t,(function(o){var s=t[o].volume;if(0===o)i=s,n+=s;else{var h=t[o-1].close,c=t[o].close;n+=c>h?s:-s,i=c===h?0:n}r+=i,a=e[0]>o?r/(o+1):(r-=t[o-e[0]].obv.obv)/e[0],t[o].obv={obv:i,maObv:a}}))},ut[P.VR]=function(t,e){if(!mt(e,2))return t;var i,a=0,r=0,n=0,o=0,s=0;return dt(t,(function(h){var c=t[h].close,l=t[h].open,u=t[h].volume;if(c>l?a+=u:l>c?r+=u:n+=u,h>e[0]-1){var d=t[h-e[0]].close,v=t[h-e[0]].open,f=t[h-e[0]].volume;d>v?a-=f:v>d?r-=f:n-=f}var g=r+.5*n;0!==g&&(o=(a+.5*n)/g*100),s+=o,i=e[1]>h?s/(h+1):(s-=t[h-e[1]].vr.vr)/e[1],t[h].vr={vr:o,maVr:i}}))},ut[P.WR]=function(t,e){if(!mt(e,3))return t;var i,a,r,n,o,s=Number.MIN_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;return dt(t,(function(v){var f=t[v].close,g=t[v].high,p=t[v].low;if(e[0]>v)s=Math.max(g,s),h=Math.min(p,h);else{var y=pt(t.slice(v-e[0],v));s=y[0],h=y[1]}if(i=0!==(r=s-h)?(s-f)/r*100:0,e[1]>v)c=Math.max(g,c),l=Math.min(p,l);else{var m=pt(t.slice(v-e[1],v));c=m[0],l=m[1]}if(a=0!==(n=c-l)?(c-f)/n*100:0,e[2]>v)u=Math.max(g,u),d=Math.min(p,d);else{var x=pt(t.slice(v-e[2],v));u=x[0],d=x[1]}t[v].wr={wr1:i,wr2:a,wr3:0!==(o=u-d)?(u-f)/o*100:0}}))},ut[P.MTM]=function(t,e){if(!mt(e,2))return t;var i,a,r=0;return dt(t,(function(n){e[0]>n?(i=0,a=0):(r+=i=t[n].close-t[n-e[0]].close,e[0]+e[1]>n?a=r/(n-e[0]+1):(a=r/e[1],r-=t[n-e[1]].mtm.mtm));t[n].mtm={mtm:i,mtmMa:a}}))},ut[P.EMV]=function(t,e){if(!mt(e,2))return t;var i,a=0,r=0,n=0,o=[];return dt(t,(function(s){if(s>0){var h=t[s].high,c=t[s].low;n=((h+c)/2-(t[s-1].high+t[s-1].low)/2)*(h-c)/t[s].turnover}o.push(n),e[0]>s?a+=n:a-=o[s-e[0]],r+=a,i=e[1]>s?r/(s+1):(r-=t[s-e[1]].emv.emv)/e[1],t[s].emv={emv:a,maEmv:i}}))},ut[P.SAR]=function(t,e){if(!mt(e,3))return t;var i=e[0]/100,a=e[1]/100,r=e[2]/100,n=i,o=-100,s=!1,h=0;return dt(t,(function(e){var c=h,l=t[e].high,u=t[e].low;if(s){(-100===o||l>o)&&(o=l,n=Math.min(n+a,r)),h=c+n*(o-c);var d=Math.min(t[Math.max(1,e)-1].low,u);h>t[e].low?(h=o,n=i,o=-100,s=!s):h>d&&(h=d)}else{(-100===o||o>u)&&(o=u,n=Math.min(n+a,r)),h=c+n*(o-c);var v=Math.max(t[Math.max(1,e)-1].high,l);t[e].high>h?(h=o,n=0,o=-100,s=!s):v>h&&(h=v)}t[e].sar={sar:h}}))};var kt=function(){function t(e,a,r,n,o,s){i(this,t),this.tooltipChart=e,this.mainChart=a,this.volChart=r,this.subIndicatorChart=n,this.xAxisChart=o,this.storage=s,this.handler=e.handler}return r(t,[{key:"drag",value:function(t,e,i){var a=this.storage.dataSpace,r=this.storage.dataList.length,n=this.storage.range,o=this.storage.minPos,s=e-t.x;if(s>a/2){if(0===o||n>r)return!1;t.x=e;var h=+Math.abs(s/a).toFixed(0);return 0===h&&(h=1),0>(o-=h)&&(o=0),this.storage.minPos=o,this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),0===o&&i(),!0}if(0-a/2>s){if(o+n===r||n>r)return!1;t.x=e;var c=+Math.abs(s/a).toFixed(0);return 0===c&&(c=1),r-n>(o+=c)||(o=r-n),this.storage.minPos=o,this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),!0}return!1}},{key:"zoom",value:function(t,e,i,a){var r=this.storage.range,n=this.storage.maxRange,o=this.storage.minRange;if(t){if(r>=n)return!1}else if(o>=r)return!1;var s=i+a-(r=Math.min(Math.max(r=+(a/e).toFixed(0),o),n));return(s+r>this.storage.dataList.length||0>s)&&(s=0),this.storage.range=r,this.storage.minPos=s,this.storage.space(this.handler.contentRight()-this.handler.contentLeft()),this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),!0}},{key:"cross",value:function(t){this.storage.crossPoint={x:t.x,y:t.y},this.storage.calcCurrentTooltipDataPos(this.handler.contentLeft(),t.x),this.tooltipChart.flush()}}]),t}();function Lt(t,e){return!(t.x<e.contentLeft()||t.x>e.contentRight()||t.y<e.contentTop()||t.y>e.contentBottom())}function Ct(t,e){var i=e.getBoundingClientRect();return{x:Math.round(t.clientX-i.left),y:Math.round(t.clientY-i.top)}}function Rt(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0,t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1}function Tt(t,e,i,a){var r=t-e,n=i-a;return Math.sqrt(r*r+n*n)}function It(t,e){if(2>t.targetTouches.length)return 0;var i=Ct(t.targetTouches[0],e),a=Ct(t.targetTouches[1],e),r=Math.abs(i.x-a.x),n=Math.abs(i.y-a.y);return Math.sqrt(r*r+n*n)}function At(t,e){var i=Ct(t.targetTouches[0],e),a=Ct(t.targetTouches[1],e);return Math.abs(i.x-a.x)}var Pt=0,Et=4,bt=5,Dt=function(t){function e(t,a,r,n,o,s){var h;return i(this,e),(h=u(this,c(e).call(this,t,a,r,n,o,s))).touchMode=Pt,h.touchStartPoint={x:0,y:0},h.touchMovePoint={x:0,y:0},h.touchCrossPoint={x:0,y:0},h.savedDist=1,h.savedXDist=1,h.touchRange=s.range,h.touchStartPosition=s.minPos,h.delayTimeout=null,h.delayActiveCross=function(){h.touchMode!==Pt&&h.touchMode!==bt||h.tooltipChart&&(h.touchMode=Et,h.touchCrossPoint={x:h.touchStartPoint.x,y:h.touchStartPoint.y},h.cross(h.touchCrossPoint))},h}return h(e,t),r(e,[{key:"touchStart",value:function(t){if(0!==this.storage.dataList.length)if(1===t.targetTouches.length){var e=Ct(t.targetTouches[0],this.tooltipChart.canvasDom);if(this.touchStartPoint={x:e.x,y:e.y},this.touchMovePoint={x:e.x,y:e.y},!Lt(this.touchStartPoint,this.handler))return;if(this.touchMode===Et)Rt(t),10>Tt(e.x,this.touchCrossPoint.x,e.y,this.touchCrossPoint.y)?this.performCross(t):(this.touchMode=bt,this.storage.crossPoint=null,this.tooltipChart.flush());else this.touchMode=Pt;this.removeDelayActiveCross(),this.postDelayDelayActiveCross()}else if(t.targetTouches.length>1){if(!Lt(this.touchStartPoint,this.handler))return;this.touchMode!==Et&&(Rt(t),this.savedDist=It(t,this.tooltipChart.canvasDom),this.savedXDist=At(t,this.tooltipChart.canvasDom),this.savedDist>3&&(this.touchMode=2),this.touchRange=this.storage.range,this.touchStartPosition=this.storage.minPos)}}},{key:"touchMove",value:function(t,e){if(Lt(this.touchStartPoint,this.handler)&&0!==this.storage.dataList.length&&!this.waitingForMouseMoveAnimationFrame){switch(this.waitingForMouseMoveAnimationFrame=!0,this.touchMode){case 2:Rt(t),this.performZoom(t);break;case 1:Rt(t);var i=Ct(t.targetTouches[0],this.tooltipChart.canvasDom);this.drag(this.touchMovePoint,i.x,e);break;case Et:Rt(t),this.performCross(t);break;case bt:this.removeDelayActiveCross();break;case Pt:var a=Ct(t.targetTouches[0],this.tooltipChart.canvasDom);if(Math.abs(Tt(a.x,this.touchStartPoint.x,a.y,this.touchStartPoint.y))>10){var r=Math.abs(a.x-this.touchStartPoint.x);Math.abs(a.y-this.touchStartPoint.y)>r||(Rt(t),this.storage.crossPoint=null,this.touchMode=1,this.tooltipChart.flush())}this.removeDelayActiveCross()}this.waitingForMouseMoveAnimationFrame=!1}}},{key:"touchEnd",value:function(t){Lt(this.touchStartPoint,this.handler)&&0!==this.storage.dataList.length&&(Rt(t),t.targetTouches.length>0?this.touchMode===Et?this.performCross(t):this.touchMode=3:(this.removeDelayActiveCross(),this.touchMode!==Et&&(this.touchMode===Pt?(this.touchMode=Et,this.touchCrossPoint=s({},this.touchStartPoint),this.cross(this.touchCrossPoint)):(this.touchMode=Pt,this.storage.crossPoint=null,this.tooltipChart.flush()))))}},{key:"performZoom",value:function(t){if(t.targetTouches.length>1&&It(t,this.tooltipChart.canvasDom)>10){var e=At(t,this.tooltipChart.canvasDom)/this.savedXDist;this.zoom(1>e,e,this.touchStartPosition,this.touchRange)}}},{key:"performCross",value:function(t){var e=Ct(t.targetTouches[0],this.tooltipChart.canvasDom);this.touchCrossPoint={x:e.x,y:e.y},this.cross(this.touchCrossPoint)}},{key:"postDelayDelayActiveCross",value:function(){this.delayTimeout=setTimeout(this.delayActiveCross,200)}},{key:"removeDelayActiveCross",value:function(){this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null)}}]),e}(kt),St="cross",wt=function(t){function e(t,a,r,n,o,s,h){var l;return i(this,e),(l=u(this,c(e).call(this,t,a,r,n,o,h))).markerChart=s,l.mouseMode=St,l.mouseDownPoint={x:0,y:0},l.documentMouseUp=function(){document.removeEventListener("mouseup",l.documentMouseUp,!1),l.mouseMode=St,l.storage.isDragGraphicMark=!1,l.tooltipChart.flush()},l}return h(e,t),r(e,[{key:"mouseDown",value:function(t){if(0!==this.storage.dataList.length&&0===t.button){if(!Lt(Ct(t,this.tooltipChart.canvasDom),this.handler))return;document.addEventListener("mouseup",this.documentMouseUp,!1),this.mouseDownPoint.x=t.x,this.mouseDownPoint.y=t.y,this.mouseMode="drag",this.storage.crossPoint=null,this.tooltipChart.flush()}}},{key:"mouseUp",value:function(t){if(0!==this.storage.dataList.length){Rt(t);var e=Ct(t,this.tooltipChart.canvasDom);Lt(e,this.handler)&&(document.removeEventListener("mouseup",this.documentMouseUp,!1),this.mouseMode=St,this.storage.crossPoint={x:e.x,y:e.y},this.storage.isDragGraphicMark=!1,this.tooltipChart.flush())}}},{key:"mouseLeave",value:function(t){0!==this.storage.dataList.length&&(Rt(t),this.storage.crossPoint=null,this.tooltipChart.flush())}},{key:"mouseMove",value:function(t,e){if(0!==this.storage.dataList.length){Rt(t);var i=Ct(t,this.tooltipChart.canvasDom);if(!Lt(i,this.handler))return this.storage.crossPoint=null,void this.tooltipChart.flush();this.waitingForMouseMoveAnimationFrame||(this.waitingForMouseMoveAnimationFrame=!0,"drag"===this.mouseMode?this.storage.isDragGraphicMark?this.cross(i):this.drag(this.mouseDownPoint,t.x,e)&&this.markerChart.flush():this.mouseMode===St&&this.cross(i),this.waitingForMouseMoveAnimationFrame=!1)}}},{key:"mouseWheel",value:function(t){if(0!==this.storage.dataList.length&&!this.storage.isDragGraphicMark){Rt(t);var e=Ct(t,this.tooltipChart.canvasDom);if(Lt(e,this.handler)){var i=this.storage.minPos,a=this.storage.range,r=1===Math.max(-1,Math.min(1,t.wheelDelta||-t.deltaY));this.zoom(r,r?.95:1.05,i,a)&&(this.cross(e),this.markerChart.flush())}}}}]),e}(kt),Nt=function(){function t(e,a,r){i(this,t),this.storage=e,this.graphicMarkChart=a,this.handler=a.handler,this.yRender=a.graphicMarkRender.yRender,this.style=r,this.noneMarkerMouseDownFlag=!1,this.noneMarkerMouseDownActiveData={markKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1}}return r(t,[{key:"mouseUp",value:function(){this.noneMarkerMouseDownFlag=!1,this.noneMarkerMouseDownActiveData={markKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1}}},{key:"mouseDown",value:function(t){var e=Ct(t,this.graphicMarkChart.canvasDom);if(this.storage.graphicMarkPoint=s({},e),Lt(e,this.handler)){var i=this.storage.graphicMarkType;switch(i){case O.HORIZONTAL_STRAIGHT_LINE:case O.VERTICAL_STRAIGHT_LINE:case O.STRAIGHT_LINE:case O.HORIZONTAL_RAY_LINE:case O.VERTICAL_RAY_LINE:case O.RAY_LINE:case O.HORIZONTAL_SEGMENT_LINE:case O.VERTICAL_SEGMENT_LINE:case O.SEGMENT_LINE:case O.PRICE_LINE:case O.FIBONACCI_LINE:this.twoStepMarkerMouseDown(t,i);break;case O.PRICE_CHANNEL_LINE:case O.PARALLEL_STRAIGHT_LINE:this.threeStepMarkerMouseDown(t,i);break;case O.NONE:this.noneMarkerMouseDown(t)}}}},{key:"twoStepMarkerMouseDown",value:function(t,e){var i=this;this.markerMouseDown(t,e,(function(t){switch(t.drawStep){case Y:t.drawStep=F;break;case F:t.drawStep=H,i.storage.graphicMarkType=O.NONE}}))}},{key:"threeStepMarkerMouseDown",value:function(t,e){var i=this;this.markerMouseDown(t,e,(function(t){switch(t.drawStep){case Y:t.drawStep=F;break;case F:t.drawStep=B;break;case B:t.drawStep=H,i.storage.graphicMarkType=O.NONE}}))}},{key:"markerMouseDown",value:function(t,e,i){var a=this.storage.graphicMarkDatas[e];if(2===t.button)a.splice(a.length-1,1),this.storage.graphicMarkType=O.NONE;else{var r=a[a.length-1];i(r),a[a.length-1]=r}this.storage.graphicMarkDatas[e]=a,this.graphicMarkChart.flush()}},{key:"noneMarkerMouseDown",value:function(t){this.findNoneMarkerMouseDownActiveData(t);var e=this.noneMarkerMouseDownActiveData.markKey,i=this.noneMarkerMouseDownActiveData.dataIndex;if(e&&-1!==i)if(2===t.button){var a=this.storage.graphicMarkDatas[e];a.splice(i,1),this.storage.graphicMarkDatas[e]=a,this.graphicMarkChart.flush()}else this.noneMarkerMouseDownActiveData.onCircle&&(this.noneMarkerMouseDownFlag=!0,this.storage.isDragGraphicMark=!0)}},{key:"findNoneMarkerMouseDownActiveData",value:function(t){for(var i=this,a=Ct(t,this.graphicMarkChart.canvasDom),r=Object.keys(this.storage.graphicMarkDatas),n=function(t){var e=r[t];switch(e){case O.HORIZONTAL_STRAIGHT_LINE:case O.PRICE_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,a,(function(t){return J(t[0],{x:i.handler.contentRight(),y:t[0].y},a)})))return{v:void 0};break;case O.VERTICAL_STRAIGHT_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,a,(function(t){return J(t[0],{x:t[0].x,y:i.handler.contentBottom()},a)})))return{v:void 0};break;case O.STRAIGHT_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,a,(function(t){return J(t[0],t[1],a)})))return{v:void 0};break;case O.HORIZONTAL_RAY_LINE:case O.VERTICAL_RAY_LINE:case O.RAY_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,a,(function(t){return $(t[0],t[1],a)})))return{v:void 0};break;case O.HORIZONTAL_SEGMENT_LINE:case O.VERTICAL_SEGMENT_LINE:case O.SEGMENT_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,a,(function(t){return Q(t[0],t[1],a)})))return{v:void 0};break;case O.PRICE_CHANNEL_LINE:case O.PARALLEL_STRAIGHT_LINE:case O.FIBONACCI_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,a,(function(t){var r=[];switch(e){case O.PRICE_CHANNEL_LINE:r=et(t,i.handler,!0);break;case O.PARALLEL_STRAIGHT_LINE:r=et(t,i.handler);break;case O.FIBONACCI_LINE:r=it(t,i.handler)}for(var n=!1,o=0;r.length>o;o++){var s=r[o];if(n=J(s[0],s[1],a))return n}return n})))return{v:void 0}}},o=0;r.length>o;o++){var s=n(o);if("object"===e(s))return s.v}}},{key:"realFindNoneMarkerMouseDownActiveData",value:function(t,e,i){var a=this;return this.storage.graphicMarkDatas[t].forEach((function(r,n){var o=[],s=!1,h=-1;r.points.forEach((function(t,i){var r=(t.xPos-a.storage.minPos)*a.storage.dataSpace,n=a.yRender.getY(t.price);o.push({x:r,y:n});var c=tt({x:r,y:n},a.style.marker.point.radius,e);c&&(h=i),s||(s=c)}));var c=i(o,e);if(c||s)return a.noneMarkerMouseDownActiveData={markKey:t,dataIndex:n,onLine:c,onCircle:s,pointIndex:h},!0})),!1}},{key:"mouseMove",value:function(t){var e=Ct(t,this.graphicMarkChart.canvasDom);if(this.storage.graphicMarkPoint=s({},e),Lt(e,this.handler)&&!this.waitingForMouseMoveAnimationFrame){this.waitingForMouseMoveAnimationFrame=!0;var i=this.storage.graphicMarkType;switch(i){case O.HORIZONTAL_STRAIGHT_LINE:case O.VERTICAL_STRAIGHT_LINE:case O.PRICE_LINE:this.onePointMarkerMouseMove(e,i);break;case O.STRAIGHT_LINE:case O.RAY_LINE:case O.SEGMENT_LINE:case O.FIBONACCI_LINE:this.twoPointMarkerMouseMove(e,i);break;case O.HORIZONTAL_RAY_LINE:case O.HORIZONTAL_SEGMENT_LINE:this.twoPointMarkerMouseMove(e,i,(function(t,e){t.points[0].price=e.price}));break;case O.VERTICAL_RAY_LINE:case O.VERTICAL_SEGMENT_LINE:this.twoPointMarkerMouseMove(e,i,(function(t,e){t.points[0].xPos=e.xPos}));break;case O.PRICE_CHANNEL_LINE:case O.PARALLEL_STRAIGHT_LINE:this.threePointMarkerMouseMove(e,i);break;case O.NONE:this.noneMarkerMouseMove(e)}this.waitingForMouseMoveAnimationFrame=!1}}},{key:"onePointMarkerMouseMove",value:function(t,e){var i=this;this.markerMouseMove(t,e,(function(e,a){var r=i.storage.minPos+(t.x-i.handler.contentLeft())/i.storage.dataSpace,n=i.yRender.getValue(t.y);switch(a.drawStep){case H:e.push({points:[{xPos:r,price:n}],drawStep:Y});break;case Y:case F:a.points[0].xPos=r,a.points[0].price=n,e[e.length-1]=a}}))}},{key:"twoPointMarkerMouseMove",value:function(t,e,i){var a=this;this.markerMouseMove(t,e,(function(e,r){var n=a.storage.minPos+(t.x-a.handler.contentLeft())/a.storage.dataSpace,o=a.yRender.getValue(t.y);switch(r.drawStep){case H:e.push({points:[{xPos:n,price:o},{xPos:n,price:o}],drawStep:Y});break;case Y:r.points[0]={xPos:n,price:o},r.points[1]={xPos:n,price:o},e[e.length-1]=r;break;case F:r.points[1]={xPos:n,price:o},T(i)&&i(r,{xPos:n,price:o}),e[e.length-1]=r}}))}},{key:"threePointMarkerMouseMove",value:function(t,e,i){var a=this;this.markerMouseMove(t,e,(function(e,r){var n=a.storage.minPos+(t.x-a.handler.contentLeft())/a.storage.dataSpace,o=a.yRender.getValue(t.y);switch(r.drawStep){case H:e.push({points:[{xPos:n,price:o},{xPos:n,price:o}],drawStep:Y});break;case Y:r.points[0]={xPos:n,price:o},r.points[1]={xPos:n,price:o},e[e.length-1]=r;break;case F:T(i)&&i(r,{xPos:n,price:o}),r.points[1]={xPos:n,price:o},e[e.length-1]=r;break;case B:r.points[2]={xPos:n,price:o},e[e.length-1]=r}}))}},{key:"markerMouseMove",value:function(t,e,i){var a=this.storage.graphicMarkDatas[e];i(a,a[a.length-1]||{drawStep:H}),this.storage.graphicMarkDatas[e]=a,this.graphicMarkChart.flush()}},{key:"noneMarkerMouseMove",value:function(t){if(this.noneMarkerMouseDownFlag){var e=this.noneMarkerMouseDownActiveData.markKey,i=this.noneMarkerMouseDownActiveData.dataIndex;if(e&&-1!==i){var a=this.storage.graphicMarkDatas[e];switch(e){case O.HORIZONTAL_STRAIGHT_LINE:case O.VERTICAL_STRAIGHT_LINE:case O.PRICE_LINE:case O.STRAIGHT_LINE:case O.RAY_LINE:case O.SEGMENT_LINE:case O.PRICE_CHANNEL_LINE:case O.PARALLEL_STRAIGHT_LINE:case O.FIBONACCI_LINE:var r=this.noneMarkerMouseDownActiveData.pointIndex;-1!==r&&(a[i].points[r].xPos=(t.x-this.handler.contentLeft())/this.storage.dataSpace+this.storage.minPos,a[i].points[r].price=this.yRender.getValue(t.y));break;case O.HORIZONTAL_RAY_LINE:case O.HORIZONTAL_SEGMENT_LINE:var n=this.noneMarkerMouseDownActiveData.pointIndex;if(-1!==n){var o=this.yRender.getValue(t.y);a[i].points[n].xPos=(t.x-this.handler.contentLeft())/this.storage.dataSpace+this.storage.minPos,a[i].points[0].price=o,a[i].points[1].price=o}break;case O.VERTICAL_RAY_LINE:case O.VERTICAL_SEGMENT_LINE:var s=this.noneMarkerMouseDownActiveData.pointIndex;if(-1!==s){var h=(t.x-this.handler.contentLeft())/this.storage.dataSpace+this.storage.minPos;a[i].points[0].xPos=h,a[i].points[1].xPos=h,a[i].points[s].price=this.yRender.getValue(t.y)}}this.storage.graphicMarkDatas[e]=a}}this.graphicMarkChart.flush()}}]),t}(),_t=function(t){function e(t,a,r,n,o,s,h){var l;return i(this,e),(l=u(this,c(e).call(this,n,t,a,r,s,h))).markerChart=o,l}return h(e,t),r(e,[{key:"keyDown",value:function(t,e){if(Rt(t),37===t.keyCode||39===t.keyCode){var i=!1;37===t.keyCode?this.storage.minPos>0&&(this.storage.minPos--,this.storage.tooltipDataPos--,i=!0):this.storage.dataList.length-this.storage.range>this.storage.minPos&&(this.storage.minPos++,this.storage.tooltipDataPos++,i=!0),i&&(this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),this.markerChart.flush(),this.storage.crossPoint&&this.tooltipChart.flush(),0===this.storage.minPos&&e())}else if(38===t.keyCode||40===t.keyCode){var a=!0,r=.95;38===t.keyCode&&(a=!1,r=1.05),this.zoom(a,r,this.storage.minPos,this.storage.range)&&(this.storage.crossPoint&&this.cross(this.storage.crossPoint),this.markerChart.flush())}}}]),e}(kt),Ot="development"===process.env.NODE_ENV,Yt=function(){function t(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t),this.noMore=!0,this.style={realTime:{timeLine:{color:"#1e88e5",size:1,areaFillColor:"rgba(30, 136, 229, 0.08)"},averageLine:{display:!0,color:"#F5A623",size:1}},candle:{style:w.SOLID,increasingColor:"#26A69A",decreasingColor:"#EF5350"},highestPriceMark:{display:!0,color:"#D9D9D9",text:{margin:5,size:10}},lowestPriceMark:{display:!0,color:"#D9D9D9",text:{margin:5,size:10}},lastPriceMark:{display:!0,increasingColor:"#26A69A",decreasingColor:"#EF5350",line:{display:!0,style:E.DASH,dashValue:[4,4],size:1},text:{display:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF"}},indicator:{lineSize:1,increasingColor:"#26A69A",decreasingColor:"#EF5350",lineColors:["#D9D9D9","#F5A623","#F601FF","#1587DD","#1e88e5"]},xAxis:{display:!0,maxHeight:50,minHeight:30,line:{display:!0,color:"#888888",size:1},tick:{text:{display:!0,color:"#D9D9D9",size:12,margin:3},line:{display:!0,size:1,length:3,color:"#888888"}},separatorLine:{display:!1,size:1,color:"#393939",style:E.DASH,dashValue:[2,2]}},yAxis:{display:!0,position:b.RIGHT,maxWidth:80,minWidth:60,line:{display:!0,color:"#888888",size:1},tick:{text:{display:!0,position:D.OUTSIDE,color:"#D9D9D9",size:12,margin:3},line:{display:!0,size:1,length:3,color:"#888888"}},separatorLine:{display:!0,size:1,color:"#393939",style:E.DASH,dashValue:[2,2]}},tooltip:{cross:{display:!0,line:{style:E.DASH,dashValue:[4,2],size:1,color:"#888888"},text:{horizontal:{color:"#D9D9D9",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"},vertical:{color:"#D9D9D9",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}}},data:{displayRule:N.ALWAYS,base:{showType:_.FIXED,labels:["","","","","",""],values:null,text:{size:12,color:"#D9D9D9",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0},floatRect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,left:8,top:8,right:8,borderRadius:4,borderSize:1,borderColor:"#3f4254",fillColor:"rgba(17, 17, 17, .3)"}},indicator:{text:{size:12,color:"#D9D9D9",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}}},marker:{line:{color:"#1e88e5",size:1},point:{backgroundColor:"#1e88e5",borderColor:"#1e88e5",borderSize:1,radius:4,activeBackgroundColor:"#1e88e5",activeBorderColor:"#1e88e5",activeBorderSize:1,activeRadius:6},text:{color:"#1e88e5",size:12,marginLeft:2,marginRight:2,marginTop:2,marginBottom:6,valueFormatter:null}}},C(this.style,r),this.indicatorParams=(n(a={},P.MA,[5,10,30,60]),n(a,P.VOL,[5,10,20]),n(a,P.MACD,[12,26,9]),n(a,P.BOLL,[20]),n(a,P.KDJ,[9,3,3]),n(a,P.RSI,[6,12,24]),n(a,P.BIAS,[6,12,24]),n(a,P.BRAR,[26]),n(a,P.CCI,[13]),n(a,P.DMI,[14,6]),n(a,P.CR,[26,10,20,40,60]),n(a,P.PSY,[12]),n(a,P.DMA,[10,50,10]),n(a,P.TRIX,[12,20]),n(a,P.OBV,[30]),n(a,P.VR,[24,30]),n(a,P.WR,[13,34,89]),n(a,P.MTM,[6,10]),n(a,P.EMV,[14,9]),n(a,P.SAR,[2,2,20]),a),this.precision={pricePrecision:2,volumePrecision:0},this.period={period:"1"},e.style.position="relative",e.style.outline="none",e.style.borderStyle="none",e.tabIndex=1,this.dom=e,this.storage=new G,this.xAxisChart=new lt(e,this.style,this.storage,this.period),this.candleChart=new K(e,this.style,this.storage,this.indicatorParams,this.precision),this.graphicMarkChart=new rt(e,this.style,this.storage,this.candleChart.yAxisRender,this.precision),this.volIndicatorChart=new U(e,this.style,this.storage,this.indicatorParams,P.VOL),this.subIndicatorChart=new U(e,this.style,this.storage,this.indicatorParams),this.tooltipChart=new ht(e,this.style,this.candleChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart,this.storage,this.indicatorParams,this.precision),this.calcChartDimensions(),this.initEvent()}return r(t,[{key:"initEvent",value:function(){var t=this,e=Mt(window.navigator.userAgent);this.dom.addEventListener("contextmenu",(function(t){t.preventDefault()}),!1);var i=function(){!t.noMore&&!t.loading&&t.loadMoreCallback&&T(t.loadMoreCallback)&&(t.loading=!0,t.loadMoreCallback((t.storage.dataList[0]||{}).timestamp))};if(e){var a=new Dt(this.tooltipChart,this.candleChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart,this.storage);this.dom.addEventListener("touchstart",(function(t){a.touchStart(t)}),!1),this.dom.addEventListener("touchmove",(function(t){a.touchMove(t,i)}),!1),this.dom.addEventListener("touchend",(function(t){a.touchEnd(t)}),!1)}else{var r=new wt(this.tooltipChart,this.candleChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart,this.graphicMarkChart,this.storage),n=new Nt(this.storage,this.graphicMarkChart,this.style),o=new _t(this.candleChart,this.volIndicatorChart,this.subIndicatorChart,this.tooltipChart,this.graphicMarkChart,this.xAxisChart,this.storage);this.dom.addEventListener("mousedown",(function(t){r.mouseDown(t),n.mouseDown(t)}),!1),this.dom.addEventListener("mouseup",(function(t){r.mouseUp(t),n.mouseUp(t)}),!1),this.dom.addEventListener("mousemove",(function(t){r.mouseMove(t,i),n.mouseMove(t)}),!1),this.dom.addEventListener("mouseleave",(function(t){r.mouseLeave(t)}),!1),this.dom.addEventListener("wheel",(function(t){r.mouseWheel(t)}),!1),this.dom.addEventListener("keydown",(function(t){o.keyDown(t,i)}),!1)}}},{key:"flushCharts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=!0,i=!1,a=void 0;try{for(var r,n=t[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;o.flush()}}catch(t){i=!0,a=t}finally{try{e||null==n.return||n.return()}finally{if(i)throw a}}}},{key:"calcChartDimensions",value:function(){var t=this.calcXAxisHeight(),e=this.calcYAxisWidth(),i=this.dom.offsetWidth,a=this.dom.offsetHeight;this.domWidth=i,this.domHeight=a;var r=a-t,n=0,o=0,s=0,h=this.volIndicatorChart.indicatorType!==P.NO,c=this.subIndicatorChart.indicatorType!==P.NO;if(h&&c){var l=+(.18*r).toFixed(0);o=l,s=l}else if(!h&&c||h&&!c){var u=+(.26*r).toFixed(0);h?o=u:s=u}var d=0,v=0;this.style.yAxis.position===b.LEFT?d=e:v=e,this.storage.space(i-v-d),this.xAxisChart.setChartDimensions(0,i,a,d,v,0,t);var f=r-o-s;this.candleChart.setChartDimensions(n,i,f,d,v),this.graphicMarkChart.setChartDimensions(n,i,f,d,v),this.volIndicatorChart.setChartDimensions(n+=f,i,o,d,v),this.subIndicatorChart.setChartDimensions(n+=o,i,s,d,v),this.tooltipChart.setChartDimensions(0,i,a,d,v,0,t)}},{key:"calcXAxisHeight",value:function(){var t=this.style.xAxis,e=t.tick.text,i=t.tick.line,a=e.size+e.margin;return t.display&&i.display&&(a+=i.length),t.display&&t.line.display&&(a+=t.line.size),+Math.ceil(+(a=Math.max(t.minHeight,Math.min(a,t.maxHeight)))).toFixed(0)}},{key:"calcYAxisWidth",value:function(){var t=this.style.yAxis,e=t.tick.text,i=t.tick.line;if(((e.display||i.display||e.margin>0)&&e.position===D.OUTSIDE||t.line.display)&&t.display){var a=0;e.position===D.OUTSIDE&&(a+=m(e.size,"0000000")+e.margin,t.display&&i.display&&(a+=i.length));var r=t.line.size;return t.display&&t.line.display&&(a+=r),a>r&&(a=Math.max(t.minWidth,Math.min(a,t.maxWidth))),Math.ceil(a)}return 0}},{key:"calcChartIndicator",value:function(){this.candleChart.chartType===S.REAL_TIME?this.style.realTime.averageLine.display&&(this.storage.dataList=ut.average(this.storage.dataList),this.flushCharts([this.candleChart])):this.candleChart.indicatorType!==P.NO?this.calcIndicator(this.candleChart.indicatorType,this.candleChart):this.flushCharts([this.candleChart]),this.volIndicatorChart.indicatorType!==P.NO&&this.calcIndicator(P.VOL,this.volIndicatorChart),this.subIndicatorChart.indicatorType!==P.NO&&this.calcIndicator(this.subIndicatorChart.indicatorType,this.subIndicatorChart)}},{key:"calcIndicator",value:function(t,e){var i=this;Promise.resolve().then((function(){var a=ut[t];T(a)&&(i.storage.dataList=a(i.storage.dataList,i.indicatorParams[t]),i.flushCharts([e,i.tooltipChart]))}))}},{key:"resize",value:function(){var t=this;this.domWidth===this.dom.offsetWidth&&this.domHeight===this.dom.offsetHeight||y((function(){t.calcChartDimensions()}))}},{key:"addData",value:function(t,e){if("boolean"==typeof e&&(this.noMore=e),I(t)){var i=this.getDataList(),a=i.length,r=-1;if(R(t))a>0&&(this.loading=!1),r=0;else{var n=+L(t,"timestamp",0),o=+L(i[a-1],"timestamp",0),s=this.period.period,h=s.replace(/[1-9]/,"").toUpperCase(),c=+(s.replace(/[DWMY]/i,"")||1),l=Math.abs(n-o);switch(h){case"D":24*c*3600*1e3>l?r=a-1:n>o&&(r=a);break;case"W":7*c*24*3600*1e3>l?r=a-1:n>o&&(r=a);break;case"M":var u=+nt(o,"YYYY"),d=+nt(o,"MM"),v=+nt(n,"YYYY"),f=+nt(n,"MM");f===d?r=a-1:c>Math.abs(12*(v-u)+f-d)||(r=a);break;case"Y":var g=+nt(o,"YYYY"),p=+nt(n,"YYYY");p===g?r=a-1:c>Math.abs(p-g)||(r=a);break;default:60*c*1e3>l?r=a-1:n>o&&(r=a)}t.timestamp=r===a-1?o:60*Math.floor(n/60/1e3)*1e3}-1!==r&&(this.storage.addData(t,r),this.calcChartIndicator(),this.xAxisChart.flush())}}},{key:"setStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C(this.style,t),this.calcChartDimensions()}},{key:"setMainChartType",value:function(t){this.candleChart.chartType!==t&&(this.candleChart.chartType=t,t===S.REAL_TIME&&this.style.realTime.averageLine.display&&(this.storage.dataList=ut.average(this.storage.dataList)),this.flushCharts([this.candleChart,this.tooltipChart]),this.clearAllMarker(),"1"!==this.period.period&&this.clearData())}},{key:"setMainIndicatorType",value:function(t){this.candleChart.indicatorType!==t&&(this.candleChart.indicatorType=t,t===P.NO?this.flushCharts([this.candleChart]):this.calcIndicator(t,this.candleChart))}},{key:"setSubIndicatorType",value:function(t){if(this.subIndicatorChart.indicatorType!==t){var e=t===P.NO||this.subIndicatorChart.indicatorType===P.NO;this.subIndicatorChart.indicatorType=t,e&&this.calcChartDimensions(),t!==P.NO&&this.calcIndicator(t,this.subIndicatorChart)}}},{key:"setIndicatorParams",value:function(t,e){!this.indicatorParams.hasOwnProperty(t)||t!==P.MA&&t!==P.VOL&&e.length!==this.indicatorParams[t].length||(this.indicatorParams[t]=e,this.getMainIndicatorType()===t&&this.calcIndicator(t,this.candleChart),this.isShowVolChart()&&t===P.VOL&&this.calcIndicator(t,this.volIndicatorChart),this.getSubIndicatorType()===t&&this.calcIndicator(t,this.subIndicatorChart))}},{key:"getIndicatorParams",value:function(t){return t?this.indicatorParams[t]||[]:this.indicatorParams}},{key:"setPrecision",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.precision.pricePrecision,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.precision.volumePrecision;this.precision.pricePrecision=t,this.precision.volumePrecision=e}},{key:"setPeriod",value:function(t){var e="".concat(t);this.period.period!==e&&t&&/^[1-9]*?[DWMY]?$/i.test(e)&&(this.period.period=e,this.clearData())}},{key:"setSession",value:function(t){var e=t.split(";");switch(e.length){case 1:break;case 2:if(!/^[0-6]$/.test(e[1]))return void(Ot&&console.warn("The trading day is set incorrectly for the first trading day of the week. The parameters should be 0, 1, 2, 3, 4, 5, 6."));console.log(1);break;default:Ot&&console.warn("The format of the trading session is incorrect.")}}},{key:"showVolChart",value:function(t){t!==(this.volIndicatorChart.indicatorType!==P.NO)&&(this.volIndicatorChart.indicatorType=t?P.VOL:P.NO,this.calcChartDimensions(),t&&this.calcIndicator(P.VOL,this.volIndicatorChart))}},{key:"setDefaultRange",value:function(t){!A(t)||this.storage.minRange>t||t>this.storage.maxRange||(this.storage.range=t,this.storage.space(this.tooltipChart.handler.contentRight()-this.tooltipChart.handler.contentLeft()),this.storage.minPos+t>this.storage.dataList.length&&(this.storage.minPos=this.storage.dataList.length-t,0>this.storage.minPos&&(this.storage.minPos=0)),this.flushCharts([this.candleChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart]))}},{key:"setMinRange",value:function(t){A(t)&&this.storage.range>=t&&(this.storage.minRange=t)}},{key:"setMaxRange",value:function(t){A(t)&&t>=this.storage.range&&(this.storage.maxRange=t)}},{key:"getMainIndicatorType",value:function(){return this.candleChart.indicatorType}},{key:"getSubIndicatorType",value:function(){return this.subIndicatorChart.indicatorType}},{key:"isShowVolChart",value:function(){return this.volIndicatorChart.indicatorType!==P.NO}},{key:"getDataList",value:function(){return this.storage.dataList}},{key:"getStyle",value:function(){return this.style}},{key:"clearData",value:function(){this.storage.dataList=[]}},{key:"drawMarker",value:function(t){var e=this.storage.graphicMarkType;if(e!==t){var i=this.storage.graphicMarkDatas[e];i&&R(i)&&(i.splice(i.length-1,1),this.storage.graphicMarkDatas[e]=i,this.tooltipChart.flush())}this.storage.graphicMarkType=t}},{key:"clearAllMarker",value:function(){var t=this;Object.keys(this.storage.graphicMarkDatas).forEach((function(e){t.storage.graphicMarkDatas[e]=[]})),this.storage.graphicMarkType=O.NONE,this.graphicMarkChart.flush()}},{key:"loadMore",value:function(t){this.loadMoreCallback=t}},{key:"getConvertPictureUrl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpeg",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("png"!==t&&"jpeg"!==t&&"bmp"!==t)throw Error("Picture format only supports jpeg, png and bmp!!!");var i=document.createElement("canvas"),a=this.xAxisChart.canvasDom,r=this.candleChart.canvasDom,n=this.volIndicatorChart.canvasDom,o=this.subIndicatorChart.canvasDom,s=this.tooltipChart.canvasDom;i.width=s.width,i.height=s.height,i.style.width=s.style.width,i.style.height=s.style.height;var h=i.getContext("2d");if(h.drawImage(a,0,0,a.width,a.height),e&&e.indexOf("candle")>=0||h.drawImage(r,0,0,r.width,r.height),e&&e.indexOf("vol")>=0||h.drawImage(n,0,r.height,n.width,n.height),e&&e.indexOf("subIndicator")>=0||h.drawImage(o,0,r.height+n.height,o.width,o.height),!e||0>e.indexOf("marker")){var c=this.graphicMarkChart.canvasDom;h.drawImage(c,0,0,c.width,c.height)}return e&&e.indexOf("tooltip")>=0||h.drawImage(s,0,0,s.width,s.height),i.toDataURL("image/".concat(t))}}]),t}(),Ft={},Bt=1;t.dispose=function(t){if(t){var e=t.chart_id;!e&&t instanceof Yt&&(e=t.id),e&&delete Ft[e]}},t.init=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)throw Error("Chart version is 4.2.0. Root dom is null, can not initialize the chart!!!");var i=Ft[t.chart_id||""];if(i)return Ot&&console.warn("The chart has been initialized on the dom"),i;var a="k_line_chart_".concat(Bt++),r=new Yt(t,e);return r.id=a,t.chart_id=a,Ft[a]=r,r},t.version=function(){return"4.2.0"},Object.defineProperty(t,"__esModule",{value:!0})}));
