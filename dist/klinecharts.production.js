!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).klinecharts={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;e.length>i;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function s(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(i,!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t,e,i){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(i):a.value}})(t,e,i||t)}var v=function(){function t(){i(this,t),this.contentRect={left:0,right:0,top:0,bottom:0},this.height=0,this.width=0}return a(t,[{key:"setDimensions",value:function(t,e,i,r,a,n){this.width=t,this.height=e,this.contentRect.left=i,this.contentRect.right=r,this.contentRect.top=a,this.contentRect.bottom=n}},{key:"contentTop",value:function(){return this.contentRect.top}},{key:"contentLeft",value:function(){return this.contentRect.left}},{key:"contentRight",value:function(){return this.width-this.contentRect.right}},{key:"contentBottom",value:function(){return this.height-this.contentRect.bottom}},{key:"getContentCenter",value:function(){var t={};return t.x=(this.contentLeft()+this.contentRight())/2,t.y=(this.contentTop()+this.contentBottom())/2,t}}]),t}(),f=document.createElement("canvas").getContext("2d"),m=y(f);function y(t){return(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function g(t,e){return f.font="".concat(t,"px Arial"),f.measureText(e).width}f.scale(m,m);var p=function(){function t(e,r){i(this,t),this.config=r,this.viewPortHandler=new v,this.init(e)}return a(t,[{key:"init",value:function(t){var e=document.createElement("canvas");e.style.position="absolute",e.style.right="0",e.style.left="0",this.canvasDom=e,this.ctx=this.canvasDom.getContext("2d"),t.appendChild(this.canvasDom)}},{key:"setChartDimensions",value:function(t,e,i,r,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.clearCanvas();var s=y(this.ctx),h=e*s,l=i*s;this.canvasDom.style.top="".concat(t,"px"),this.canvasDom.style.width="".concat(e,"px"),this.canvasDom.style.height="".concat(i,"px"),this.canvasDom.width=h,this.canvasDom.height=l,this.viewPortHandler.setDimensions(e,i,r,a,n,o),this.ctx.scale(s,s),this.ctx.translate(-.5,-.5),this.draw()}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.viewPortHandler.width,this.viewPortHandler.height)}},{key:"flush",value:function(){var t,e,i=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)),this.requestAnimationId=(e=function(){i.clearCanvas(),i.draw()},window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout((function(){e()}),1e3/60))}},{key:"draw",value:function(){}}]),t}(),P=function t(e,r){i(this,t),this.viewPortHandler=e,this.dataProvider=r};function x(t){if(t&&C(t)){var e=new Date(t),i=""+(e.getMonth()+1),r=""+e.getDate(),a=""+e.getHours(),n=""+e.getMinutes();return(1===i.length?"0"+i:i)+"-"+(1===r.length?"0"+r:r)+" "+(1===a.length?"0"+a:a)+":"+(1===n.length?"0"+n:n)}return"--"}function k(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(t&&A(t)){var r=t[e];if(r||0===r||!1===r)return r}return i}function M(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(t||0===t)&&C(t)?t.toFixed(e):t}function L(t,e){if(A(t)&&A(e))for(var i in e)if(t[i]||0===t[i]||!1===t[i]){var r=t[i],a=e[i];A(a)&&A(r)&&!w(a)&&!w(r)?L(r,a):(t[i]||0===t[i]||!1===t[i])&&(t[i]=e[i])}}function w(t){return"[object Array]"===Object.prototype.toString.call(t)}function R(t){return"function"==typeof t}function A(t){var i=e(t);return"function"===i||!!t&&"object"===i}function C(t){return"number"==typeof t&&!isNaN(t)}var T={NO:"NO",MA:"MA",VOL:"VOL",MACD:"MACD",BOLL:"BOLL",KDJ:"KDJ",RSI:"RSI",BIAS:"BIAS",BRAR:"BRAR",CCI:"CCI",DMI:"DMI",CR:"CR",PSY:"PSY",DMA:"DMA",TRIX:"TRIX",OBV:"OBV",VR:"VR",WR:"WR",MTM:"MTM",EMV:"EMV",SAR:"SAR"},I="dash",b="left",E="right",S="outside",D={REAL_TIME:"real_time",CANDLE:"candle"},H="solid",N="stroke",_="increasing_stroke",O="decreasing_stroke",F="ohlc",B="always",V="follow_cross",z="fixed",G={NONE:"none",HORIZONTAL_STRAIGHT_LINE:"horizontalStraightLine",VERTICAL_STRAIGHT_LINE:"verticalStraightLine",STRAIGHT_LINE:"straightLine",HORIZONTAL_RAY_LINE:"horizontalRayLine",VERTICAL_RAY_LINE:"verticalRayLine",RAY_LINE:"rayLine",HORIZONTAL_SEGMENT_LINE:"horizontalSegmentLine",VERTICAL_SEGMENT_LINE:"verticalSegmentLine",SEGMENT_LINE:"segmentLine",PRICE_LINE:"priceLine",PRICE_CHANNEL_LINE:"priceChannelLine",PARALLEL_STRAIGHT_LINE:"parallelStraightLine",FIBONACCI_LINE:"fibonacciLine"},Y="step_1",W="step_2",j="step_3",X="step_done",Z=function(){function t(){i(this,t),this.dataList=[],this.minPos=0,this.range=120,this.maxRange=180,this.minRange=20,this.dataSpace=0,this.currentTooltipDataPos=0,this.crossPoint=null,this.currentMarkerType=G.NONE,this.markerPoint=null,this.isDragMarker=!1,this.markerDatas={horizontalStraightLine:[],verticalStraightLine:[],straightLine:[],horizontalRayLine:[],verticalRayLine:[],rayLine:[],horizontalSegmentLine:[],verticalSegmentLine:[],segmentLine:[],priceLine:[],parallelStraightLine:[],priceChannelLine:[],fibonacciLine:[]}}return a(t,[{key:"space",value:function(t){this.dataSpace=t/this.range}},{key:"addData",value:function(t,e){A(t)&&!w(t)?(this.dataList.length>e?e>0?this.dataList[e]=t:this.dataList.unshift(t):this.dataList.push(t),this.dataList.length-1>this.minPos+this.range||this.moveToLast()):w(t)&&(0===this.dataList.length?(this.dataList=t.concat(this.dataList),this.moveToLast()):(this.dataList=t.concat(this.dataList),this.minPos+=t.length))}},{key:"moveToLast",value:function(){this.dataList.length>this.range?(this.minPos=this.dataList.length-this.range,this.currentTooltipDataPos=this.dataList.length-1):this.minPos=0}},{key:"calcCurrentTooltipDataPos",value:function(t,e){var i=+Math.ceil((e-t)/this.dataSpace).toFixed(0);this.currentTooltipDataPos=this.minPos+i-1,this.currentTooltipDataPos>this.dataList.length-1&&(this.currentTooltipDataPos=this.dataList.length-1),this.crossPoint.x=t+this.dataSpace*(this.currentTooltipDataPos-this.minPos)+.74*this.dataSpace/2}}]),t}(),K=function(t){function e(t,r,a){var n;return i(this,e),(n=d(this,l(e).call(this,t,r))).yAxisRender=a,n}return h(e,t),a(e,[{key:"renderHorizontalSeparatorLine",value:function(t,e){var i=e.line.size;t.strokeStyle=e.line.color,t.lineWidth=i,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentTop()+i),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentTop()+i),t.stroke(),t.closePath()}},{key:"renderIndicator",value:function(t,e,i){var r,a=this,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=[];switch(e){case T.MA:r=function(e,r,s,h){var l=s.ma||{};(a.prepareLinePoints(e,[l.ma5,l.ma10,l.ma20,l.ma60],o),n)||a.renderOhlc(t,h,e,s,a.dataProvider.dataList[r-1]||{},i.increasingColor,i.decreasingColor)};break;case T.MACD:r=function(e,r,n,s){var h=n.macd||{};a.prepareLinePoints(e,[h.diff,h.dea],o);var l=h.macd,c=((a.dataProvider.dataList[r-1]||{}).macd||{}).macd||Number.MIN_SAFE_INTEGER;l>0?(t.strokeStyle=i.increasingColor,t.fillStyle=i.increasingColor):(t.strokeStyle=i.decreasingColor,t.fillStyle=i.decreasingColor),a.renderBars(t,e,s,l,!((c||0===c)&&l>c))};break;case T.VOL:r=function(e,r,n,s){var h=n.vol||{};a.prepareLinePoints(e,[h.ma5,h.ma10,h.ma20],o),t.fillStyle=n.close>((a.dataProvider.dataList[r-1]||{}||{}).close||Number.MIN_SAFE_INTEGER)?i.increasingColor:i.decreasingColor,a.renderBars(t,e,s,h.num,!0)};break;case T.BOLL:r=function(e,r,s,h){var l=s.boll||{};(a.prepareLinePoints(e,[l.up,l.mid,l.dn],o),n)||a.renderOhlc(t,h,e,s,a.dataProvider.dataList[r-1]||{},i.increasingColor,i.decreasingColor)};break;case T.BIAS:r=function(t,e,i){var r=i.bias||{};a.prepareLinePoints(t,[r.bias1,r.bias2,r.bias3],o)};break;case T.BRAR:r=function(t,e,i){var r=i.brar||{};a.prepareLinePoints(t,[r.br,r.ar],o)};break;case T.CCI:r=function(t,e,i){a.prepareLinePoints(t,[(i.cci||{}).cci],o)};break;case T.CR:r=function(t,e,i){var r=i.cr||{};a.prepareLinePoints(t,[r.cr,r.ma1,r.ma2,r.ma3,r.ma4],o)};break;case T.DMA:r=function(t,e,i){var r=i.dma||{};a.prepareLinePoints(t,[r.dif,r.difMa],o)};break;case T.DMI:r=function(t,e,i){var r=i.dmi||{};a.prepareLinePoints(t,[r.mdi,r.pdi,r.adx,r.adxr],o)};break;case T.KDJ:r=function(t,e,i){var r=i.kdj||{};a.prepareLinePoints(t,[r.k,r.d,r.j],o)};break;case T.RSI:r=function(t,e,i){var r=i.rsi||{};a.prepareLinePoints(t,[r.rsi1,r.rsi2,r.rsi3],o)};break;case T.PSY:r=function(t,e,i){a.prepareLinePoints(t,[(i.psy||{}).psy],o)};break;case T.TRIX:r=function(t,e,i){var r=i.trix||{};a.prepareLinePoints(t,[r.trix,r.maTrix],o)};break;case T.OBV:r=function(t,e,i){var r=i.obv||{};a.prepareLinePoints(t,[r.obv,r.maObv],o)};break;case T.VR:r=function(t,e,i){var r=i.vr||{};a.prepareLinePoints(t,[r.vr,r.maVr],o)};break;case T.WR:r=function(t,e,i){var r=i.wr||{};a.prepareLinePoints(t,[r.wr1,r.wr2,r.wr3],o)};break;case T.MTM:r=function(t,e,i){var r=i.mtm||{};a.prepareLinePoints(t,[r.mtm,r.mtmMa],o)};break;case T.EMV:r=function(t,e,i){var r=i.emv||{};a.prepareLinePoints(t,[r.emv,r.maEmv],o)};break;case T.SAR:r=function(e,r,o,s){var h=(o.sar||{}).sar;if(h||0===h){var l=a.yAxisRender.getY(h);t.strokeStyle=(o.high+o.low)/2>h?i.increasingColor:i.decreasingColor,t.beginPath(),t.arc(e,l,s,2*Math.PI,0,!0),t.stroke(),t.closePath()}n||a.renderOhlc(t,s,e,o,a.dataProvider.dataList[r-1]||{},i.increasingColor,i.decreasingColor)}}this.renderGraphics(t,r,(function(){a.renderLines(t,o,i)}))}},{key:"renderGraphics",value:function(t,e,i){for(var r=this.viewPortHandler.contentLeft(),a=.74*this.dataProvider.dataSpace,n=a/2,o=Math.min(this.dataProvider.dataList.length,this.dataProvider.minPos+this.dataProvider.range),s=this.dataProvider.minPos;o>s;s++){e&&e((r+(r+a))/2,s,this.dataProvider.dataList[s],n),r+=this.dataProvider.dataSpace}i&&i()}},{key:"prepareLinePoints",value:function(t,e,i){for(var r=0;e.length>r;r++){var a=this.yAxisRender.getY(e[r]);i[r]?i[r].push({x:t,y:a}):i[r]=[{x:t,y:a}]}}},{key:"renderLines",value:function(t,e,i){var r=i.lineColors,a=e.length,n=(i.lineColors||[]).length;t.lineWidth=i.lineSize;for(var o=0;a>o;o++){var s=e[o];if(s.length>0){t.strokeStyle=r[o%n],t.beginPath(),t.moveTo(s[0].x,s[0].y);for(var h=1;s.length>h;h++)t.lineTo(s[h].x,s[h].y);t.stroke(),t.closePath()}}}},{key:"renderBars",value:function(t,e,i,r,a){if(r||0===r){t.lineWidth=1;var n=this.yAxisRender.getY(r),o=this.yAxisRender.getY(0),s=n;0>r&&(s=o),a?t.fillRect(e-i,s,2*i,Math.abs(o-n)):t.strokeRect(e-i,s,2*i,Math.abs(o-n))}}},{key:"renderOhlc",value:function(t,e,i,r,a,n,o){var s=this.yAxisRender.getY(r.open),h=this.yAxisRender.getY(r.close),l=this.yAxisRender.getY(r.high),c=this.yAxisRender.getY(r.low);t.strokeStyle=r.close>a.close?n:o,t.lineWidth=1,t.beginPath(),t.moveTo(i,l),t.lineTo(i,c),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i-e,s),t.lineTo(i,s),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i+e,h),t.lineTo(i,h),t.stroke(),t.closePath()}}]),e}(P);function q(t){var e=Math.floor(Math.log(t)/Math.log(10)),i=Math.pow(10,e),r=t/i;return t=(1>r?1:2>r?2:3>r?3:5>r?5:10)*i,-20>e?t:+t.toFixed(0>e?-e:0)}function U(t){var e=""+t,i=e.indexOf("e");if(i>0){var r=+e.slice(i+1);return 0>r?-r:0}var a=e.indexOf(".");return 0>a?0:e.length-1-a}function J(t,e){return null==e&&(e=10),t=(+t).toFixed(e=Math.min(Math.max(0,e),20))}var Q=function(t){function e(t,r){var a;return i(this,e),(a=d(this,l(e).call(this,t,r))).axisMaximum=0,a.axisMinimum=0,a.axisRange=0,a}return h(e,t),a(e,[{key:"computeAxisValues",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.calcRange(e,t);if(r<0)this.values=[];else if(this.isFillChart()){var a=+q(r/5),n=U(a),o=+J(Math.ceil(t/a)*a,n),s=+J(Math.floor(e/a)*a,n),h=0,l=o;if(0!==a)for(;+s>=l;)++h,l+=a;this.values=[],l=o;for(var c=0;h>c;c++)this.values[c]=l,l+=a}else this.fixComputeAxisValues(i)}},{key:"calcRange",value:function(t,e){return Math.abs(t-e)}},{key:"isFillChart",value:function(){return!0}},{key:"fixComputeAxisValues",value:function(){}}]),e}(P),$=function(t){function e(){return i(this,e),d(this,l(e).apply(this,arguments))}return h(e,t),a(e,[{key:"renderStrokeLine",value:function(t,e,i){if(i){t.strokeStyle=e.line.color,t.lineWidth=e.line.size;var r=this.viewPortHandler.contentLeft();e.position===b&&(r=this.viewPortHandler.contentRight()),t.beginPath(),t.moveTo(r,this.viewPortHandler.contentTop()),t.lineTo(r,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath()}}},{key:"renderAxisLine",value:function(t,e){e.display&&e.line.display&&(t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),e.position===b?(t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom())):(t.moveTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentBottom())),t.stroke(),t.closePath())}},{key:"renderAxisLabels",value:function(t,e){var i=e.tick.text;if(e.display&&i.display){var r,a=e.tick.line,n=i.position,o=a.display,s=a.length,h=i.margin;r=e.position===b?n===S?o?this.viewPortHandler.contentLeft()-s-h:this.viewPortHandler.contentLeft()-h:o?this.viewPortHandler.contentLeft()+s+h:this.viewPortHandler.contentLeft()+h:n===S?o?this.viewPortHandler.contentRight()+s+h:this.viewPortHandler.contentRight()+h:o?this.viewPortHandler.contentRight()-s-h:this.viewPortHandler.contentRight()-h;var l=i.size,c=i.valueFormatter;t.textBaseline="middle",t.font="".concat(l,"px Arial"),t.fillStyle=i.color;for(var d=0;this.values.length>d;d++){var u=this.getY(this.values[d]),v=""+this.values[d];R(c)&&(v=c(this.values[d])||"--"),this.checkShowLabel(u,l)&&(t.textAlign=e.position===b&&n===S||e.position===E&&n!==S?"right":"left",t.fillText(v,r,u))}t.textAlign="left"}}},{key:"renderSeparatorLines",value:function(t,e){var i=e.separatorLine;if(e.display&&i.display){t.strokeStyle=i.color,t.lineWidth=i.size;var r=e.tick.text.size;i.style===I&&t.setLineDash(i.dashValue);for(var a=0;this.values.length>a;a++){var n=this.getY(this.values[a]);this.checkShowLabel(n,r)&&(t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),n),t.lineTo(this.viewPortHandler.contentRight(),n),t.stroke(),t.closePath())}t.setLineDash([])}}},{key:"renderTickLines",value:function(t,e){var i=e.tick.text;if(e.display&&i.display){var r=e.tick.line;t.lineWidth=r.size,t.strokeStyle=r.color;var a,n,o=i.size,s=r.length,h=i.position;e.position===b?(a=this.viewPortHandler.contentLeft(),n=h===S?a-s:a+s):(a=this.viewPortHandler.contentRight(),n=h===S?a+s:a-s);for(var l=0;this.values.length>l;l++){var c=this.getY(this.values[l]);this.checkShowLabel(c,o)&&(t.beginPath(),t.moveTo(a,c),t.lineTo(n,c),t.stroke(),t.closePath())}}}},{key:"checkShowLabel",value:function(t,e){return t>this.viewPortHandler.contentTop()+e&&t<this.viewPortHandler.contentBottom()-e}},{key:"calcAxisMinMax",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.dataProvider.dataList,a=this.dataProvider.minPos,n=Math.min(a+this.dataProvider.range,r.length),o=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER];if(i)for(var s=a;n>s;s++){var h=r[s];o[0]=Math.min.call(null,h.average,h.close,o[0]),o[1]=Math.max.call(null,h.average,h.close,o[1])}else for(var l=a;n>l;l++){var c=r[l];this.compareMinMax(c,t,o),e&&(o[0]=Math.min(c.low,o[0]),o[1]=Math.max(c.high,o[1]))}o[0]!==Number.MAX_SAFE_INTEGER&&o[1]!==Number.MIN_SAFE_INTEGER&&(this.axisMinimum=o[0],this.axisMaximum=o[1])}},{key:"compareMinMax",value:function(t,e,i){var r=k(t,e.toLowerCase(),{});return Object.keys(r).forEach((function(t){var e=r[t];i[0]=Math.min(i[0],e),i[1]=Math.max(i[1],e)})),e!==T.BOLL&&e!==T.SAR||(i[0]=Math.min(i[0],t.low),i[1]=Math.max(i[1],t.high)),i}},{key:"computeAxis",value:function(){var t=this.axisMinimum,e=this.axisMaximum;if(t!==Number.MAX_SAFE_INTEGER&&e!==Number.MIN_SAFE_INTEGER){var i=Math.abs(e-t);0===i&&(i=Math.abs((e+=1)-(t-=1))),this.axisMinimum=t-i/100*10,this.axisMaximum=e+i/100*20,this.axisRange=Math.abs(this.axisMaximum-this.axisMinimum),this.computeAxisValues(this.axisMinimum,this.axisMaximum)}}},{key:"getY",value:function(t){return(1-(t-this.axisMinimum)/this.axisRange)*(this.viewPortHandler.contentBottom()-this.viewPortHandler.contentTop())}},{key:"getValue",value:function(t){return(1-t/(this.viewPortHandler.contentBottom()-this.viewPortHandler.contentTop()))*this.axisRange+this.axisMinimum}}]),e}(Q),tt=function(t){function e(t,r,a){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.MACD;return i(this,e),(n=d(this,l(e).call(this,t,r))).indicatorType=o,n.yAxisRender=new $(n.viewPortHandler,a),n.chartRender=new K(n.viewPortHandler,a,n.yAxisRender),n}return h(e,t),a(e,[{key:"draw",value:function(){if(this.isDrawChart()){var t=this.isMainChart();t||this.chartRender.renderHorizontalSeparatorLine(this.ctx,this.config.xAxis);var e=this.config.yAxis,i=this.isRealTimeChart();this.yAxisRender.calcAxisMinMax(this.indicatorType,t,i),this.yAxisRender.computeAxis(),this.yAxisRender.renderSeparatorLines(this.ctx,e),this.drawChart(),this.yAxisRender.renderStrokeLine(this.ctx,e,this.config.grid),this.yAxisRender.renderAxisLine(this.ctx,e),this.yAxisRender.renderTickLines(this.ctx,e),this.yAxisRender.renderAxisLabels(this.ctx,e)}}},{key:"drawChart",value:function(){this.chartRender.renderIndicator(this.ctx,this.indicatorType,this.config.indicator,!1)}},{key:"isDrawChart",value:function(){return this.indicatorType!==T.NO}},{key:"isMainChart",value:function(){return!1}},{key:"isRealTimeChart",value:function(){return!1}}]),e}(p),et=function(t){function e(){return i(this,e),d(this,l(e).apply(this,arguments))}return h(e,t),a(e,[{key:"renderCandle",value:function(t,e,i){var r=this;t.lineWidth=1;var a=[],n=Number.MIN_SAFE_INTEGER,o=-1,s=Number.MAX_SAFE_INTEGER,h=-1,l=this.dataProvider.dataList;this.renderGraphics(t,(function(i,c,d,u){var v=l[c-1]||{},f=v.close||Number.MIN_SAFE_INTEGER,m=d.high,y=d.low,g=d.close,p=d.open;if(m>n&&(n=m,o=i),s>y&&(s=y,h=i),g>f?(t.strokeStyle=e.increasingColor,t.fillStyle=e.increasingColor):(t.strokeStyle=e.decreasingColor,t.fillStyle=e.decreasingColor),e.style!==F){var P=r.yAxisRender.getY(p),x=r.yAxisRender.getY(g),k=r.yAxisRender.getY(m),M=r.yAxisRender.getY(y),L=[],w=[];switch(L[0]=k,w[1]=M,P>x?(L[1]=x,w[0]=P,a=[i-u,x,2*u,P-x]):x>P?(L[1]=P,w[0]=x,a=[i-u,P,2*u,x-P]):(L[1]=P,w[0]=x,a=[i-u,P,2*u,1]),t.beginPath(),t.moveTo(i,L[0]),t.lineTo(i,L[1]),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i,w[0]),t.lineTo(i,w[1]),t.stroke(),t.closePath(),1>a[3]&&(a[3]=1),e.style){case H:t.fillRect(a[0],a[1],a[2],a[3]);break;case N:t.strokeRect(a[0],a[1],a[2],a[3]);break;case _:g>f?t.strokeRect(a[0],a[1],a[2],a[3]):t.fillRect(a[0],a[1],a[2],a[3]);break;case O:g>f?t.fillRect(a[0],a[1],a[2],a[3]):t.strokeRect(a[0],a[1],a[2],a[3])}}else r.renderOhlc(t,u,i,d,v,e.increasingColor,e.decreasingColor)})),this.highestMarkData={x:o,price:n},this.lowestMarkData={x:h,price:s}}},{key:"renderHighestPriceMark",value:function(t,e){var i=this.highestMarkData.price;i!==Number.MIN_SAFE_INTEGER&&e.display&&this.renderLowestHighestPriceMark(t,e,this.highestMarkData.x,i,!0)}},{key:"renderLowestPriceMark",value:function(t,e){var i=this.lowestMarkData.price;i!==Number.MAX_SAFE_INTEGER&&e.display&&this.renderLowestHighestPriceMark(t,e,this.lowestMarkData.x,i)}},{key:"renderLowestHighestPriceMark",value:function(t,e,i,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.save(),t.beginPath(),t.rect(0,0,this.viewPortHandler.contentRight()-this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom()-this.viewPortHandler.contentTop()),t.closePath(),t.clip();var n=this.yAxisRender.getY(r),o=i,s=n+(a?-2:2);t.textAlign="left",t.lineWidth=1,t.strokeStyle=e.color,t.fillStyle=e.color,t.beginPath(),t.moveTo(o,s),t.lineTo(o-2,s+(a?-2:2)),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(o,s),t.lineTo(o+2,s+(a?-2:2)),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(o,s),t.lineTo(o,s+=a?-5:5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(o,s),t.lineTo(o+5,s),t.stroke(),t.closePath();var h=e.text.size,l=e.text.valueFormatter;t.font="".concat(h,"px Arial");var c=r.toFixed(2);l&&(c=l(r)+""),t.textBaseline="middle",t.fillText(c,o+5+e.text.margin,s),t.restore()}},{key:"renderLastPriceMark",value:function(t,e,i,r){var a=this.dataProvider.dataList.length;if(e.display&&0!==a){var n=(this.dataProvider.dataList[a-2]||{}).close||Number.MIN_SAFE_INTEGER,o=this.dataProvider.dataList[a-1].close,s=this.yAxisRender.getY(o),h=this.viewPortHandler.contentBottom()-this.viewPortHandler.contentTop();s=+Math.max(.05*h,Math.min(s,.98*h)).toFixed(0);var l=o>n?e.increasingColor:e.decreasingColor,c=this.viewPortHandler.contentLeft(),d=this.viewPortHandler.contentRight(),u=e.text;if(u.display){var v=M(o),f=u.valueFormatter;R(f)&&(v=f(o)||"--");var m,y=e.text.size,p=g(y,v)+u.paddingLeft+u.paddingRight,P=u.paddingTop+y+u.paddingBottom;r?m=i?c-p:d:i?(m=c,c+=p):d=m=d-p,t.fillStyle=l,t.fillRect(m,s-u.paddingTop-y/2,p,P),t.fillStyle=u.color,t.font="".concat(y,"px Arial"),t.textBaseline="middle",t.fillText(v,m+u.paddingLeft,s)}var x=e.line;x.display&&(t.strokeStyle=l,t.lineWidth=x.size,x.style===I&&t.setLineDash(x.dashValue),t.beginPath(),t.moveTo(c,s),t.lineTo(d,s),t.stroke(),t.closePath(),t.setLineDash([]))}}},{key:"renderTimeLine",value:function(t,e){var i=this,r=[],a=[{x:this.viewPortHandler.contentLeft(),y:this.viewPortHandler.contentBottom()}],n=[],o=this.dataProvider.minPos,s=this.dataProvider.range,h=this.dataProvider.dataList.length;this.renderGraphics(t,(function(t,e,l){var c=l.average,d=i.yAxisRender.getY(l.close),u=i.yAxisRender.getY(c);r.push({x:t,y:d}),(c||0===c)&&n.push({x:t,y:u}),e===o?(a.push({x:i.viewPortHandler.contentLeft(),y:d}),a.push({x:t,y:d})):e===o+s-1?(a.push({x:t,y:d}),a.push({x:i.viewPortHandler.contentRight(),y:d}),a.push({x:i.viewPortHandler.contentRight(),y:i.viewPortHandler.contentBottom()})):e===h-1?(a.push({x:t,y:d}),a.push({x:t,y:i.viewPortHandler.contentBottom()})):a.push({x:t,y:d})}),(function(){var i=e.timeLine;if(r.length>0){t.lineWidth=i.size,t.strokeStyle=i.color,t.beginPath(),t.moveTo(r[0].x,r[0].y);for(var o=1;r.length>o;o++)t.lineTo(r[o].x,r[o].y);t.stroke(),t.closePath()}if(a.length>0){t.fillStyle=i.areaFillColor,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(var s=1;a.length>s;s++)t.lineTo(a[s].x,a[s].y);t.closePath(),t.fill()}var h=e.averageLine;if(h.display&&n.length>0){t.lineWidth=h.size,t.strokeStyle=h.color,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(var l=1;n.length>l;l++)t.lineTo(n[l].x,n[l].y);t.stroke(),t.closePath()}}))}}]),e}(K),it=function(t){function e(t,r,a){var n;return i(this,e),(n=d(this,l(e).call(this,t,r,a,T.MA))).chartRender=new et(n.viewPortHandler,a,n.yAxisRender),n.chartType=D.CANDLE,n}return h(e,t),a(e,[{key:"draw",value:function(){u(l(e.prototype),"draw",this).call(this),this.chartRender.renderLastPriceMark(this.ctx,this.config.lastPriceMark,this.config.yAxis.position===b,this.config.yAxis.tick.text.position===S)}},{key:"drawChart",value:function(){this.chartType!==D.REAL_TIME?(this.chartRender.renderCandle(this.ctx,this.config.candle),this.chartRender.renderIndicator(this.ctx,this.indicatorType,this.config.indicator,!0),this.chartRender.renderHighestPriceMark(this.ctx,this.config.highestPriceMark),this.chartRender.renderLowestPriceMark(this.ctx,this.config.lowestPriceMark)):this.chartRender.renderTimeLine(this.ctx,this.config.realTime)}},{key:"isRealTimeChart",value:function(){return this.chartType===D.REAL_TIME}},{key:"isDrawChart",value:function(){return!0}},{key:"isMainChart",value:function(){return!0}}]),e}(tt);function rt(t,e,i){var r=[];if(t&&e&&i.length>0){var a=t.x-e.x;if(0===a)i.forEach((function(t){r.push(t.y)}));else{var n=(t.y-e.y)/a,o=t.y-n*t.x;i.forEach((function(t){r.push(t.x*n+o)}))}}return r}function at(t,e,i){return!!(i&&t&&e)&&(t.x===e.x?1>Math.abs(i.x-t.x):t.y===e.y?1>Math.abs(i.y-t.y):1>Math.abs(i.y-rt(t,e,[i])[0]))}function nt(t,e,i){return!!(i&&t&&e)&&(!!at(t,e,i)&&(t.x===e.x?e.y>t.y?i.y>t.y-2:t.y+2>i.y:e.x>t.x?i.x>t.x-2:t.x+2>i.x))}function ot(t,e,i){return!!(i&&t&&e)&&(!!at(t,e,i)&&2>Math.abs(Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))+Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))-Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))))}function st(t,e,i){if(!i)return!1;var r=i.x-t.x,a=i.y-t.y;return!(r*r+a*a>e*e)}function ht(t,e,i){var r=[];if(t.length>1)if(t[0].x===t[1].x){var a=e.contentTop(),n=e.contentBottom();if(r.push([{x:t[0].x,y:a},{x:t[0].x,y:n}]),t.length>2&&(r.push([{x:t[2].x,y:a},{x:t[2].x,y:n}]),i)){var o=t[0].x-t[2].x;r.push([{x:t[0].x+o,y:a},{x:t[0].x+o,y:n}])}}else{var s=e.contentLeft(),h=e.contentRight();if(t[0].y===t[1].y){if(r.push([{x:s,y:t[0].y},{x:h,y:t[0].y}]),t.length>2&&(r.push([{x:s,y:t[2].y},{x:h,y:t[2].y}]),i)){var l=t[0].y-t[2].y;r.push([{x:s,y:t[0].y+l},{x:h,y:t[0].y+l}])}}else{var c=(t[0].y-t[1].y)/(t[0].x-t[1].x),d=t[0].y-c*t[0].x;if(r.push([{x:s,y:s*c+d},{x:h,y:h*c+d}]),t.length>2){var u=t[2].y-c*t[2].x;if(r.push([{x:s,y:s*c+u},{x:h,y:h*c+u}]),i){var v=d+(d-u);r.push([{x:s,y:s*c+v},{x:h,y:h*c+v}])}}}}return r}function lt(t,e){var i=[];if(t.length>0){var r=e.contentLeft(),a=e.contentRight();if(i.push([{x:r,y:t[0].y},{x:a,y:t[0].y}]),t.length>1){var n=t[0].y-t[1].y;i.push([{x:r,y:t[1].y+.786*n},{x:a,y:t[1].y+.786*n}]),i.push([{x:r,y:t[1].y+.618*n},{x:a,y:t[1].y+.618*n}]),i.push([{x:r,y:t[1].y+.5*n},{x:a,y:t[1].y+.5*n}]),i.push([{x:r,y:t[1].y+.382*n},{x:a,y:t[1].y+.382*n}]),i.push([{x:r,y:t[1].y+.236*n},{x:a,y:t[1].y+.236*n}]),i.push([{x:r,y:t[1].y},{x:a,y:t[1].y}])}}return i}var ct=function(t){function e(t,r,a){var n;return i(this,e),(n=d(this,l(e).call(this,t,r))).yRender=a,n}return h(e,t),a(e,[{key:"renderHorizontalStraightLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.HORIZONTAL_STRAIGHT_LINE,e,at,(function(t){return[[{x:i.viewPortHandler.contentLeft(),y:t[0].y},{x:i.viewPortHandler.contentRight(),y:t[0].y}]]}))}},{key:"renderVerticalStraightLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.VERTICAL_STRAIGHT_LINE,e,at,(function(t){return[[{x:t[0].x,y:i.viewPortHandler.contentTop()},{x:t[0].x,y:i.viewPortHandler.contentBottom()}]]}))}},{key:"renderStraightLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.STRAIGHT_LINE,e,at,(function(t){if(t[0].x===t[1].x)return[[{x:t[0].x,y:i.viewPortHandler.contentTop()},{x:t[0].x,y:i.viewPortHandler.bottom}]];var e=rt(t[0],t[1],[{x:i.viewPortHandler.contentLeft(),y:t[0].y},{x:i.viewPortHandler.contentRight(),y:t[0].y}]);return[[{x:i.viewPortHandler.contentLeft(),y:e[0]},{x:i.viewPortHandler.contentRight(),y:e[1]}]]}))}},{key:"renderHorizontalRayLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.HORIZONTAL_RAY_LINE,e,nt,(function(t){var e={x:i.viewPortHandler.contentLeft(),y:t[0].y};return t[1].x>t[0].x&&(e.x=i.viewPortHandler.contentRight()),[[t[0],e]]}))}},{key:"renderVerticalRayLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.VERTICAL_RAY_LINE,e,nt,(function(t){var e={x:t[0].x,y:i.viewPortHandler.contentTop()};return t[1].y>t[0].y&&(e.y=i.viewPortHandler.contentBottom()),[[t[0],e]]}))}},{key:"renderRayLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.RAY_LINE,e,nt,(function(t){var e;return e=t[0].x===t[1].x&&t[0].y!==t[1].y?t[1].y>t[0].y?{x:t[0].x,y:i.viewPortHandler.contentBottom()}:{x:t[0].x,y:i.viewPortHandler.contentTop()}:t[0].x>t[1].x?{x:i.viewPortHandler.contentLeft(),y:rt(t[0],t[1],[{x:i.viewPortHandler.contentLeft(),y:t[0].y}])[0]}:{x:i.viewPortHandler.contentRight(),y:rt(t[0],t[1],[{x:i.viewPortHandler.contentRight(),y:t[0].y}])[0]},[[t[0],e]]}))}},{key:"renderSegmentLine",value:function(t,e){this.renderPointMarker(t,G.HORIZONTAL_SEGMENT_LINE,e,ot),this.renderPointMarker(t,G.VERTICAL_SEGMENT_LINE,e,ot),this.renderPointMarker(t,G.SEGMENT_LINE,e,ot)}},{key:"renderPriceLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.PRICE_LINE,e,nt,(function(t){return[[t[0],{x:i.viewPortHandler.contentRight(),y:t[0].y}]]}),!0)}},{key:"renderPriceChannelLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.PRICE_CHANNEL_LINE,e,at,(function(t){return ht(t,i.viewPortHandler,!0)}))}},{key:"renderParallelStraightLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.PARALLEL_STRAIGHT_LINE,e,at,(function(t){return ht(t,i.viewPortHandler)}))}},{key:"renderFibonacciLine",value:function(t,e){var i=this;this.renderPointMarker(t,G.FIBONACCI_LINE,e,at,(function(t){return lt(t,i.viewPortHandler)}),!0,["(100.0%)","(78.6%)","(61.8%)","(50.0%)","(38.2%)","(23.6%)","(0.0%)"])}},{key:"renderPointMarker",value:function(t,e,i,r,a,n,o){var s=this;this.dataProvider.markerDatas[e].forEach((function(e){var h=e.drawStep,l=[];e.points.forEach((function(t){var e=(t.xPos-s.dataProvider.minPos)*s.dataProvider.dataSpace,i=s.yRender.getY(t.price);l.push({x:e,y:i})}));var c=a?a(l):[l];s.renderMarker(t,c,l,i,h,r,n,o)}))}},{key:"renderMarker",value:function(t,e,i,r,a,n,o){var s=this,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],l=this.dataProvider.markerPoint,c=!1,d=r.text.valueFormatter;e.forEach((function(e,i){if(e.length>1){var u=n(e[0],e[1],l);if(c||(c=u),a!==Y&&(t.strokeStyle=r.line.color,t.lineWidth=r.line.size,t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.closePath(),o)){var v=s.yRender.getValue(e[0].y),f=M(v);R(d)&&(f=d(v)||"--"),t.font="".concat(r.text.size,"px Arial"),t.fillStyle=r.text.color,t.fillText("".concat(f," ").concat(h[i]||""),e[0].x+r.text.marginLeft,e[0].y-r.text.marginBottom)}}}));for(var u=r.point.radius,v=!1,f=0;i.length>f&&!(v=st(i[f],u,l));f++);i.forEach((function(e){var i=st(e,u,l);if(v||c){var a=i?r.point.activeRadius:u,n=i?r.point.activeBorderColor:r.point.borderColor,o=i?r.point.activeBorderSize:r.point.borderSize;t.fillStyle=i?r.point.activeBackgroundColor:r.point.backgroundColor,t.beginPath(),t.arc(e.x,e.y,a,0,2*Math.PI),t.closePath(),t.fill(),t.lineWidth=o,t.strokeStyle=n,t.beginPath(),t.arc(e.x,e.y,a,0,2*Math.PI),t.closePath(),t.stroke()}}))}}]),e}(P),dt=function(t){function e(t,r,a,n){var o;return i(this,e),(o=d(this,l(e).call(this,t,r))).markerRender=new ct(o.viewPortHandler,a,n),o}return h(e,t),a(e,[{key:"draw",value:function(){var t=this.config.marker;this.markerRender.renderHorizontalStraightLine(this.ctx,t),this.markerRender.renderVerticalStraightLine(this.ctx,t),this.markerRender.renderStraightLine(this.ctx,t),this.markerRender.renderHorizontalRayLine(this.ctx,t),this.markerRender.renderVerticalRayLine(this.ctx,t),this.markerRender.renderRayLine(this.ctx,t),this.markerRender.renderSegmentLine(this.ctx,t),this.markerRender.renderPriceLine(this.ctx,t),this.markerRender.renderPriceChannelLine(this.ctx,t),this.markerRender.renderParallelStraightLine(this.ctx,t),this.markerRender.renderFibonacciLine(this.ctx,t)}}]),e}(p),ut=function(t){function r(t,e,a,n,o,s,h,c){var u;return i(this,r),(u=d(this,l(r).call(this,t,e))).candleViewPortHandler=a,u.volViewPortHandler=n,u.subIndicatorViewPortHandler=o,u.candleYAxisRender=s,u.volYAxisRender=h,u.subIndicatorYAxisRender=c,u}return h(r,t),a(r,[{key:"renderCrossHorizontalLine",value:function(t,e,i,r,a,n){var o=this.getCrossYAxisLabel(n,e,i),s=this.dataProvider.crossPoint;if(o&&s&&n.cross.display){var h,l=n.cross.text.horizontal,c=l.size,d=g(c,o),u=this.viewPortHandler.contentLeft(),v=this.viewPortHandler.contentRight(),f=this.viewPortHandler.getContentCenter(),m=l.paddingLeft,y=l.paddingTop,p=l.borderSize,P=d+2*p+m+l.paddingRight,x=c+2*p+y+l.paddingBottom;a?h=r?u-P:v:s.x>f.x?(u=this.viewPortHandler.contentLeft()+P,h=this.viewPortHandler.contentLeft()+1):h=(v=this.viewPortHandler.contentRight()-P)-1,t.lineWidth=n.cross.line.size,t.strokeStyle=n.cross.line.color,n.cross.line.style===I&&t.setLineDash(n.cross.line.dashValue),t.beginPath(),t.moveTo(u,s.y),t.lineTo(v,s.y),t.stroke(),t.closePath(),t.setLineDash([]);var k=s.y-p-y-c/2;t.fillStyle=l.backgroundColor,t.fillRect(h,k,P,x),t.lineWidth=p,t.strokeStyle=l.borderColor,t.strokeRect(h,k,P,x),t.textBaseline="middle",t.fillStyle=l.color,t.font="".concat(c,"px Arial"),t.fillText(o,h+p+m,s.y)}}},{key:"getCrossYAxisLabel",value:function(t,e,i){if(!this.dataProvider.crossPoint)return null;var r,a=this.dataProvider.crossPoint.y;if(a&&a>0&&this.candleViewPortHandler.height+this.volViewPortHandler.height+this.subIndicatorViewPortHandler.height>a){var n,o;a>0&&a<this.candleViewPortHandler.contentBottom()?(n=this.candleYAxisRender,o=e,r=0):a>this.candleViewPortHandler.contentBottom()&&a<this.candleViewPortHandler.contentBottom()+this.volViewPortHandler.height?(n=this.volYAxisRender,o=T.VOL,r=this.candleViewPortHandler.height):(n=this.subIndicatorYAxisRender,o=i,r=this.candleViewPortHandler.height+this.volViewPortHandler.height);var s=n.getValue(a-r),h=s.toFixed(2);o===T.VOL&&(h=s.toFixed(0));var l=t.cross.text.horizontal.valueFormatter;return R(l)&&(h=l(o,s)||"--"),h}return null}},{key:"renderCrossVerticalLine",value:function(t,e,i){var r=this.dataProvider.crossPoint;if(r&&i.cross.display){var a=i.cross.line;t.lineWidth=a.size,t.strokeStyle=a.color,a.style===I&&t.setLineDash(a.dashValue),t.beginPath(),t.moveTo(r.x,this.viewPortHandler.contentTop()),t.lineTo(r.x,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath(),t.setLineDash([]);var n=x(e.timestamp),o=i.cross.text.vertical,s=o.valueFormatter;R(s)&&(n=s(e)||"--");var h=o.size,l=g(h,n),c=r.x-l/2,d=o.paddingLeft,u=o.paddingRight,v=o.paddingTop,f=o.paddingBottom,m=o.borderSize;c<this.viewPortHandler.contentLeft()+d+m?c=this.viewPortHandler.contentLeft()+d+m:c>this.viewPortHandler.contentRight()-l-m-u&&(c=this.viewPortHandler.contentRight()-l-m-u);var y=c-m-d,p=this.viewPortHandler.contentBottom(),P=c+l+m+u,k=this.viewPortHandler.contentBottom()+h+2*m+v+f;t.fillStyle=o.backgroundColor,t.fillRect(y,p,P-y,k-p),t.lineWidth=m,t.strokeStyle=o.borderColor,t.strokeRect(y,p,P-y,k-p),t.textBaseline="top",t.font="".concat(h,"px Arial"),t.fillStyle=o.color,t.fillText(n,c,this.viewPortHandler.contentBottom()+m+v)}}},{key:"renderMainChartTooltip",value:function(t,e,i,r,a,n){var o=a.data.base,s=a.data.indicator,h=n.lineColors,l=this.getRenderIndicatorTooltipData(e,i,s);if(o.showType===z){var c=o.text.marginTop;this.renderMainChartFixedBaseDataTooltipText(t,c,e,o),r&&this.renderIndicatorTooltipText(t,c+=o.text.size+o.text.marginBottom+a.data.indicator.text.marginTop,l,s,h)}else this.renderMainChartFloatRectText(t,e,r?l:{},o,s,h);r&&this.renderIndicatorLineCircle(t,i,this.candleViewPortHandler.contentTop(),l.values,this.candleYAxisRender,h)}},{key:"renderIndicatorChartTooltip",value:function(t,e,i,r,a,n,o){var s=a.data.indicator,h=this.getRenderIndicatorTooltipData(i,r,s),l=n.lineColors;this.renderIndicatorTooltipText(t,e+s.text.marginTop,h,s,l);var c=o?this.candleViewPortHandler.height+this.volViewPortHandler.contentTop():this.candleViewPortHandler.height+this.volViewPortHandler.height+this.subIndicatorViewPortHandler.contentTop();this.renderIndicatorLineCircle(t,r,c,h.values,o?this.volYAxisRender:this.subIndicatorYAxisRender,l)}},{key:"renderMainChartFixedBaseDataTooltipText",value:function(t,i,r,a){var n=this.getMainChartBaseValues(r,a),o=a.text.marginLeft,s=a.text.marginRight,h=a.text.size,l=a.text.color,c=a.labels;t.textBaseline="top",t.font="".concat(h,"px Arial");var d=this.viewPortHandler.contentLeft()+o;c.forEach((function(r,a){var c="".concat(r,": "),u=g(h,c);t.fillStyle=l,t.fillText(c,d,i),d+=u;var v,f=n[a]||"--";"object"===e(f)?(v=f.value||"--",t.fillStyle=f.color||l):(t.fillStyle=l,v=f);var m=g(h,v);t.fillText(v,d,i),d+=m+o+s}))}},{key:"renderMainChartFloatRectText",value:function(t,i,r,a,n){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=a.labels,h=this.getMainChartBaseValues(i,a),l=a.text.marginLeft,c=a.text.marginRight,d=a.text.marginTop,u=a.text.marginBottom,v=a.text.size,f=a.text.color;t.textBaseline="top";var m=0;s.forEach((function(t,i){var r=h[i]||"--",a=r;"object"===e(r)&&(a=r.value||"--");var n="".concat(t,": ").concat(a),o=g(v,n)+l+c;m=Math.max(m,o)}));var y=r.labels||[],p=r.values||[],P=n.text.marginLeft,x=n.text.marginRight,k=n.text.marginTop,M=n.text.marginBottom,L=n.text.size;y.forEach((function(t,e){var i=p[e]||"--",r="".concat(t,": ").concat(i),a=g(L,r)+P+x;m=Math.max(m,a)}));var w,R=a.floatRect,A=R.borderSize,C=R.paddingLeft,T=R.paddingRight,I=R.paddingTop,b=R.paddingBottom,E=R.left,S=R.right,D=2*A+m+C+T,H=2*A+I+b+(u+d+v)*s.length+(k+M+L)*y.length,N=this.volViewPortHandler.getContentCenter(),_=this.dataProvider.crossPoint;w=_&&N.x>_.x?this.viewPortHandler.contentRight()-S-D:this.viewPortHandler.contentLeft()+E;var O=R.top,F=R.borderRadius;t.lineWidth=A,t.strokeStyle=R.borderColor,t.fillStyle=R.fillColor,this.renderRoundRect(t,w,O,D,H,F),t.stroke(),this.renderRoundRect(t,w,O,D,H,F),t.fill();var B=w+A+C+l,V=O+A+I;t.font="".concat(v,"px Arial"),s.forEach((function(i,r){V+=d,t.textAlign="left",t.fillStyle=f,t.fillText("".concat(i,": "),B,V);var a,n=h[r]||"--";t.fillStyle=n.color||f,a="object"===e(n)?n.value||"--":n,t.textAlign="right",t.fillText(a,w+D-A-c-T,V),V+=v+u}));var z=w+A+C+P,G=o.length;t.font="".concat(L,"px Arial"),y.forEach((function(e,i){V+=k,t.textAlign="left",t.fillStyle=o[i%G]||n.text.color,t.fillText("".concat(e,": "),z,V),t.textAlign="right",t.fillText(p[i]||"--",w+D-A-x-T,V),V+=L+M})),t.textAlign="left"}},{key:"renderRoundRect",value:function(t,e,i,r,a,n){t.beginPath(),t.moveTo(e+n,i),t.arcTo(e+r,i,e+r,i+a,n),t.arcTo(e+r,i+a,e,i+a,n),t.arcTo(e,i+a,e,i,n),t.arcTo(e,i,e+r,i,n),t.closePath()}},{key:"getMainChartBaseValues",value:function(t,e){var i=e.values,r=[];if(i)r=R(i)?i(t)||[]:i;else{var a=e.text.valueFormatter;r=[k(t,"timestamp"),k(t,"open"),k(t,"close"),k(t,"high"),k(t,"low"),k(t,"volume")],R(a)?r.forEach((function(t,e){r[e]=a(e,t)||"--"})):r.forEach((function(t,e){switch(e){case 0:r[e]=x(t);break;case r.length-1:r[e]=M(t,0);break;default:r[e]=M(t)}}))}return r}},{key:"renderIndicatorTooltipText",value:function(t,e,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],n=i.name,o=i.labels,s=i.values,h=r.text,l=h.marginLeft,c=h.marginRight,d=this.viewPortHandler.contentLeft()+l,u=h.size,v=r.text.color,f=a.length;t.textBaseline="top",t.font="".concat(u,"px Arial");var m=g(u,n);t.fillStyle=v,t.fillText(n,d,e),d+=l+m;for(var y=0;o.length>y;y++){var p="".concat(o[y],": ").concat(s[y]||"--"),P=g(u,p);t.fillStyle=a[y%f]||v,t.fillText(p,d,e),d+=l+c+P}}},{key:"renderIndicatorLineCircle",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=this.dataProvider.crossPoint;if(o&&this.dataProvider.currentMarkerType===G.NONE&&e!==T.SAR&&!this.dataProvider.isDragMarker)for(var s=n.length,h=e===T.MACD||e===T.VOL?r.length-1:r.length,l=0;h>l;l++){var c=r[l];if(c||0===c){var d=a.getY(c)+i;t.fillStyle=n[l%s],t.beginPath(),t.arc(o.x,d,3,0,2*Math.PI),t.closePath(),t.fill()}}}},{key:"getRenderIndicatorTooltipData",value:function(t,e,i){var r=[],a=[],n="";switch(e){case T.MA:var o=k(t,"ma");r=[k(o,"ma5"),k(o,"ma10"),k(o,"ma20"),k(o,"ma60")],a=["MA5","MA10","MA20","MA60"],n="MA(5,10,20,60)";break;case T.MACD:var s=k(t,"macd");r=[k(s,"diff"),k(s,"dea"),k(s,"macd")],a=["DIFF","DEA","MACD"],n="MACD(12,26,9)";break;case T.VOL:var h=k(t,"vol");r=[k(h,"ma5"),k(h,"ma10"),k(h,"ma20"),k(h,"num")],a=["MA5","MA10","MA20","NUM"],n="VOLUME(5,10,20)";break;case T.BOLL:var l=k(t,"boll");r=[k(l,"up"),k(l,"mid"),k(l,"dn")],a=["UP","MID","DN"],n="BOLL(20)";break;case T.BIAS:var c=k(t,"bias");r=[k(c,"bias1"),k(c,"bias2"),k(c,"bias3")],a=["BIAS6","BIAS12","BIAS24"],n="BIAS(6,12,24)";break;case T.BRAR:var d=k(t,"brar");r=[k(d,"br"),k(d,"ar")],a=["BR","AR"],n="BRAR(26)";break;case T.CCI:var u=k(t,"cci");r=[k(u,"cci")],a=["CCI"],n="CCI(13)";break;case T.CR:var v=k(t,"cr");r=[k(v,"cr"),k(v,"ma1"),k(v,"ma2"),k(v,"ma3"),k(v,"ma4")],a=["CR","MA1","MA2","MA3","MA4"],n="CR(26,10,20,40,60)";break;case T.DMA:var f=k(t,"dma");r=[k(f,"dif"),k(f,"difMa")],a=["DIF","DIFMA"],n="DMA(10,50,10)";break;case T.DMI:var m=k(t,"dmi");r=[k(m,"mdi"),k(m,"pdi"),k(m,"adx"),k(m,"adxr")],a=["MDI","PDI","ADX","ADXR"],n="DMI(14,6)";break;case T.KDJ:var y=k(t,"kdj");r=[k(y,"k"),k(y,"d"),k(y,"j")],a=["K","D","J"],n="KDJ(9,3,3)";break;case T.RSI:var g=k(t,"rsi");r=[k(g,"rsi1"),k(g,"rsi2"),k(g,"rsi3")],a=["RSI6","RSI12","RSI24"],n="RSI(6,12,24)";break;case T.PSY:var p=k(t,"psy");r=[k(p,"psy")],a=["PSY"],n="PSY(12)";break;case T.TRIX:var P=k(t,"trix");r=[k(P,"trix"),k(P,"maTrix")],a=["TRIX","MATRIX"],n="TRIX(12,20)";break;case T.OBV:var x=k(t,"obv");r=[k(x,"obv"),k(x,"maObv")],a=["OBV","MAOBV"],n="OBV(30)";break;case T.VR:var L=k(t,"vr");r=[k(L,"vr"),k(L,"maVr")],a=["VR","MAVR"],n="VR(24,30)";break;case T.WR:var w=k(t,"wr");r=[k(w,"wr1"),k(w,"wr2"),k(w,"wr3")],a=["WR1","WR2","WR3"],n="WR(13,34,89)";break;case T.MTM:var A=k(t,"mtm");r=[k(A,"mtm"),k(A,"mtmMa")],a=["MTM","MTMMA"],n="MTM(6,10)";break;case T.EMV:var C=k(t,"emv");r=[k(C,"emv"),k(C,"maEmv")],a=["EMV","MAEMV"],n="EMV(14,9)";break;case T.SAR:var I=k(t,"sar");r=[k(I,"sar")],a=["SAR"],n="SAR"}var b=i.text.valueFormatter;if(R(b))r.forEach((function(t,i){r[i]=b(e,t)||"--"}));else{var E=e===T.VOL?0:2;r.forEach((function(t,e){r[e]=M(t,E)}))}return{labels:a,values:r,name:n}}}]),r}(P),vt=function(t){function e(t,r,a,n,o,s,h){var c;return i(this,e),(c=d(this,l(e).call(this,t,r))).mainChart=a,c.volChart=n,c.subIndicatorChart=o,c.dataProvider=h,c.tooltipRender=new ut(c.viewPortHandler,h,a.viewPortHandler,n.viewPortHandler,o.viewPortHandler,a.yAxisRender,n.yAxisRender,o.yAxisRender),c}return h(e,t),a(e,[{key:"draw",value:function(){var t=this.dataProvider.dataList[this.dataProvider.currentTooltipDataPos]||{},e=this.config.tooltip;this.dataProvider.currentMarkerType!==G.NONE||this.dataProvider.isDragMarker||(this.tooltipRender.renderCrossHorizontalLine(this.ctx,this.mainChart.indicatorType,this.subIndicatorChart.indicatorType,this.config.yAxis.position===b,this.config.yAxis.tick.text.position===S,e),this.tooltipRender.renderCrossVerticalLine(this.ctx,t,e));var i=e.data;if(i.displayRule===B||i.displayRule===V&&this.dataProvider.crossPoint){var r=this.config.indicator;this.tooltipRender.renderMainChartTooltip(this.ctx,t,this.mainChart.indicatorType,this.mainChart.chartType===D.CANDLE,e,r),this.volChart.indicatorType!==T.NO&&this.tooltipRender.renderIndicatorChartTooltip(this.ctx,this.mainChart.viewPortHandler.height,t,T.VOL,e,r,!0),this.subIndicatorChart.indicatorType!==T.NO&&this.tooltipRender.renderIndicatorChartTooltip(this.ctx,this.mainChart.viewPortHandler.height+this.volChart.viewPortHandler.height,t,this.subIndicatorChart.indicatorType,e,r)}}}]),e}(p),ft=function(t){function e(){return i(this,e),d(this,l(e).apply(this,arguments))}return h(e,t),a(e,[{key:"renderStrokeLine",value:function(t,e,i){i&&(t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentTop()),t.stroke(),t.closePath())}},{key:"renderAxisLine",value:function(t,e){e.display&&e.line.display&&(t.strokeStyle=e.line.color,t.lineWidth=e.line.size,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom()),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentBottom()),t.stroke(),t.closePath())}},{key:"renderAxisLabels",value:function(t,e){var i=e.tick.text;if(e.display&&i.display){var r=e.tick.line;t.textBaseline="top",t.font="".concat(i.size,"px Arial"),t.textAlign="center",t.fillStyle=i.color;var a=this.viewPortHandler.contentBottom()+i.margin;r.display&&(a+=r.length);for(var n=i.valueFormatter,o=0;this.valuePoints.length>o;o++){var s=this.valuePoints[o],h=this.dataProvider.dataList[parseInt(this.values[o])],l=x(h.timestamp);R(n)&&(l=n(h)),t.fillText(l,s,a)}}}},{key:"renderSeparatorLines",value:function(t,e){if(e.display&&e.separatorLine.display){t.strokeStyle=e.separatorLine.color,t.lineWidth=e.separatorLine.size,e.separatorLine.style===I&&t.setLineDash(e.separatorLine.dashValue);for(var i=0;this.valuePoints.length>i;i++){var r=this.valuePoints[i];t.beginPath(),t.moveTo(r,this.viewPortHandler.contentTop()),t.lineTo(r,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath()}t.setLineDash([])}}},{key:"renderTickLines",value:function(t,e){var i=e.tick.line;if(e.display&&i.display){t.lineWidth=i.size,t.strokeStyle=i.color;for(var r=this.viewPortHandler.contentBottom(),a=r+i.length,n=0;this.valuePoints.length>n;n++){var o=this.valuePoints[n];t.beginPath(),t.moveTo(o,r),t.lineTo(o,a),t.stroke(),t.closePath()}}}},{key:"computeAxis",value:function(t){var e=this.dataProvider.minPos;this.computeAxisValues(e,Math.min(e+this.dataProvider.range-1,this.dataProvider.dataList.length-1),t),this.pointValuesToPixel()}},{key:"fixComputeAxisValues",value:function(t){var e=this.dataProvider.dataList.length;if(e>0){var i=g(t.tick.text.size,"0000-00-00 00:00:00"),r=Math.ceil(i/2/this.dataProvider.dataSpace)-1;r>e-1&&(r=e-1);var a=Math.ceil(i/(1.26*this.dataProvider.dataSpace))+1;this.valueCount=e>a?Math.floor((e-r)/a)+1:1,this.values=[r];for(var n=1;this.valueCount>n;n++)this.values[n]=r+n*(a-1)}else this.valueCount=0,this.values=[]}},{key:"pointValuesToPixel",value:function(){var t=this.viewPortHandler.contentLeft();this.valuePoints=[];for(var e=0;this.values.length>e;e++){this.valuePoints[e]=t+((this.values[e]-this.dataProvider.minPos)*this.dataProvider.dataSpace+.74*this.dataProvider.dataSpace/2)}}},{key:"calcRange",value:function(t,e){return 0>t?0:Math.abs(t-e)+1}},{key:"isFillChart",value:function(){return this.dataProvider.dataList.length>this.dataProvider.range}}]),e}(Q),mt=function(t){function e(t,r,a){var n;return i(this,e),(n=d(this,l(e).call(this,t,r))).xAxisRender=new ft(n.viewPortHandler,a),n}return h(e,t),a(e,[{key:"draw",value:function(){var t=this.config.xAxis;this.xAxisRender.computeAxis(t),this.xAxisRender.renderAxisLine(this.ctx,t),this.xAxisRender.renderAxisLabels(this.ctx,t),this.xAxisRender.renderSeparatorLines(this.ctx,t),this.xAxisRender.renderTickLines(this.ctx,t),this.xAxisRender.renderStrokeLine(this.ctx,t,this.config.grid)}}]),e}(p),yt={};function gt(t,e){for(var i=0,r=0,a=t.length,n=0;a>n;n++){i+=t[n].turnover||0,t[n].average=0!==(r+=t[n].volume||0)?i/r:0,e(n)}return t}function pt(t,e){for(var i=0,r=0;t.length>r;r++){var a=t[r].close-e;i+=a*a}var n=i>0,o=Math.sqrt((i=Math.abs(i))/t.length);return n?o:-1*o}function Pt(t){var e=0;if(t&&t.length>0){var i=t.length;e=t[0].high;for(var r=1;i>r;r++)e=Math.max(t[r].high,e)}return e}function xt(t){var e=0;if(t&&t.length>0){var i=t.length;e=t[0].low;for(var r=1;i>r;r++)e=Math.min(t[r].low,e)}return e}function kt(t){var e=0,i=0;if(t&&t.length>0){var r=t.length;e=t[0].high,i=t[0].low;for(var a=1;r>a;a++)e=Math.max(t[a].high,e),i=Math.min(t[a].low,i)}return[e,i]}function Mt(t){return t.match(/(iPad).*OS\s([\d_]+)/)}function Lt(t){return Mt(t)||function(t){return!Mt(t)&&t.match(/(iPhone\sOS)\s([\d_]+)/)}(t)||function(t){return t.match(/(Android);?[\s\/]+([\d.]+)?/)}(t)}yt[T.MA]=function(t){var e,i,r,a,n=0,o=0,s=0,h=0;return gt(t,(function(l){var c=t[l].close;n+=c,o+=c,s+=c,h+=c,e=5>l?n/(l+1):(n-=t[l-5].close)/5,i=10>l?o/(l+1):(o-=t[l-10].close)/10,r=20>l?s/(l+1):(s-=t[l-20].close)/20,a=60>l?h/(l+1):(h-=t[l-60].close)/60,t[l].ma={ma5:e,ma10:i,ma20:r,ma60:a}}))},yt[T.VOL]=function(t){var e,i,r,a=0,n=0,o=0;return gt(t,(function(s){var h=t[s].volume;a+=h,n+=h,o+=h,e=5>s?a/(s+1):(a-=t[s-5].volume)/5,i=10>s?n/(s+1):(n-=t[s-10].volume)/10,r=20>s?o/(s+1):(o-=t[s-20].volume)/20,t[s].vol={num:h,ma5:e,ma10:i,ma20:r}}))},yt[T.MACD]=function(t){var e,i,r=0,a=0,n=0,o=0,s=0;return gt(t,(function(h){var l=t[h].close;0===h?(e=l,i=l):(e=(2*l+11*r)/13,i=(2*l+25*a)/27),r=e,a=i,s=o=(2*(n=e-i)+8*s)/10,t[h].macd={diff:n,dea:o,macd:2*(n-o)}}))},yt[T.BOLL]=function(t){var e,i,r=0;return gt(t,(function(a){r+=t[a].close,20>a?(e=r/(a+1),i=pt(t.slice(0,a+1),e)):(e=(r-=t[a-20].close)/20,i=pt(t.slice(a-19,a+1),e)),t[a].boll={up:e+2*i,mid:e,dn:e-2*i}}))},yt[T.KDJ]=function(t){var e,i,r,a;return gt(t,(function(n){var o=t[n].close;8>n?(r=xt(t.slice(0,n+1)),a=Pt(t.slice(0,n+1))):(r=xt(t.slice(n-8,n+1)),a=Pt(t.slice(n-8,n+1))),t[n].kdj={k:e=2/3*(8>n?50:t[n-1].kdj.k)+1/3*((o-r)/(a-r==0?1:a-r)*100),d:i=2/3*(8>n?50:t[n-1].kdj.d)+1/3*e,j:3*e-2*i}}))},yt[T.RSI]=function(t){var e,i,r,a,n,o,s=0,h=0,l=0,c=0,d=0,u=0,v=0,f=0,m=0;return gt(t,(function(y){if(y>0&&y>0){var g=t[y].close-t[y-1].close;if(g>0)c+=g,u+=g,f+=g;else{var p=Math.abs(g);d+=p,v+=p,m+=p}if(6>y)e=c/(y+1),i=(c+d)/(y+1);else{if(y>6){var P=t[y-6].close-t[y-7].close;P>0?c-=P:d-=Math.abs(P)}e=c/6,i=(c+d)/6}if(s=0!==i?e/i*100:0,12>y)r=u/(y+1),a=(u+v)/(y+1);else{if(y>12){var x=t[y-12].close-t[y-13].close;x>0?u-=x:v-=Math.abs(x)}r=u/12,a=(u+v)/12}if(h=0!==a?r/a*100:0,24>y)n=f/(y+1),o=(f+m)/(y+1);else{if(y>24){var k=t[y-24].close-t[y-25].close;k>0?f-=k:m-=Math.abs(k)}n=f/24,o=(f+m)/24}l=0!==o?n/o*100:0}t[y].rsi={rsi1:s,rsi2:h,rsi3:l}}))},yt[T.BIAS]=function(t){var e,i,r,a=0,n=0,o=0;return gt(t,(function(s){var h=t[s].close;a+=h,n+=h,o+=h,e=6>s?a/(s+1):(a-=t[s-6].close)/6,i=12>s?n/(s+1):(n-=t[s-12].close)/12,r=24>s?o/(s+1):(o-=t[s-24].close)/24,t[s].bias={bias1:(h-e)/e*100,bias2:(h-i)/i*100,bias3:(h-r)/r*100}}))},yt[T.BRAR]=function(t){var e=0,i=0,r=0,a=0,n=0,o=0;return gt(t,(function(s){var h=t[s].high,l=t[s].low,c=t[s].open;if(n+=h-c,o+=c-l,s>0){var d=t[s-1].close;if(r+=h-d,a+=d-l,s>25){var u=t[s-26].high,v=t[s-26].low,f=t[s-26].open;if(s>26){var m=t[s-27].close;r-=u-m,a-=m-v}n-=u-f,o-=f-v}i=0!==o?n/o*100:0,e=0!==a?r/a*100:0}t[s].brar={br:e,ar:i}}))},yt[T.CCI]=function(t){var e,i,r=0,a=[],n=0;return gt(t,(function(o){var s=t[o].close;r+=s;var h=(t[o].high+t[o].low+s)/3;if(13>o)n+=Math.abs((e=r/(o+1))-s),a.push(e),i=n/(o+1);else{var l=t[o-13].close;a.push(e=(r-=l)/13),n+=Math.abs(e-s),i=(n-=Math.abs(a[o-13]-l))/13}t[o].cci={cci:0!==i?(h-e)/i/.015:0}}))},yt[T.DMI]=function(t){var e=0,i=0,r=0,a=0,n=[0],o=0,s=[0],h=0,l=[0],c=0,d=[0],u=0;return gt(t,(function(v){if(v>0){var f=t[v-1].close,m=t[v].high,y=t[v].low,g=m-y,p=Math.abs(m-f),P=Math.abs(y-f),x=m-t[v-1].high,k=t[v-1].low-y,M=Math.max(Math.max(g,p),P);o+=M,n.push(M);var L=x>0&&x>k?x:0;h+=L,s.push(L);var w=k>0&&k>x?k:0;c+=w,l.push(w),v>13&&(o-=n[v-14],h-=s[v-14],c-=l[v-14]),0===o?(e=0,i=0):(e=100*h/o,i=100*c/o);var R=Math.abs(i-e)/(i+e)*100;if(u+=R,d.push(R),6>v)a=r=u/(v+1);else{var A=d[v-6];a=((r=(u-=A)/6)+A)/2}}t[v].dmi={pdi:e,mdi:i,adx:r,adxr:a}}))},yt[T.CR]=function(t){var e,i,r,a,n=0,o=0,s=0,h=0,l=[],c=0,d=[],u=0,v=[],f=0,m=[];return gt(t,(function(y){if(y>0){var g=(t[y-1].high+t[y-1].close+t[y-1].low+t[y-1].open)/4,p=t[y].high-g;0>p&&(p=0),o+=p;var P=g-t[y].low;if(0>P&&(P=0),s+=P,y>26){var x=(t[y-27].high+t[y-27].low+t[y-27].close+t[y-27].open)/4,k=t[y-26].high-x;0>k&&(k=0);var M=x-t[y-26].low;0>M&&(M=0),o-=k,s-=M}0!==s&&(n=o/s*100);var L=(t[y-1].high+t[y-1].low+t[y-1].close)/3,w=t[y].high-L;o+=w>0?w:0;var R=L-t[y].low;s+=R>0?R:0}h+=n,c+=n,u+=n,f+=n,e=10>y?h/(y+1):(h-=t[y-10].cr.cr)/10,l.push(e),i=20>y?c/(y+1):(c-=t[y-20].cr.cr)/20,d.push(i),r=40>y?u/(y+1):(u-=t[y-40].cr.cr)/40,v.push(r),a=60>y?f/(y+1):(f-=t[y-60].cr.cr)/60,m.push(a),t[y].cr={cr:n,ma1:5>y?l[0]:l[y-5],ma2:9>y?d[0]:d[y-9],ma3:17>y?v[0]:v[y-17],ma4:25>y?m[0]:m[y-25]}}))},yt[T.PSY]=function(t){var e=0,i=0;return gt(t,(function(r){r>0&&(i+=t[r].close-t[r-1].close>0?1:0,12>r?e=i/(r+1)*100:(r>12&&(i-=t[r-11].close-t[r-12].close>0?1:0),e=i/12*100)),t[r].psy={psy:e}}))},yt[T.DMA]=function(t){var e,i,r,a,n=0,o=0,s=0;return gt(t,(function(h){var l=t[h].close;n+=l,o+=l,r=10>h?n/(h+1):(n-=t[h-10].close)/10,a=50>h?o/(h+1):(o-=t[h-50].close)/50,s+=e=r-a,i=10>h?s/(h+1):(s-=t[h-10].dma.dif)/10,t[h].dma={dif:e,difMa:i}}))},yt[T.TRIX]=function(t){var e,i,r,a,n=0,o=0,s=0,h=0,l=0,c=[];return gt(t,(function(d){var u=t[d].close;if(0===d)a=r=i=u;else{a=(2*(r=(2*(i=(2*u+11*s)/13)+11*h)/13)+11*l)/13;var v=c[d-1];n=0===v?0:(a-v)/v*100}s=i,h=r,l=a,c.push(a),o+=n,e=20>d?o/(d+1):(o-=t[d-20].trix.trix)/20,t[d].trix={trix:n,maTrix:e}}))},yt[T.OBV]=function(t){var e,i,r=0,a=0;return gt(t,(function(n){var o=t[n].volume;if(0===n)e=o,a+=o;else{var s=t[n-1].close,h=t[n].close;a+=h>s?o:-o,e=h===s?0:a}r+=e,i=30>n?r/(n+1):(r-=t[n-30].obv.obv)/30,t[n].obv={obv:e,maObv:i}}))},yt[T.VR]=function(t){var e,i=0,r=0,a=0,n=0,o=0;return gt(t,(function(s){var h=t[s].close,l=t[s].open,c=t[s].volume;if(h>l?i+=c:l>h?r+=c:a+=c,s>23){var d=t[s-24].close,u=t[s-24].open,v=t[s-24].volume;d>u?i-=v:u>d?r-=v:a-=v}var f=r+.5*a;0!==f&&(n=(i+.5*a)/f*100),o+=n,e=30>s?o/(s+1):(o-=t[s-30].vr.vr)/30,t[s].vr={vr:n,maVr:e}}))},yt[T.WR]=function(t){var e,i,r,a,n,o=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,d=Number.MAX_SAFE_INTEGER;return gt(t,(function(u){var v=t[u].close,f=t[u].high,m=t[u].low;if(13>u)o=Math.max(f,o),s=Math.min(m,s);else{var y=kt(t.slice(u-13,u));o=y[0],s=y[1]}if(e=0!==(r=o-s)?(o-v)/r*100:0,34>u)h=Math.max(f,h),l=Math.min(m,l);else{var g=kt(t.slice(u-34,u));h=g[0],l=g[1]}if(i=0!==(a=h-l)?(h-v)/a*100:0,89>u)c=Math.max(f,c),d=Math.min(m,d);else{var p=kt(t.slice(u-89,u));c=p[0],d=p[1]}t[u].wr={wr1:e,wr2:i,wr3:0!==(n=c-d)?(c-v)/n*100:0}}))},yt[T.MTM]=function(t){var e,i,r=0;return gt(t,(function(a){6>a?(e=0,i=0):(r+=e=t[a].close-t[a-6].close,16>a?i=r/(a-6+1):(i=r/10,r-=t[a-10].mtm.mtm));t[a].mtm={mtm:e,mtmMa:i}}))},yt[T.EMV]=function(t){var e,i=0,r=0,a=0,n=[];return gt(t,(function(o){if(o>0){var s=t[o].high,h=t[o].low;a=((s+h)/2-(t[o-1].high+t[o-1].low)/2)*(s-h)/t[o].turnover}n.push(a),14>o?i+=a:i-=n[o-14],r+=i,e=9>o?r/(o+1):(r-=t[o-9].emv.emv)/9,t[o].emv={emv:i,maEmv:e}}))},yt[T.SAR]=function(t){var e=0,i=-100,r=!1,a=0;return gt(t,(function(n){var o=a,s=t[n].high,h=t[n].low;if(r){(-100===i||s>i)&&(i=s,e=Math.min(e+.02,2)),a=o+e*(i-o);var l=Math.min(t[Math.max(1,n)-1].low,h);a>t[n].low?(a=i,e=0,i=-100,r=!r):a>l&&(a=l)}else{(-100===i||i>h)&&(i=h,e=Math.min(e+.02,.2)),a=o+e*(i-o);var c=Math.max(t[Math.max(1,n)-1].high,s);t[n].high>a?(a=i,e=0,i=-100,r=!r):c>a&&(a=c)}t[n].sar={sar:a}}))};var wt=function(){function t(e,r,a,n,o,s){i(this,t),this.tooltipChart=e,this.mainChart=r,this.volChart=a,this.subIndicatorChart=n,this.xAxisChart=o,this.dataProvider=s,this.viewPortHandler=e.viewPortHandler}return a(t,[{key:"drag",value:function(t,e){var i=this.dataProvider.dataSpace,r=this.dataProvider.dataList.length,a=this.dataProvider.range,n=this.dataProvider.minPos,o=e-t.x;if(o>i/2){if(0===n||a>r)return!1;t.x=e;var s=+Math.abs(o/i).toFixed(0);return 0===s&&(s=1),0>(n-=s)&&(n=0),this.dataProvider.minPos=n,this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),!0}if(0-i/2>o){if(n+a===r||a>r)return!1;t.x=e;var h=+Math.abs(o/i).toFixed(0);return 0===h&&(h=1),r-a>(n+=h)||(n=r-a),this.dataProvider.minPos=n,this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),!0}return!1}},{key:"zoom",value:function(t,e,i,r){var a=this.dataProvider.range,n=this.dataProvider.maxRange,o=this.dataProvider.minRange;if(t){if(a>=n)return!1}else if(o>=a)return!1;var s=i+r-(a=Math.min(Math.max(a=+(r/e).toFixed(0),o),n));return(s+a>this.dataProvider.dataList.length||0>s)&&(s=0),this.dataProvider.range=a,this.dataProvider.minPos=s,this.dataProvider.space(this.viewPortHandler.contentRight()-this.viewPortHandler.contentLeft()),this.mainChart.flush(),this.volChart.flush(),this.subIndicatorChart.flush(),this.xAxisChart.flush(),!0}},{key:"cross",value:function(t){this.dataProvider.crossPoint={x:t.x,y:t.y},this.dataProvider.calcCurrentTooltipDataPos(this.viewPortHandler.contentLeft(),t.x),this.tooltipChart.flush()}}]),t}();function Rt(t,e){return!(t.x<e.contentLeft()||t.x>e.contentRight()||t.y<e.contentTop()||t.y>e.contentBottom())}function At(t,e){var i=e.getBoundingClientRect();return{x:Math.round(t.clientX-i.left),y:Math.round(t.clientY-i.top)}}function Ct(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0,t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1}function Tt(t,e,i,r){var a=t-e,n=i-r;return Math.sqrt(a*a+n*n)}function It(t,e){if(2>t.targetTouches.length)return 0;var i=At(t.targetTouches[0],e),r=At(t.targetTouches[1],e),a=Math.abs(i.x-r.x),n=Math.abs(i.y-r.y);return Math.sqrt(a*a+n*n)}function bt(t,e){var i=At(t.targetTouches[0],e),r=At(t.targetTouches[1],e);return Math.abs(i.x-r.y)}var Et=0,St=4,Dt=5,Ht=function(t){function e(t,r,a,n,o,s){var h;return i(this,e),(h=d(this,l(e).call(this,t,r,a,n,o,s))).touchMode=Et,h.touchStartPoint={x:0,y:0},h.touchMovePoint={x:0,y:0},h.touchCrossPoint={x:0,y:0},h.savedDist=1,h.savedXDist=1,h.touchRange=s.range,h.touchStartPosition=s.minPos,h.delayTimeout=null,h.delayActiveCross=function(){h.touchMode!==Et&&h.touchMode!==Dt||h.tooltipChart&&(h.touchMode=St,h.touchCrossPoint={x:h.touchStartPoint.x,y:h.touchStartPoint.y},h.cross(h.touchCrossPoint))},h}return h(e,t),a(e,[{key:"touchStart",value:function(t){if(0!==this.dataProvider.dataList.length)if(1===t.targetTouches.length){var e=At(t.targetTouches[0],this.tooltipChart.canvasDom);if(this.touchStartPoint={x:e.x,y:e.y},this.touchMovePoint={x:e.x,y:e.y},!Rt(this.touchStartPoint,this.viewPortHandler))return;if(this.touchMode===St)Ct(t),10>Tt(e.x,this.touchCrossPoint.x,e.y,this.touchCrossPoint.y)?this.performCross(t):(this.touchMode=Dt,this.dataProvider.crossPoint=null,this.tooltipChart.flush());else this.touchMode=Et;this.removeDelayActiveCross(),this.postDelayDelayActiveCross()}else if(t.targetTouches.length>1){if(!Rt(this.touchStartPoint,this.viewPortHandler))return;this.touchMode!==St&&(Ct(t),this.savedDist=It(t,this.tooltipChart.canvasDom),this.savedXDist=bt(t,this.tooltipChart.canvasDom),this.savedDist>3&&(this.touchMode=2),this.touchRange=this.dataProvider.range,this.touchStartPosition=this.dataProvider.minPos)}}},{key:"touchMove",value:function(t){if(Rt(this.touchStartPoint,this.viewPortHandler)&&0!==this.dataProvider.dataList.length&&!this.waitingForMouseMoveAnimationFrame){switch(this.waitingForMouseMoveAnimationFrame=!0,this.touchMode){case 2:Ct(t),this.performZoom(t);break;case 1:Ct(t);var e=At(t.targetTouches[0],this.tooltipChart.canvasDom);this.drag(this.touchMovePoint,e.x);break;case St:Ct(t),this.performCross(t);break;case Dt:this.removeDelayActiveCross();break;case Et:var i=At(t.targetTouches[0],this.tooltipChart.canvasDom);if(Math.abs(Tt(i.x,this.touchStartPoint.x,i.y,this.touchStartPoint.y))>10){var r=Math.abs(i.x-this.touchStartPoint.x);Math.abs(i.y-this.touchStartPoint.y)>r||(Ct(t),this.dataProvider.crossPoint=null,this.touchMode=1,this.tooltipChart.flush())}this.removeDelayActiveCross()}this.waitingForMouseMoveAnimationFrame=!1}}},{key:"touchEnd",value:function(t){Rt(this.touchStartPoint,this.viewPortHandler)&&0!==this.dataProvider.dataList.length&&(Ct(t),t.targetTouches.length>0?this.touchMode===St?this.performCross(t):this.touchMode=3:(this.removeDelayActiveCross(),this.touchMode!==St&&(this.touchMode=Et,this.dataProvider.crossPoint=null,this.tooltipChart.flush())))}},{key:"performZoom",value:function(t){if(0===this.dataProvider.dataList.length)return!1;if(t.targetTouches.length>1&&It(t,this.tooltipChart.canvasDom)>10){var e=bt(t,this.tooltipChart.canvasDom)/this.savedXDist;this.zoom(1>e,e,this.touchStartPosition,this.touchRange)}}},{key:"performCross",value:function(t){if(0===this.dataProvider.dataList.length)return!1;var e=At(t.targetTouches[0],this.tooltipChart.canvasDom);this.touchCrossPoint={x:e.x,y:e.y},this.cross(this.touchCrossPoint)}},{key:"postDelayDelayActiveCross",value:function(){this.delayTimeout=setTimeout(this.delayActiveCross,200)}},{key:"removeDelayActiveCross",value:function(){this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null)}}]),e}(wt),Nt="cross",_t=function(t){function e(t,r,a,n,o,s,h){var c;return i(this,e),(c=d(this,l(e).call(this,t,r,a,n,o,h))).markerChart=s,c.mouseMode=Nt,c.mouseDownPoint={x:0,y:0},c}return h(e,t),a(e,[{key:"mouseDown",value:function(t){if(0!==this.dataProvider.dataList.length&&(Ct(t),0===t.button)){if(!Rt(At(t,this.tooltipChart.canvasDom),this.viewPortHandler))return;this.mouseMode="drag",this.mouseDownPoint.x=t.x,this.mouseDownPoint.y=t.y,this.dataProvider.crossPoint=null,this.tooltipChart.flush()}}},{key:"mouseUp",value:function(t){if(0!==this.dataProvider.dataList.length){Ct(t);var e=At(t,this.tooltipChart.canvasDom);Rt(e,this.viewPortHandler)&&(this.mouseMode=Nt,this.dataProvider.crossPoint={x:e.x,y:e.y},this.dataProvider.isDragMarker=!1,this.tooltipChart.flush())}}},{key:"mouseLeave",value:function(t){0!==this.dataProvider.dataList.length&&(Ct(t),this.dataProvider.crossPoint=null,this.tooltipChart.flush())}},{key:"mouseMove",value:function(t){if(0!==this.dataProvider.dataList.length){Ct(t);var e=At(t,this.tooltipChart.canvasDom);if(!Rt(e,this.viewPortHandler))return this.dataProvider.crossPoint=null,void this.tooltipChart.flush();this.waitingForMouseMoveAnimationFrame||(this.waitingForMouseMoveAnimationFrame=!0,"drag"===this.mouseMode?this.dataProvider.isDragMarker?this.cross(e):this.drag(this.mouseDownPoint,t.x)&&this.markerChart.flush():this.mouseMode===Nt&&this.cross(e),this.waitingForMouseMoveAnimationFrame=!1)}}},{key:"mouseWheel",value:function(t){if(0!==this.dataProvider.dataList.length&&!this.dataProvider.isDragMarker){var e=At(t,this.tooltipChart.canvasDom);if(Rt(e,this.viewPortHandler)){Ct(t);var i=this.dataProvider.minPos,r=this.dataProvider.range,a=1===Math.max(-1,Math.min(1,t.wheelDelta||-t.deltaY));this.zoom(a,a?.95:1.05,i,r)&&(this.cross(e),this.markerChart.flush())}}}}]),e}(wt),Ot=function(){function t(e,r,a){i(this,t),this.dataProvider=e,this.markerChart=r,this.viewPortHandler=r.viewPortHandler,this.yRender=r.markerRender.yRender,this.config=a,this.noneMarkerMouseDownFlag=!1,this.noneMarkerMouseDownActiveData={markerKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1}}return a(t,[{key:"mouseUp",value:function(){this.noneMarkerMouseDownFlag=!1,this.noneMarkerMouseDownActiveData={markerKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1}}},{key:"mouseDown",value:function(t){var e=At(t,this.markerChart.canvasDom);if(this.dataProvider.markerPoint=s({},e),Rt(e,this.viewPortHandler)){var i=this.dataProvider.currentMarkerType;switch(i){case G.HORIZONTAL_STRAIGHT_LINE:case G.VERTICAL_STRAIGHT_LINE:case G.STRAIGHT_LINE:case G.HORIZONTAL_RAY_LINE:case G.VERTICAL_RAY_LINE:case G.RAY_LINE:case G.HORIZONTAL_SEGMENT_LINE:case G.VERTICAL_SEGMENT_LINE:case G.SEGMENT_LINE:case G.PRICE_LINE:case G.FIBONACCI_LINE:this.twoStepMarkerMouseDown(t,i);break;case G.PRICE_CHANNEL_LINE:case G.PARALLEL_STRAIGHT_LINE:this.threeStepMarkerMouseDown(t,i);break;case G.NONE:this.noneMarkerMouseDown(t)}}}},{key:"twoStepMarkerMouseDown",value:function(t,e){var i=this;this.markerMouseDown(t,e,(function(t){switch(t.drawStep){case Y:t.drawStep=W;break;case W:t.drawStep=X,i.dataProvider.currentMarkerType=G.NONE}}))}},{key:"threeStepMarkerMouseDown",value:function(t,e){var i=this;this.markerMouseDown(t,e,(function(t){switch(t.drawStep){case Y:t.drawStep=W;break;case W:t.drawStep=j;break;case j:t.drawStep=X,i.dataProvider.currentMarkerType=G.NONE}}))}},{key:"markerMouseDown",value:function(t,e,i){var r=this.dataProvider.markerDatas[e];if(2===t.button)r.splice(r.length-1,1),this.dataProvider.currentMarkerType=G.NONE;else{var a=r[r.length-1];i(a),r[r.length-1]=a}this.dataProvider.markerDatas[e]=r,this.markerChart.flush()}},{key:"noneMarkerMouseDown",value:function(t){this.findNoneMarkerMouseDownActiveData(t);var e=this.noneMarkerMouseDownActiveData.markerKey,i=this.noneMarkerMouseDownActiveData.dataIndex;if(e&&-1!==i)if(2===t.button){var r=this.dataProvider.markerDatas[e];r.splice(i,1),this.dataProvider.markerDatas[e]=r,this.markerChart.flush()}else this.noneMarkerMouseDownActiveData.onCircle&&(this.noneMarkerMouseDownFlag=!0,this.dataProvider.isDragMarker=!0)}},{key:"findNoneMarkerMouseDownActiveData",value:function(t){for(var i=this,r=At(t,this.markerChart.canvasDom),a=Object.keys(this.dataProvider.markerDatas),n=function(t){var e=a[t];switch(e){case G.HORIZONTAL_STRAIGHT_LINE:case G.PRICE_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,r,(function(t){return at(t[0],{x:i.viewPortHandler.contentRight(),y:t[0].y},r)})))return{v:void 0};break;case G.VERTICAL_STRAIGHT_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,r,(function(t){return at(t[0],{x:t[0].x,y:i.viewPortHandler.contentBottom()},r)})))return{v:void 0};break;case G.STRAIGHT_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,r,(function(t){return at(t[0],t[1],r)})))return{v:void 0};break;case G.HORIZONTAL_RAY_LINE:case G.VERTICAL_RAY_LINE:case G.RAY_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,r,(function(t){return nt(t[0],t[1],r)})))return{v:void 0};break;case G.HORIZONTAL_SEGMENT_LINE:case G.VERTICAL_SEGMENT_LINE:case G.SEGMENT_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,r,(function(t){return ot(t[0],t[1],r)})))return{v:void 0};break;case G.PRICE_CHANNEL_LINE:case G.PARALLEL_STRAIGHT_LINE:case G.FIBONACCI_LINE:if(i.realFindNoneMarkerMouseDownActiveData(e,r,(function(t){var a=[];switch(e){case G.PRICE_CHANNEL_LINE:a=ht(t,i.viewPortHandler,!0);break;case G.PARALLEL_STRAIGHT_LINE:a=ht(t,i.viewPortHandler);break;case G.FIBONACCI_LINE:a=lt(t,i.viewPortHandler)}for(var n=!1,o=0;a.length>o;o++){var s=a[o];if(n=at(s[0],s[1],r))return n}return n})))return{v:void 0}}},o=0;a.length>o;o++){var s=n(o);if("object"===e(s))return s.v}}},{key:"realFindNoneMarkerMouseDownActiveData",value:function(t,e,i){var r=this;return this.dataProvider.markerDatas[t].forEach((function(a,n){var o=[],s=!1,h=-1;a.points.forEach((function(t,i){var a=(t.xPos-r.dataProvider.minPos)*r.dataProvider.dataSpace,n=r.yRender.getY(t.price);o.push({x:a,y:n});var l=st({x:a,y:n},r.config.marker.point.radius,e);l&&(h=i),s||(s=l)}));var l=i(o,e);if(l||s)return r.noneMarkerMouseDownActiveData={markerKey:t,dataIndex:n,onLine:l,onCircle:s,pointIndex:h},!0})),!1}},{key:"mouseMove",value:function(t){var e=At(t,this.markerChart.canvasDom);if(this.dataProvider.markerPoint=s({},e),Rt(e,this.viewPortHandler)&&!this.waitingForMouseMoveAnimationFrame){this.waitingForMouseMoveAnimationFrame=!0;var i=this.dataProvider.currentMarkerType;switch(i){case G.HORIZONTAL_STRAIGHT_LINE:case G.VERTICAL_STRAIGHT_LINE:case G.PRICE_LINE:this.onePointMarkerMouseMove(e,i);break;case G.STRAIGHT_LINE:case G.RAY_LINE:case G.SEGMENT_LINE:case G.FIBONACCI_LINE:this.twoPointMarkerMouseMove(e,i);break;case G.HORIZONTAL_RAY_LINE:case G.HORIZONTAL_SEGMENT_LINE:this.twoPointMarkerMouseMove(e,i,(function(t,e){t.points[0].price=e.price}));break;case G.VERTICAL_RAY_LINE:case G.VERTICAL_SEGMENT_LINE:this.twoPointMarkerMouseMove(e,i,(function(t,e){t.points[0].xPos=e.xPos}));break;case G.PRICE_CHANNEL_LINE:case G.PARALLEL_STRAIGHT_LINE:this.threePointMarkerMouseMove(e,i);break;case G.NONE:this.noneMarkerMouseMove(e)}this.waitingForMouseMoveAnimationFrame=!1}}},{key:"onePointMarkerMouseMove",value:function(t,e){var i=this;this.markerMouseMove(t,e,(function(e,r){var a=i.dataProvider.minPos+(t.x-i.viewPortHandler.contentLeft())/i.dataProvider.dataSpace,n=i.yRender.getValue(t.y);switch(r.drawStep){case X:e.push({points:[{xPos:a,price:n}],drawStep:Y});break;case Y:case W:r.points[0].xPos=a,r.points[0].price=n,e[e.length-1]=r}}))}},{key:"twoPointMarkerMouseMove",value:function(t,e,i){var r=this;this.markerMouseMove(t,e,(function(e,a){var n=r.dataProvider.minPos+(t.x-r.viewPortHandler.contentLeft())/r.dataProvider.dataSpace,o=r.yRender.getValue(t.y);switch(a.drawStep){case X:e.push({points:[{xPos:n,price:o},{xPos:n,price:o}],drawStep:Y});break;case Y:a.points[0]={xPos:n,price:o},a.points[1]={xPos:n,price:o},e[e.length-1]=a;break;case W:a.points[1]={xPos:n,price:o},R(i)&&i(a,{xPos:n,price:o}),e[e.length-1]=a}}))}},{key:"threePointMarkerMouseMove",value:function(t,e,i){var r=this;this.markerMouseMove(t,e,(function(e,a){var n=r.dataProvider.minPos+(t.x-r.viewPortHandler.contentLeft())/r.dataProvider.dataSpace,o=r.yRender.getValue(t.y);switch(a.drawStep){case X:e.push({points:[{xPos:n,price:o},{xPos:n,price:o}],drawStep:Y});break;case Y:a.points[0]={xPos:n,price:o},a.points[1]={xPos:n,price:o},e[e.length-1]=a;break;case W:R(i)&&i(a,{xPos:n,price:o}),a.points[1]={xPos:n,price:o},e[e.length-1]=a;break;case j:a.points[2]={xPos:n,price:o},e[e.length-1]=a}}))}},{key:"markerMouseMove",value:function(t,e,i){var r=this.dataProvider.markerDatas[e];i(r,r[r.length-1]||{drawStep:X}),this.dataProvider.markerDatas[e]=r,this.markerChart.flush()}},{key:"noneMarkerMouseMove",value:function(t){if(this.noneMarkerMouseDownFlag){var e=this.noneMarkerMouseDownActiveData.markerKey,i=this.noneMarkerMouseDownActiveData.dataIndex;if(e&&-1!==i){var r=this.dataProvider.markerDatas[e];switch(e){case G.HORIZONTAL_STRAIGHT_LINE:case G.VERTICAL_STRAIGHT_LINE:case G.PRICE_LINE:case G.STRAIGHT_LINE:case G.RAY_LINE:case G.SEGMENT_LINE:case G.PRICE_CHANNEL_LINE:case G.PARALLEL_STRAIGHT_LINE:case G.FIBONACCI_LINE:var a=this.noneMarkerMouseDownActiveData.pointIndex;-1!==a&&(r[i].points[a].xPos=(t.x-this.viewPortHandler.contentLeft())/this.dataProvider.dataSpace+this.dataProvider.minPos,r[i].points[a].price=this.yRender.getValue(t.y));break;case G.HORIZONTAL_RAY_LINE:case G.HORIZONTAL_SEGMENT_LINE:var n=this.noneMarkerMouseDownActiveData.pointIndex;if(-1!==n){var o=this.yRender.getValue(t.y);r[i].points[n].xPos=(t.x-this.viewPortHandler.contentLeft())/this.dataProvider.dataSpace+this.dataProvider.minPos,r[i].points[0].price=o,r[i].points[1].price=o}break;case G.VERTICAL_RAY_LINE:case G.VERTICAL_SEGMENT_LINE:var s=this.noneMarkerMouseDownActiveData.pointIndex;if(-1!==s){var h=(t.x-this.viewPortHandler.contentLeft())/this.dataProvider.dataSpace+this.dataProvider.minPos;r[i].points[0].xPos=h,r[i].points[1].xPos=h,r[i].points[s].price=this.yRender.getValue(t.y)}}this.dataProvider.markerDatas[e]=r}}this.markerChart.flush()}}]),t}(),Ft=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,t),!e)throw Error("Chart version is 3.0.0. Root dom is null, can not initialize the chart!!!");this.throttle=function(t,e){var i=0;return function(){var r=Date.now();r-i>e&&(t(),i=r)}},this.config={grid:!1,realTime:{timeLine:{color:"#D4D4D4",size:1,areaFillColor:"#FAFAFA"},averageLine:{display:!0,color:"#F5A623",size:1}},candle:{style:"solid",increasingColor:"#5DB300",decreasingColor:"#FF4A4A"},highestPriceMark:{display:!0,color:"#898989",text:{margin:5,size:10,valueFormatter:null}},lowestPriceMark:{display:!0,color:"#898989",text:{margin:5,size:10,valueFormatter:null}},lastPriceMark:{display:!0,increasingColor:"#5DB300",decreasingColor:"#FF4A4A",line:{display:!0,style:"dash",dashValue:[4,4],size:1},text:{display:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",valueFormatter:null}},indicator:{lineSize:1,increasingColor:"#5DB300",decreasingColor:"#FF4A4A",lineColors:["#898989","#F5A623","#F601FF","#1587DD","#50A300"]},xAxis:{display:!0,maxHeight:50,minHeight:30,line:{display:!0,color:"#AFAFAF",size:1},tick:{text:{display:!0,color:"#AFAFAF",size:12,margin:3,valueFormatter:null},line:{display:!0,size:1,length:3,color:"#AFAFAF"}},separatorLine:{display:!1,size:1,color:"#B8B8B8",style:"dash",dashValue:[2,2]}},yAxis:{display:!0,position:"right",maxWidth:60,minWidth:40,line:{display:!0,color:"#AFAFAF",size:1},tick:{text:{display:!0,position:"inside",color:"#AFAFAF",size:12,margin:3,valueFormatter:null},line:{display:!0,size:1,length:3,color:"#AFAFAF"}},separatorLine:{display:!1,size:1,color:"#B8B8B8",style:"dash",dashValue:[2,2]}},tooltip:{cross:{display:!0,line:{style:"solid",dashValue:[2,2],size:1,color:"#AAAAAA"},text:{horizontal:{color:"#EDEDED",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#EDEDED",backgroundColor:"#505050",valueFormatter:null},vertical:{color:"#EDEDED",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#EDEDED",backgroundColor:"#505050",valueFormatter:null}}},data:{displayRule:"always",base:{showType:"fixed",labels:["","","","","",""],values:null,text:{size:12,color:"#898989",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0,valueFormatter:null},floatRect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,left:8,top:8,right:8,borderRadius:4,borderSize:1,borderColor:"#444444",fillColor:"#202020"}},indicator:{text:{size:12,color:"#898989",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8,valueFormatter:null}}}},marker:{line:{color:"#1587DD",size:1},point:{backgroundColor:"#1587DD",borderColor:"#1587DD",borderSize:1,radius:4,activeBackgroundColor:"#1587DD",activeBorderColor:"#1587DD",activeBorderSize:1,activeRadius:6},text:{color:"#1587DD",size:12,marginLeft:2,marginRight:2,marginTop:2,marginBottom:6,valueFormatter:null}}},L(this.config,r),e.style.position="relative",this.dom=e,this.dataProvider=new Z,this.xAxisChart=new mt(e,this.config,this.dataProvider),this.mainChart=new it(e,this.config,this.dataProvider),this.markerChart=new dt(e,this.config,this.dataProvider,this.mainChart.yAxisRender),this.volIndicatorChart=new tt(e,this.config,this.dataProvider,T.VOL),this.subIndicatorChart=new tt(e,this.config,this.dataProvider),this.tooltipChart=new vt(e,this.config,this.mainChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart,this.dataProvider),this.calcChartDimensions(),this.initEvent()}return a(t,[{key:"initEvent",value:function(){var t=this,e=this.throttle((function(){t.domWidth===t.dom.offsetWidth&&t.domHeight===t.dom.offsetHeight||t.calcChartDimensions()}),62.5);window.addEventListener("resize",e,!1);var i=Lt(window.navigator.userAgent);if(this.dom.addEventListener("contextmenu",(function(t){t.preventDefault()}),!1),i){var r=new Ht(this.tooltipChart,this.mainChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart,this.dataProvider);this.dom.addEventListener("touchstart",(function(t){r.touchStart(t)}),!1),this.dom.addEventListener("touchmove",(function(t){r.touchMove(t)}),!1),this.dom.addEventListener("touchend",(function(t){r.touchEnd(t)}),!1)}else{var a=new _t(this.tooltipChart,this.mainChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart,this.markerChart,this.dataProvider),n=new Ot(this.dataProvider,this.markerChart,this.config);this.dom.addEventListener("mousedown",(function(t){a.mouseDown(t),n.mouseDown(t)}),!1),this.dom.addEventListener("mouseup",(function(t){a.mouseUp(t),n.mouseUp(t)}),!1),this.dom.addEventListener("mousemove",(function(t){a.mouseMove(t),n.mouseMove(t)}),!1),this.dom.addEventListener("mouseleave",(function(t){a.mouseLeave(t)}),!1),this.dom.addEventListener("wheel",(function(t){a.mouseWheel(t)}),!1)}}},{key:"flushCharts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=!0,i=!1,r=void 0;try{for(var a,n=t[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var o=a.value;o.flush()}}catch(t){i=!0,r=t}finally{try{e||null==n.return||n.return()}finally{if(i)throw r}}}},{key:"calcChartDimensions",value:function(){var t=this.calcXAxisHeight(),e=this.calcYAxisWidth(),i=this.dom.offsetWidth,r=this.dom.offsetHeight;this.domWidth=i,this.domHeight=r;var a=r-t,n=0,o=0,s=0,h=this.volIndicatorChart.indicatorType!==T.NO,l=this.subIndicatorChart.indicatorType!==T.NO;if(h&&l){var c=+(.2*a).toFixed(0);o=c,s=c}else if(!h&&l||h&&!l){var d=+(.3*a).toFixed(0);h?o=d:s=d}var u=0,v=0;this.config.yAxis.position===b?u=e:v=e,this.dataProvider.space(i-v-u),this.xAxisChart.setChartDimensions(0,i,r,u,v,0,t);var f=a-o-s;this.mainChart.setChartDimensions(n,i,f,u,v),this.markerChart.setChartDimensions(n,i,f,u,v),this.volIndicatorChart.setChartDimensions(n+=f,i,o,u,v),this.subIndicatorChart.setChartDimensions(n+=o,i,s,u,v),this.tooltipChart.setChartDimensions(0,i,r,u,v,0,t)}},{key:"calcXAxisHeight",value:function(){var t=this.config.xAxis,e=t.tick.text,i=t.tick.line,r=e.size+e.margin;return t.display&&i.display&&(r+=i.length),t.display&&t.line.display&&(r+=t.line.size),+Math.ceil(+(r=Math.max(t.minHeight,Math.min(r,t.maxHeight)))).toFixed(0)}},{key:"calcYAxisWidth",value:function(){var t=this.config.yAxis,e=t.tick.text,i=t.tick.line;if(((e.display||i.display||e.margin>0)&&e.position===S||t.line.display)&&t.display){var r=0;e.position===S&&(r+=g(e.size,"0000000")+e.margin,t.display&&i.display&&(r+=i.length));var a=t.line.size;return t.display&&t.line.display&&(r+=a),r>a&&(r=Math.max(t.minWidth,Math.min(r,t.maxWidth))),Math.ceil(r)}return 0}},{key:"calcChartIndicator",value:function(){this.mainChart.indicatorType!==T.NO&&this.calcIndicator(this.mainChart.indicatorType,this.mainChart),this.volIndicatorChart.indicatorType!==T.NO&&this.calcIndicator(T.VOL,this.volIndicatorChart),this.subIndicatorChart.indicatorType!==T.NO&&this.calcIndicator(this.subIndicatorChart.indicatorType,this.subIndicatorChart)}},{key:"calcIndicator",value:function(t,e){var i=this;Promise.resolve().then((function(){try{var r=yt[t];R(r)&&(i.dataProvider.dataList=r(i.dataProvider.dataList)),i.flushCharts([e,i.tooltipChart])}catch(t){}}))}},{key:"setConfig",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L(this.config,t),this.calcChartDimensions()}},{key:"addData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dataProvider.dataList.length;this.dataProvider.addData(t,e),this.calcChartIndicator(),this.xAxisChart.flush()}},{key:"setMainChartType",value:function(t){this.mainChart.chartType!==t&&(this.mainChart.chartType=t,this.flushCharts([this.mainChart,this.tooltipChart]),t===D.REAL_TIME&&this.clearAllMarker())}},{key:"setMainIndicatorType",value:function(t){this.mainChart.indicatorType!==t&&(this.mainChart.indicatorType=t,this.calcIndicator(t,this.mainChart))}},{key:"setSubIndicatorType",value:function(t){if(this.subIndicatorChart.indicatorType!==t){var e=t===T.NO||this.subIndicatorChart.indicatorType===T.NO;this.subIndicatorChart.indicatorType=t,e&&this.calcChartDimensions(),t!==T.NO&&this.calcIndicator(t,this.subIndicatorChart)}}},{key:"showVolChart",value:function(t){t!==(this.volIndicatorChart.indicatorType!==T.NO)&&(this.volIndicatorChart.indicatorType=t?T.VOL:T.NO,this.calcChartDimensions(),t&&this.calcIndicator(T.VOL,this.volIndicatorChart))}},{key:"setDefaultRange",value:function(t){!C(t)||this.dataProvider.minRange>t||t>this.dataProvider.maxRange||(this.dataProvider.range=t,this.dataProvider.space(this.tooltipChart.viewPortHandler.contentRight()-this.tooltipChart.viewPortHandler.contentLeft()),this.dataProvider.minPos+t>this.dataProvider.dataList.length&&(this.dataProvider.minPos=this.dataProvider.dataList.length-t,0>this.dataProvider.minPos&&(this.dataProvider.minPos=0)),this.flushCharts([this.mainChart,this.volIndicatorChart,this.subIndicatorChart,this.xAxisChart]))}},{key:"setMinRange",value:function(t){C(t)&&this.dataProvider.range>=t&&(this.dataProvider.minRange=t)}},{key:"setMaxRange",value:function(t){C(t)&&t>=this.dataProvider.range&&(this.dataProvider.maxRange=t)}},{key:"getMainIndicatorType",value:function(){return this.mainChart.indicatorType}},{key:"getSubIndicatorType",value:function(){return this.subIndicatorChart.indicatorType}},{key:"isShowVolChart",value:function(){return this.volIndicatorChart.indicatorType!==T.NO}},{key:"getDataList",value:function(){return this.dataProvider.dataList}},{key:"getConfig",value:function(){return this.config}},{key:"clearData",value:function(){this.dataProvider.dataList=[]}},{key:"drawMarker",value:function(t){var e=this.dataProvider.currentMarkerType;if(e!==t){var i=this.dataProvider.markerDatas[e];i&&w(i)&&(i.splice(i.length-1,1),this.dataProvider.markerDatas[e]=i,this.tooltipChart.flush())}this.dataProvider.currentMarkerType=t}},{key:"clearAllMarker",value:function(){var t=this;Object.keys(this.dataProvider.markerDatas).forEach((function(e){t.dataProvider.markerDatas[e]=[]})),this.dataProvider.currentMarkerType=G.NONE,this.markerChart.flush()}},{key:"getConvertPictureUrl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jpeg",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("png"!==t&&"jpeg"!==t&&"bmp"!==t)throw Error("Picture format only supports jpeg, png and bmp!!!");var i=document.createElement("canvas"),r=this.xAxisChart.canvasDom,a=this.mainChart.canvasDom,n=this.volIndicatorChart.canvasDom,o=this.subIndicatorChart.canvasDom,s=this.tooltipChart.canvasDom;i.width=s.width,i.height=s.height,i.style.width=s.style.width,i.style.height=s.style.height;var h=i.getContext("2d");if(h.drawImage(r,0,0,r.width,r.height),e&&e.indexOf("candle")>=0||h.drawImage(a,0,0,a.width,a.height),e&&e.indexOf("vol")>=0||h.drawImage(n,0,a.height,n.width,n.height),e&&e.indexOf("subIndicator")>=0||h.drawImage(o,0,a.height+n.height,o.width,o.height),!e||0>e.indexOf("marker")){var l=this.markerChart.canvasDom;h.drawImage(l,0,0,l.width,l.height)}return e&&e.indexOf("tooltip")>=0||h.drawImage(s,0,0,s.width,s.height),i.toDataURL("image/".concat(t))}}]),t}();t.init=function(t){return new Ft(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})},t.version="3.0.0",Object.defineProperty(t,"__esModule",{value:!0})}));
